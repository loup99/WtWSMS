# -*- ck2.events -*-

namespace = emf_heresy

#reserved: emf_heresy.100 to emf_heresy.2199

#######################################
# NEW HERESY EVENTS
# Adapted from Heretic Pride by Rylock
#######################################

### NEW CARDINAL EVENTS

# Character has become a religious elector
character_event = {
	id = emf_heresy.155
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_religion
	
	desc = {
		text = EVTDESC_emf_heresy_155_manichean
		trigger = { religion = manichean }
	}
	desc = {
		text = EVTDESC_emf_heresy_155_cathar
		trigger = { religion = cathar }
	}
	desc = {
		text = EVTDESC_emf_heresy_155_bogomilist
		trigger = { religion = bogomilist }
	}
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
		hidden_tooltip = {
			if = {
				limit = {
					independent = no
					any_liege = {
						ai = no
						religion = ROOT
					}
				}
				any_liege = { character_event = { id = emf_heresy.156 } }
			}
			any_playable_ruler = {
				limit = {
					ai = no
					religion = ROOT
					NOT = { is_vassal_or_below = ROOT }
				}
				character_event = { id = emf_heresy.157 }
			}
		}
	}
}

# Inform liege
character_event = {
	id = emf_heresy.156
	picture = GFX_evt_bishop

	desc = {
		text = EVTDESC_emf_heresy_156_manichean
		trigger = { religion = manichean }
	}
	desc = {
		text = EVTDESC_emf_heresy_156_cathar
		trigger = { religion = cathar }
	}
	desc = {
		text = EVTDESC_emf_heresy_156_bogomilist
		trigger = { religion = bogomilist }
	}
	
	is_triggered_only = yes
	notification = yes

	option = {
		name = OK
	}
}

# Inform everyone else
character_event = {
	id = emf_heresy.157
	picture = GFX_evt_bishop

	desc = {
		text = EVTDESC_emf_heresy_157_manichean
		trigger = { religion = manichean }
	}
	desc = {
		text = EVTDESC_emf_heresy_157_cathar
		trigger = { religion = cathar }
	}
	desc = {
		text = EVTDESC_emf_heresy_157_bogomilist
		trigger = { religion = bogomilist }
	}
	
	is_triggered_only = yes
	notification = yes

	option = {
		name = OK
	}
}

### GENERIC JOIN HOLY ORDER EVENTS

# Liege is asked for permission to join the holy order
character_event = {
	id = emf_heresy.160
	picture = GFX_evt_crusaders
	border = GFX_event_normal_frame_religion
	
	desc = {
		trigger = {
			FROM = {
				OR = {
					religion_group = christian
					religion_group = indian_group
				}
			}
		}
		text = EVTDESC_emf_heresy_160A
	}
	desc = {
		trigger = {
			FROM = {
				NOR = {
					religion_group = christian
					religion_group = indian_group
				}
			}
		}
		text = EVTDESC_emf_heresy_160B
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOA_1031 # Agree
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				OR = {
					religion_group = indian_group
					religion_group = christian
				}
				FROM = { is_primary_heir = yes }
			}
		}
		if = {
			limit = { FROM = { is_child_of = ROOT } }
			piety = 100
		}
		if = {
			limit = {
				FROM = {
					NOT = { is_child_of = ROOT }
					is_close_relative = ROOT
				}
			}
			piety = 50
		}
		if = {
			limit = {
				FROM = {
					NOT = { is_child_of = ROOT }
					NOT = { is_close_relative = ROOT }
				}
			}
			piety = 20
		}
		FROM = {
			opinion = {
				who = ROOT
				modifier = opinion_grateful
			}
			character_event = {
				id = emf_heresy.161
				tooltip = JOINS_HOLY_ORDER
			}
		}
	}
	option = {
		name = EVTOPTB_SOA_1031 # Refuse
		ai_chance = {
			factor = 10
			modifier = {
				factor = 5
				OR = {
					religion_group = indian_group
					religion_group = christian
				}
				FROM = { is_primary_heir = yes }
			}
			modifier = {
				factor = 0
				OR = {
					NOR = {
						religion_group = indian_group
						religion_group = christian
					}
					FROM = { is_primary_heir = no }
				}
			}
		}		
		if = {
			limit = { FROM = { is_child_of = ROOT } }
			piety = -100
		}
		if = {
			limit = {
				FROM = {
					NOT = { is_child_of = ROOT }
					is_close_relative = ROOT
				}
			}
			piety = -50
		}
		if = {
			limit = {
				FROM = {
					NOT = { is_child_of = ROOT }
					NOT = { is_close_relative = ROOT }
				}
			}
			piety = -20
		}		
		FROM = {
			opinion = {
				who = ROOT
				modifier = opinion_refused_request_holy_order
			}
		}
	}
}

# Liege agrees to let him join the holy order
character_event = {
	id = emf_heresy.161
	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { is_married = yes }
			any_spouse = {
				remove_spouse = ROOT
				opinion = { who = ROOT modifier = opinion_divorced duration = -1 }
				any_dynasty_member = {
					limit = {
						is_close_relative = PREV
						NOR = {
							character = ROOT
							is_liege_of = ROOT
							trait = zealous
							holy_order = yes
							any_liege = { holy_order = yes }
						}
					}
					opinion = { who = ROOT modifier = opinion_divorced_relative duration = -1 }
				}
			}
		}
		if = {
			limit = { religion_group = christian }
			add_trait = celibate
		}
		event_target:join_holy_order = {
			holder_scope = {
				ROOT = {
					move_character = PREV
					transfer_scaled_wealth = { to = PREV value = all }
					emf_stop_hiding_effect = yes
				}
			}
		}
		if = {
			limit = {
				OR = {
					religion_group = christian
					religion_group = indian_group
				}
			}
			FROM = { recalc_succession = yes }
		}
	}
}

### CUSTOMIZER EVENT

# Prompt some heresies to appear early if picked by the Ruler Designer
character_event = {
	id = emf_heresy.162
	
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		OR = {
			AND = {
				religion = cathar
				NOT = { has_global_flag = cathar_activated }
			}
			AND = {
				religion = fraticelli
				NOT = { has_global_flag = fraticelli_activated }
			}
			AND = {
				religion = waldensian
				NOT = { has_global_flag = waldensian_activated }
			}
			AND = {
				religion = lollard
				NOT = { has_global_flag = lollard_activated }
			}
			AND = {
				religion = adoptionist
				has_global_flag = adoptionist_deactivated
			}
			AND = {
				religion = arian
				has_global_flag = arian_deactivated
			}
			AND = {
				religion = bogomilist
				NOT = { has_global_flag = bogomilist_activated }
			}
			AND = {
				religion = druze
				NOT = { has_global_flag = druze_activated }
			}
			AND = {
				religion = qarmatian
				NOT = { has_global_flag = qarmatian_activated }
			}
		}
		NOT = {
			had_global_flag = { flag = EMF days = 1 }
		}
	}
	
	immediate = {
		if = {
			limit = { religion = cathar }
			set_global_flag = cathar_activated
		}
		if = {
			limit = { religion = fraticelli }
			set_global_flag = fraticelli_activated
		}
		if = {
			limit = { religion = waldensian }
			set_global_flag = waldensian_activated
		}
		if = {
			limit = { religion = lollard }
			set_global_flag = lollard_activated
		}
		if = {
			limit = { religion = adoptionist }
			clr_global_flag = adoptionist_deactivated
		}
		if = {
			limit = { religion = arian }
			clr_global_flag = arian_deactivated
		}
		if = {
			limit = { religion = bogomilist }
			set_global_flag = bogomilist_activated
		}
		if = {
			limit = { religion = druze }
			set_global_flag = druze_activated
		}
		if = {
			limit = { religion = qarmatian }
			set_global_flag = qarmatian_activated
		}
	}
}

### ARIAN/ADOPTIONIST DEACTIVATION

# Deactivate Arian/Adoptionist after 900 if they don't exist anywhere
character_event = {
	id = emf_heresy.165
	
	hide_window = yes
	is_triggered_only = yes
	
	only_playable = yes
	religion = catholic
	
	trigger = {
		controls_religion = yes
		year = 900
		OR = {
			NOT = { has_global_flag = adoptionist_deactivated }
			NOT = { has_global_flag = arian_deactivated }
		}
	}
	
	immediate = {
		if = {
			limit = {
				NOR = {
					has_global_flag = adoptionist_deactivated
					any_province = { religion = adoptionist }
					any_playable_ruler = { religion = adoptionist }
				}
			}
			set_global_flag = adoptionist_deactivated
		}
		if = {
			limit = {
				NOR = {
					has_global_flag = arian_deactivated
					any_province = { religion = arian }
					any_playable_ruler = { religion = arian }
				}
			}
			set_global_flag = arian_deactivated
		}
	}
}


#######################################
# MANICHAEAN EVENTS
#######################################

# Choosing a Shekhinah
character_event = {
	id = emf_heresy.226
	title = EVTNAME_emf_heresy_226
	desc = EVTDESC_emf_heresy_226
	picture = GFX_evt_knight_kneeling
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_226
		add_character_modifier = {
			name = patron_reason
			duration = -1
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_226
		add_character_modifier = {
			name = patron_mind
			duration = -1
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_226
		add_character_modifier = {
			name = patron_intelligence
			duration = -1
		}
	}
	option = {
		trigger = { ai = yes }
		name = EVTOPTB_emf_heresy_227
		add_character_modifier = {
			name = patron_mani_understanding
			duration = -1
		}
	}
	option = {
		trigger = { ai = yes }
		name = EVTOPTA_emf_heresy_227
		add_character_modifier = {
			name = patron_thought
			duration = -1
		}
	}
	option = {
		trigger = { ai = no }
		name = EVTOPTD_emf_heresy_226
		character_event = { id = emf_heresy.227 tooltip = CONSIDER_OTHER_OPTIONS }
	}
}

character_event = {
	id = emf_heresy.227
	title = EVTNAME_emf_heresy_226
	desc = EVTDESC_emf_heresy_226
	picture = GFX_evt_knight_kneeling
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		name = EVTOPTB_emf_heresy_227
		add_character_modifier = {
			name = patron_mani_understanding
			duration = -1
		}
	}
	option = {
		name = EVTOPTA_emf_heresy_227
		add_character_modifier = {
			name = patron_thought
			duration = -1
		}
	}
	option = {
		name = EVTOPTD_emf_heresy_226
		character_event = { id = emf_heresy.226 tooltip = CONSIDER_OTHER_OPTIONS }
	}
}

# Manichean leader restored
narrative_event = {
	id = emf_heresy.228
	title = EVTNAME_emf_heresy_228
	desc = EVTDESC_emf_heresy_228
	picture = GFX_evt_zoroaster
	border = GFX_event_narrative_frame_religion

	major = yes
	show_ROOT = yes
	hide_from = yes
	is_triggered_only = yes
	
	immediate = {
		random_realm_lord = {
			limit = {
				in_revolt = no
				religion = manichean
				capital_holding = { is_holy_site = ROOT }
				prisoner = no
				NOT = { trait = incapable }
			}
			d_manichean = { grant_title = PREV }
			set_defacto_liege = ROOT
			emf_liege_change_effect = yes
			save_event_target_as = new_manichean_leader
			break = yes
		}
		random_realm_lord = {
			limit = {
				in_revolt = no
				religion = manichean
				capital_holding = { holding_type = temple }
				prisoner = no
				NOT = { trait = incapable }
				NOT = { trait = bad_priest_zoroastrian }
			}
			d_manichean = { grant_title = PREV }
			set_defacto_liege = ROOT
			emf_liege_change_effect = yes
			save_event_target_as = new_manichean_leader
			ROOT = {
				random_realm_title = {
					limit = { is_holy_site = ROOT }
					gain_title = PREVPREV
				}
			}
			break = yes
		}
		create_random_priest = {
			random_traits = yes
			dynasty = random
			religion = manichean
			culture = ROOT
			age = 40
			health = 7
			trait = quick
			trait = zealous
			trait = scholar
			trait = mastermind_theologian
			attributes = {
				learning = 5
				diplomacy = 5
				martial = 2
				stewardship = 5
				intrigue = 5
			}
		}
		new_character = {
			d_manichean = { grant_title = PREV }
			set_defacto_liege = ROOT
			emf_liege_change_effect = yes
			save_event_target_as = new_manichean_leader
			ROOT = {
				random_realm_title = {
					limit = { is_holy_site = ROOT }
					gain_title = PREVPREV
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_228
		trigger = {
			NOT = { religion = manichean }
		}
		event_target:new_manichean_leader = { }
	}
	option = {
		name = EVTOPTB_emf_heresy_228
		trigger = { religion = manichean }
		event_target:new_manichean_leader = { }
	}
}

# The Army of Light founded
narrative_event = {
	id = emf_heresy.229
	title = EVTNAME_emf_heresy_229
	desc = EVTDESC_emf_heresy_229
	picture = GFX_evt_crusaders
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	major = yes
	hide_from = yes
	
	option = {
		name = EVTOPTA_emf_heresy_229
		trigger = {
			religion = manichean
		}
	}
	option = {
		name = I_SEE
		trigger = {
			NOT = { religion = manichean }
		}
	}
}

# Ping event when donating money to the Army of Light
character_event = {
	id = emf_heresy.230
	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		wealth = 300
		FROM = {
			letter_event = {
				id = emf_heresy.231
			}
		}
		opinion = {
			who = FROM
			modifier = opinion_generous_donation
		}
	}
}

# Notification event when donating money to the Army of Light
letter_event = {
	id = emf_heresy.231
	desc = EVTDESC_emf_heresy_231
	border = GFX_event_letter_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
	}
}

# Ping event when expelling the Army of Light
character_event = {
	id = emf_heresy.232
	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		any_title_under = {
			limit = {
				tier = BARON
				location = {
					owner = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
				}
			}
			usurp_title = FROM
		}
		if = {
			limit = { is_liege_or_above = FROM }
			set_defacto_liege = THIS
		}
		FROM = {
			letter_event = {
				id = emf_heresy.233
			}
		}
		opinion = {
			who = FROM
			modifier = opinion_expelled_from_realm
		}
	}
}

# Notification event when expelling the Army of Light
letter_event = {
	id = emf_heresy.233
	desc = EVTDESC_emf_heresy_233
	border = GFX_event_letter_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		remove_character_modifier = donated_to_holy_order
	}
	
	option = {
		name = EVTOPTB_SOA_1061
	}
}

# Muslim caliph orders the murder of Manicheans in Baghdad
character_event = {
	id = emf_heresy.234
	desc = EVTDESC_emf_heresy_234
	picture = GFX_evt_bishop_byzantine
	border = GFX_event_normal_frame_religion
	
	only_playable = yes
	min_age = 16
	capable_only = yes
	prisoner = no
	religion_group = muslim

	trigger = {
		controls_religion = yes
		693 = { owner_under_ROOT = yes }
		year = 900
		d_manichean = {
			has_holder = yes
			holder_scope = {
				NOT = {
					any_demesne_title = { controls_religion = no }
				}
			}
		}
		war = no
		OR = {
			trait = cruel
			trait = decadent
			trait = wroth
			trait = greedy
			trait = lunatic
			trait = possessed
		}
		NOR = {
			trait = sympathy_zoroastrianism
			has_character_flag = refused_manichean_murder
			has_global_flag = manichean_leader_murdered
		}
	}
	
	mean_time_to_happen = {
		months = 12
	}
	
	option = {
		name = EVTOPTA_emf_heresy_234
		ai_chance = { factor = 100 }
		set_global_flag = manichean_leader_murdered
		piety = 250
		if = {
			limit = { trait = decadent }
			remove_trait = decadent
		}
		if = {
			limit = { trait = just }
			remove_trait = just
		}
		if = {
			limit = {
				NOT = { trait = kind }
				NOT = { trait = cruel }
			}
			random = {
				chance = 50
				add_trait = cruel
			}
		}
		if = {
			limit = { trait = kind }
			remove_trait = kind
		}
		693 = {
			if = { limit = { religion = manichean } }
			religion = ROOT
		}
		d_manichean = {
			holder_scope = { save_event_target_as = manichean_leader }
		}
		tooltip = {
			d_manichean = {
				holder_scope = {
					death = {
						death_reason = death_murder
						killer = ROOT
					}
					religion_authority = {
						modifier = death_of_leader
						years = 30
					}
				}
			}
		}
		hidden_tooltip = {
			narrative_event = { id = emf_heresy.235 }
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_234
		ai_chance = { factor = 0 }
		set_character_flag = refused_manichean_murder
		if = {
			limit = { trait = zealous }
			remove_trait = zealous
		}
		piety = -250
	}
}

# Notification of the murder of the Manichean leader
narrative_event = {
	id = emf_heresy.235
	title = EVTNAME_emf_heresy_235
	desc = EVTDESC_emf_heresy_235
	picture = GFX_evt_bishop_byzantine
	border = GFX_event_narrative_frame_religion
	
	is_triggered_only = yes
	major = yes
	
	major_trigger = {
		OR = {
			character = FROM
			same_realm = FROM
			has_landed_title = d_manichean
			religion = manichean
			capital_scope = {
				NOT = {
					distance = {
						where = 693 # Baghdad
						value = 600	# Same part of the world
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_235
		trigger = { has_landed_title = d_manichean }
		d_manichean = { unsafe_destroy_landed_title = THIS }
		activate_title = { title = d_manichean status = no }
		religion_authority = {
			modifier = death_of_leader
			years = 30
		}
		death = {
			death_reason = death_murder
			killer = FROM
		}
	}
	option = {
		name = EVTOPTA_emf_heresy_235
		trigger = {
			NOT = { has_landed_title = d_manichean }
			religion = manichean
		}
		tooltip = {
			d_manichean = { unsafe_destroy_landed_title = THIS }
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_235
		trigger = {
			NOR = {
				has_landed_title = d_manichean
				religion = manichean
			}
			religion_group = muslim
		}
		tooltip = {
			d_manichean = { unsafe_destroy_landed_title = THIS }
		}
	}
	option = {
		name = I_SEE
		trigger = {
			NOR = {
				has_landed_title = d_manichean
				religion = manichean
				religion_group = muslim
			}
		}
		tooltip = {
			d_manichean = { unsafe_destroy_landed_title = THIS }
		}
	}
}

# Battle Events
character_event = {
	id = emf_heresy.236
	desc = EVTDESC_emf_heresy_236
	picture = GFX_evt_battle
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	trigger = {
		religion = manichean
	}
	
	option = {
		name = EVTOPTA_emf_heresy_236
		piety = 50
		religion_authority = {
			modifier = light_victory
			years = 5
		}
	}
}

character_event = {
	id = emf_heresy.237
	desc = EVTDESC_emf_heresy_237
	picture = GFX_evt_battle
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	trigger = {
		religion = manichean
	}
	
	option = {
		name = EVTOPTA_emf_heresy_237
		piety = -50
		religion_authority = {
			modifier = dark_victory
			years = 5
		}
	}
}

# BEMA FEAST EVENTS

# Invite vassals to festival
character_event = {
	id = emf_heresy.238
	desc = EVTDESC_emf_heresy_238
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion
	
	hide_from = yes
	
	only_rulers = yes
	min_age = 16
	only_capable = yes
	prisoner = no
	has_character_flag = planning_bema_feast

	trigger = {
		war = no
		NOT = { month = 6 }
		month = 3
		emf_can_disturb_trigger = yes
		NOT = { trait = in_hiding }
	}
	
	mean_time_to_happen = {
		days = 1
	}

	option = {
		name = EVTOPTA_emf_heresy_238
		clr_character_flag = planning_bema_feast
		set_character_flag = holding_bema_feast
		any_vassal = {
			limit = {
				prisoner = no
				war = no
				NOT = { trait = incapable }
				religion = manichean
				is_adult = yes
				NOT = { has_character_modifier = do_not_disturb }
			}
			letter_event = {
				id = emf_heresy.239
				tooltip = EVTTOOLTIP1_RoI_1000
			}
		}
		hidden_tooltip = { 
			character_event = { id = emf_heresy.241 days = 12 } # Begin Feast
			character_event = { id = emf_heresy.246 days = 4 }  # Fast
			emf_do_not_disturb_effect = yes
		}
		emf_stop_hiding_effect = yes
	}
}

# Vassal receives invitation
letter_event = {
	id = emf_heresy.239
	desc = EVTDESC_emf_heresy_239
	border = GFX_event_letter_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_239 #Travel to the feast
		ai_chance = {
			factor = 2
			modifier  = {
				factor = 0.1
				ai = yes
				trait = in_hiding
			}
			modifier  = {
				factor = 2
				opinion = { who = FROM value = -30 }
			}
			modifier  = {
				factor = 5
				opinion = { who = FROM value = -15 }
			}
			modifier  = {
				factor = 5
				opinion = { who = FROM value = 0 }
			}
		}
		set_character_flag = attending_bema_feast
		hidden_tooltip = {
			character_event = { id = emf_heresy.242 days = 12 } # Hidden - arrives at feast
			character_event = { id = emf_heresy.245 days = 25 } # Safety event for clearing all flags
			emf_do_not_disturb_effect = yes
		}
		emf_stop_hiding_effect = yes
	}
	option = {
		name = EVTOPTB_emf_heresy_239 #Refuse invitation
		ai_chance = {
			factor = 1
			modifier  = {
				factor = 0
				opinion = { who = FROM value = 25 }
				NOT = { trait = in_hiding }
			}
		}
		FROM = {
			letter_event = { id = emf_heresy.240 days = 1 random = 2 tooltip = EVTTOOLTIP1_RoI_2001 }
		}
	}
}

# If vassal refuses to come to the feast
letter_event = {
	id = emf_heresy.240
	desc = EVTDESC_emf_heresy_240
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_240 
		opinion = {
			modifier = opinion_dislike
			who = FROM
			years = 2
		}
	}
}

# Festival begins
character_event = {
	id = emf_heresy.241
	desc = EVTDESC_emf_heresy_241
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	trigger = {
		prisoner = no
		NOT = { trait = incapable }
	}
	
	option = {
		name = EXCELLENT
		hidden_tooltip = {
			character_event = { id = emf_heresy.243 days = 10 } # End festival
			character_event = { id = emf_heresy.245 days = 20 } # Clearing all flags and modifiers after feast
			character_event = { id = emf_heresy.247 days = 3 } # Singing of Hymns
			character_event = { id = emf_heresy.250 days = 5 } # Feast
			character_event = { id = emf_heresy.251 days = 7 } # Sermon
			any_courtier = {
				limit = {
					prisoner = no
					is_adult = yes
					is_ruler = no
					NOT = { trait = incapable }
					religion = manichean
				}
				set_character_flag = attending_bema_feast
				character_event = { id = emf_heresy.247 days = 3 } 
				character_event = { id = emf_heresy.250 days = 5 } 
				character_event = { id = emf_heresy.251 days = 7 } 
				character_event = { id = emf_heresy.245 days = 20 } # Clearing all flags and modifiers after feast
			}
		}
	}
}

# Vassal arrives at festival
character_event = {
	id = emf_heresy.242
	desc = EVTDESC_emf_heresy_242
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	trigger = {
		FROM = {
			NOT = { trait = incapable }
			prisoner = no
		}
	}
	
	option = {
		name = EXCELLENT
		hidden_tooltip = {
			character_event = { id = emf_heresy.247 days = 3 } # Singing of Hymns
			character_event = { id = emf_heresy.250 days = 5 } # Feast
			character_event = { id = emf_heresy.251 days = 7 } # Picture Book
		}
	}
}

# Festival is over - host
character_event = {
	id = emf_heresy.243
	desc = EVTDESC_emf_heresy_243
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
		prestige = 50
		piety = 50
		add_character_modifier = {
			name = held_bema_feast_timer
			duration = 1825
			hidden = yes
		}
		emf_can_disturb_effect = yes
		clr_character_flag = holding_bema_feast
		hidden_tooltip = {
			any_vassal = {
				limit = { has_character_flag = attending_bema_feast }
				character_event = { id = emf_heresy.244 }
			}
			any_courtier = {
				limit = {
					is_ruler = no
					has_character_flag = attending_bema_feast
				}
				character_event = { id = emf_heresy.244 }
			}
		}
	}
}

# Festival is over - guest
character_event = {
	id = emf_heresy.244
	desc = EVTDESC_emf_heresy_243
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
		opinion = {
			modifier = opinion_enjoyed_feast
			who = FROM
			years = 2
		}
		clr_character_flag = attending_bema_feast
		emf_can_disturb_effect = yes
	}
}

# Clear all character flags and modifiers - safety catch
character_event = {
	id = emf_heresy.245

	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		clr_character_flag = attending_bema_feast
		clr_character_flag = holding_bema_feast
	}
}

# Ruler begins the ritual fast
character_event = {
	id = emf_heresy.246
	desc = EVTDESC_emf_heresy_246
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	trigger = {
		prisoner = no
		NOT = { trait = incapable }
	}
	
	option = {
		name = EVTOPTA_emf_heresy_246
		piety = 20
		prestige = 20
		random_list = {
			15 = { health = -1 }
			15 = { health = -0.5 }
			30 = { add_trait = temperate } 
			40 = {} # No event
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_246
		piety = 5
		random_list = {
			15 = { health = -0.5 } 
			15 = { add_trait = temperate } 
			70 = {} # No event
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_246
		piety = -20
		random_list = {
			30 = { add_trait = gluttonous } 
			70 = {} # No event
		}
	}
}

# Singing of Hymns
character_event = {
	id = emf_heresy.247
	title = EVTNAME_emf_heresy_247
	desc = EVTDESC_emf_heresy_247
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	trigger = {
		prisoner = no
		NOT = { trait = incapable }
	}
	
	option = {
		name = EVTOPTA_emf_heresy_247
		piety = 10
		hidden_tooltip = {
			random_list = {
				10 = {
					modifier = {
						factor = 10
						trait = shy
					}
					modifier = {
						factor = 0
						OR = {
							diplomacy = 8
							trait = poet
							trait = gregarious
							trait = zealous
						}
					}
					custom_tooltip = { text = CANNOT_SING }
					if = {
						limit = { NOT = { trait = shy } }
						random = {
							chance = 30
							add_trait = shy
						}
					}
					prestige = -50
				}
				10 = {
					modifier = {
						factor = 2
						trait = poet
					}
					modifier = {
						factor = 0
						OR = {
							trait = zealous
							trait = cynical
						}
					}
					custom_tooltip = { text = TOUCHED_BY_BEAUTY }
					add_trait = zealous
				}
				100 = {} # No event
			}
		}
	}
}

# Feast
character_event = {
	id = emf_heresy.250
	title = EVTNAME_emf_heresy_250
	desc = EVTDESC_emf_heresy_250
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	trigger = {
		prisoner = no
		NOT = { trait = incapable }
	}
	
	option = {
		name = EVTOPTA_emf_heresy_250
		piety = 20
	}
}

# Read the Arzhang
character_event = {
	id = emf_heresy.251
	title = EVTNAME_emf_heresy_251
	desc = EVTDESC_emf_heresy_251
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	trigger = {
		prisoner = no
		NOT = { trait = incapable }
	}
	
	option = { 
		name = EVTOPTA_emf_heresy_251
		random_list = {
			5 = {
				modifier = {
					factor = 0
					OR = {
						trait = humble
						trait = proud
					}
				}
				add_trait = humble
			}
			5 = {
				modifier = {
					factor = 0
					OR = {
						trait = humble
						trait = proud
					}
				}
				add_trait = proud
			}
			5 = {
				modifier = {
					factor = 0
					OR = {
						trait = zealous
						trait = cynical
					}
				}
				add_trait = cynical
			}
			10 = {
				modifier = {
					factor = 0
					OR = {
						trait = zealous
						trait = cynical
					}
				}
				add_trait = zealous
			}
			10 = {
				modifier = {
					factor = 0.5
					trait = cynical
				}
				modifier = {
					factor = 2
					trait = zealous
				}
				change_learning = 1
			}
			30 = {
				piety = 20
			}
			100 = {
				# No effect
			}
		}
	}
}

#######################################
# MAZDAKI EVENTS
#######################################

# Babak and Banu 's Rebellion
province_event = {
	id = emf_heresy.255

	hide_window = yes

	trigger = {
		province_id = 658 #Hamadan
		year = 815
		kingdom = { culture = persian }
		owner = {
			top_liege = {
				has_landed_title = d_sunni
				NOT = { culture = persian }
			}
		}
		NOR = {
			year = 850
			has_global_flag = babak_and_banu
		}
	}
	
	mean_time_to_happen = {
		days = 100
	}
		
	immediate = {
		set_global_flag = babak_and_banu
		if = {
			limit = { has_province_modifier = cultural_unrest }
			remove_province_modifier = cultural_unrest
		}
		save_event_target_as = revolt_location
		owner = { top_liege = { save_event_target_as = revolt_top_liege } }
		kingdom = { save_event_target_as = revolt_kingdom }
		create_character = {
			random_traits = yes
			dynasty = 100639 #Khorramdin
			name = "Babak"
			religion = mazdaki
			culture = persian
			female = no
			age = 24
			health = 7
			attributes = {
				martial = 15
				learning = 7
				diplomacy = 12
			}
			trait = just
			trait = brave
			trait = gregarious
			trait = ambitious
			trait = zealous
			trait = skilled_tactician
			trait = unyielding_leader
			trait = holy_warrior
			trait = mountain_terrain_leader
			trait = peasant_leader
		}
		new_character = {
			save_event_target_as = nationalist_revolt_leader
			set_character_flag = nationalist_rebel
			prestige = 200
			wealth = 100
			opinion = {
				who = event_target:revolt_top_liege
				modifier = opinion_evil_tyrant
			}
			character_event = { id = emf_heresy.256 }
		}
	}
}

character_event = {
	id = emf_heresy.256
	
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		event_target:revolt_kingdom = {
			create_title = {
				tier = KING
				landless = yes
				temporary = yes
				culture = ROOT
				holder = ROOT
				base_title = THIS
				copy_title_laws = yes
				name = KHORRAMDIN_REBELLION
			}
		}
		event_target:revolt_location = {
			ROOT = {
				hidden_tooltip = {
					spawn_unit = {
						province = PREV
						home = PREV
						owner = THIS
						leader = THIS
						scaled_by_biggest_garrison = 2.4
						troops = {
							archers = { 6 6 }
							light_cavalry = { 3 3 }
							knights = { 1 1 }
							light_infantry = { 7 7 }
							heavy_infantry = { 3 3 }
						}
						cannot_inherit = yes
						attrition = 0.25
						maintenance_multiplier = 0
						earmark = nationalist_rebels
					}
				}
			}
		}
		create_character = {
			random_traits = yes
			dynasty = none
			name = "Banu"
			religion = ROOT
			culture = ROOT
			female = yes
			age = 19
			attributes = {
				martial = 15
				learning = 7
			}
			trait = just
			trait = brave
			trait = skilled_tactician
			trait = mountain_terrain_leader
			trait = peasant_leader
		}
		event_target:revolt_location = {
			new_character = {
				ROOT = {
					add_spouse = PREV
					add_lover = PREV
				}
				set_character_flag = special_marshal
				spawn_unit = {
					province = PREV
					home = PREV
					owner = ROOT
					leader = THIS
					scaled_by_biggest_garrison = 2.4
					troops = {
						archers = { 6 6 }
						light_cavalry = { 3 3 }
						knights = { 1 1 }
						light_infantry = { 7 7 }
						heavy_infantry = { 3 3 }
					}
					disband_on_peace = yes
					attrition = 0.25
					maintenance_multiplier = 0
					earmark = nationalist_rebels
				}
			}
		}		
		create_character = {
			random_traits = yes
			dynasty = none
			religion = ROOT
			culture = ROOT
			female = no
			age = 24
			attributes = {
				martial = 7
			}
			trait = peasant_leader
			trait = tough_soldier
		}
		event_target:revolt_location = {
			new_character = {
				opinion = { who = ROOT modifier = opinion_loyal_servant years = 20 }
				spawn_unit = {
					province = PREV
					home = PREV
					owner = ROOT
					leader = THIS
					scaled_by_biggest_garrison = 2.0
					troops = {
						archers = { 6 6 }
						light_cavalry = { 3 3 }
						knights = { 1 1 }
						light_infantry = { 7 7 }
						heavy_infantry = { 3 3 }
					}
					disband_on_peace = yes
					attrition = 0.25
					maintenance_multiplier = 0
					earmark = nationalist_rebels
				}
			}
		}
		create_character = {
			random_traits = yes
			dynasty = none
			religion = ROOT
			culture = ROOT
			female = no
			age = 24
			attributes = {
				martial = 7
			}
			trait = peasant_leader
			trait = tough_soldier
		}
		event_target:revolt_location = {
			new_character = {
				opinion = { who = ROOT modifier = opinion_loyal_servant years = 20 }
				spawn_unit = {
					province = PREV
					home = PREV
					owner = ROOT
					leader = THIS
					scaled_by_biggest_garrison = 2.0
					troops = {
						archers = { 6 6 }
						light_cavalry = { 3 3 }
						knights = { 1 1 }
						light_infantry = { 7 7 }
						heavy_infantry = { 3 3 }
					}
					disband_on_peace = yes
					attrition = 0.25
					maintenance_multiplier = 0
					earmark = nationalist_rebels
				}
			}
		}		
		event_target:revolt_location = {
			event_target:revolt_top_liege = {
				set_character_flag = has_current_revolt
				reverse_war = {
					target = ROOT
					casus_belli = liberation_revolt
					thirdparty_title = PREV # The county...
					tier = KING # ... but really the de jure kingdom
				}
			}
		}
		hidden_tooltip = {
			event_target:revolt_top_liege = {
				narrative_event = { id = emf_heresy.257 }
			}
		}
	}
}

# Caliph informed of the rebellion
narrative_event = {
	id = emf_heresy.257
	title = EVTNAME_emf_heresy_257
	desc = EVTDESC_emf_heresy_257
	picture = GFX_evt_moors
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	major = yes
	
	major_trigger = {
		OR = {
			has_landed_title = d_sunni
			same_realm = ROOT
			religion_group = zoroastrian_group
			culture = persian
			capital_scope = {
				NOT = {
					distance = {
						where = 658 # Hamadan
						value = 600	# Same part of the world
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_257
		trigger = {
			has_landed_title = d_sunni
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_257
		trigger = {
			NOT = { has_landed_title = d_sunni }
			culture = persian
		}
	}
	option = {
		name = I_SEE
		trigger = {
			NOT = { has_landed_title = d_sunni }
			NOT = { culture = persian }
		}
	}
}

# Mazdaki priesthood created
narrative_event = {
	id = emf_heresy.258
	title = EVTNAME_emf_heresy_258
	desc = EVTDESC_emf_heresy_258
	picture = GFX_evt_zoroaster
	border = GFX_event_narrative_frame_religion

	major = yes
	show_ROOT = yes
	hide_from = yes
	is_triggered_only = yes
	
	immediate = {
		random_realm_lord = {
			limit = {
				in_revolt = no
				pf_war_trait_trigger = no
				religion = mazdaki
				capital_holding = { is_holy_site = ROOT }
				prisoner = no
				NOT = { trait = incapable }
			}
			d_mazdaki = { grant_title = PREV }
			set_defacto_liege = ROOT
			emf_liege_change_effect = yes
			save_event_target_as = new_mazdaki_leader
			break = yes
		}
		random_realm_lord = {
			limit = {
				in_revolt = no
				pf_war_trait_trigger = no
				religion = mazdaki
				capital_holding = { holding_type = temple }
				prisoner = no
				NOT = { trait = incapable }
				NOT = { trait = bad_priest_zoroastrian }
			}
			d_mazdaki = { grant_title = PREV }
			set_defacto_liege = ROOT
			emf_liege_change_effect = yes
			save_event_target_as = new_mazdaki_leader
			ROOT = {
				random_realm_title = {
					limit = { is_holy_site = ROOT }
					gain_title = PREVPREV
				}
			}
			break = yes
		}
		create_random_priest = {
			random_traits = yes
			dynasty = random
			religion = mazdaki
			culture = ROOT
			age = 40
			health = 7
			trait = quick
			trait = zealous
			trait = scholar
			trait = mastermind_theologian
			attributes = {
				learning = 5
				diplomacy = 5
				martial = 2
				stewardship = 5
				intrigue = 5
			}
		}
		new_character = {
			d_mazdaki = { grant_title = PREV }
			set_defacto_liege = ROOT
			emf_liege_change_effect = yes
			save_event_target_as = new_mazdaki_leader
			ROOT = {
				random_realm_title = {
					limit = { is_holy_site = ROOT }
					gain_title = PREVPREV
				}
			}
		}
	}	
	
	option = {
		name = I_SEE
		trigger = {
			NOT = { religion = mazdaki }
		}
		event_target:new_mazdaki_leader = { }
	}
	option = {
		name = EVTOPTA_emf_heresy_258
		trigger = { religion = mazdaki }
		event_target:new_mazdaki_leader = { }
	}
}

# Mazdaki Power chosen
character_event = {
	id = emf_heresy.259
	desc = EVTDESC_emf_heresy_259
	picture = GFX_evt_knight_kneeling
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_259
		add_character_modifier = {
			name = patron_discernment
			duration = -1
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_259
		add_character_modifier = {
			name = patron_understanding
			duration = -1
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_259
		add_character_modifier = {
			name = patron_preservation
			duration = -1
		}
	}
	option = {
		name = EVTOPTD_emf_heresy_259
		add_character_modifier = {
			name = patron_joy
			duration = -1
		}
	}
}

#######################################
# YAZIDI EVENTS
#######################################

# PEACOCK FEAST EVENTS

# Invite vassals to festival
character_event = {
	id = emf_heresy.260
	desc = EVTDESC_emf_heresy_260
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion

	only_rulers = yes
	min_age = 16
	only_capable = yes
	prisoner = no
	has_character_flag = planning_peacock_feast
	
	trigger = {
		war = no
		NOT = { month = 5 }
		month = 10
		emf_can_disturb_trigger = yes
		NOT = { trait = in_hiding }
	}
	
	mean_time_to_happen = {
		days = 1
	}

	option = {
		name = EVTOPTA_emf_heresy_260
		clr_character_flag = planning_peacock_feast
		set_character_flag = holding_peacock_feast
		any_vassal = {
			limit = {
				religion = yazidi
				prisoner = no
				NOT = { trait = incapable }
				emf_can_disturb_trigger = yes
				war = no
				is_adult = yes
			}
			letter_event = { id = emf_heresy.261 tooltip = EVTTOOLTIP1_RoI_1000 } #send out invitations
		}
		hidden_tooltip = {
			character_event = { id = emf_heresy.264 days = 12 } # start the feast
			emf_do_not_disturb_effect = yes
		}
		emf_stop_hiding_effect = yes
	}
}

# Vassal receives invitation
letter_event = {
	id = emf_heresy.261
	desc = EVTDESC_emf_heresy_261
	border = GFX_event_letter_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TOG_701 #Travel to the feast
		set_character_flag = attending_peacock_feast
		hidden_tooltip = {
			character_event = { id = emf_heresy.263 days = 12 } #Arrives at the feast
			emf_do_not_disturb_effect = yes
		}
		emf_stop_hiding_effect = yes
	}
}

# Vassal arrives at festival
character_event = {
	id = emf_heresy.263
	desc = EVTDESC_emf_heresy_263
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	trigger = {
		liege = { has_character_flag = holding_peacock_feast }
	}		
	
	option = {
		name = EVTOPTA_emf_heresy_263
		hidden_tooltip = {
			character_event = { id = emf_heresy.265 days = 5 } #Presentation of the Senjaq
			character_event = { id = emf_heresy.270 days = 10 } #Veneration of the Senjaq
			character_event = { id = emf_heresy.271 days = 15 } #Taxes on the Pious
			character_event = { id = emf_heresy.272 days = 20 } #Sermon
			character_event = { id = emf_heresy.273 days = 30 } #End festival
		}
	}
}

# Festival begins
character_event = {
	id = emf_heresy.264
	desc = EVTDESC_emf_heresy_264
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	trigger = {
		has_character_flag = holding_peacock_feast
	}
	
	option = {
		name = EVTOPTA_emf_heresy_263
		hidden_tooltip = {
			character_event = { id = emf_heresy.265 days = 5 } #Presentation of the Senjaq
			character_event = { id = emf_heresy.270 days = 10 } #Veneration of the Senjaq
			character_event = { id = emf_heresy.271 days = 15 } #Taxes on the Pious
			character_event = { id = emf_heresy.272 days = 20 } #Sermon
			character_event = { id = emf_heresy.273 days = 30 } #End festival
		}
	}
}

# Presentation of the Senjaq
character_event = {
	id = emf_heresy.265
	title = EVTNAME_emf_heresy_265
	desc = EVTDESC_emf_heresy_265
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	trigger = {
		OR = {
			has_character_flag = holding_peacock_feast
			liege = { has_character_flag = holding_peacock_feast }
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_265
		trigger = { is_female = no }
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				trait = brave
			}
			modifier = {
				factor = 2
				is_strong_trigger = yes
			}
			modifier = {
				factor = 3
				trait = zealous
			}
			modifier = {
				factor = 0.1
				is_ill = yes
			}
			modifier = {
				factor = 0.5
				age = 50
			}
		}
		piety = 30
		hidden_tooltip = {
			random_list = {
				10 = {
					modifier = {
						factor = 0
						NOR = {
							age = 50
							is_weak_trigger = yes
							trait = infirm
							health_traits = 1
						}
					}
					character_event = { id = emf_heresy.266 tooltip = SENJAQ_DROPPED }  # Drop the senjaq
				}
				10 = {
					modifier = {
						factor = 0
						OR = {
							trait = possessed
							NOT = { trait = zealous }
						}
					}
					character_event = { id = emf_heresy.267 tooltip = SENJAQ_POSSESSED } # Character becomes possessed
				}
				10 = {
					modifier = {
						factor = 0
						OR = {
							trait = cynical
							trait = zealous
						}
					}
					character_event = { id = emf_heresy.268 tooltip = SENJAQ_ZEALOUS } # Character becomes zealous
				}
				10 = {
					modifier = {
						factor = 0
						OR = {
							is_strong_trigger = yes
							trait = slothful
							health_traits = 1
							is_ill = yes
						}
					}
					character_event = { id = emf_heresy.269 tooltip = SENJAQ_STRONGER } # Character becomes stronger
				}
				300 = {} # No event
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_265
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				trait = craven
			}
			modifier = {
				factor = 2
				is_weak_trigger = yes
			}
			modifier = {
				factor = 3
				trait = cynical
			}
			modifier = {
				factor = 4
				NOT = { piety = 100 }
			}
		}
		piety = 10
	}
}

# Weak or old character drops the senjaq
character_event = {
	id = emf_heresy.266
	desc = EVTDESC_emf_heresy_266
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_266
		prestige = -100
		piety = -50
	}
}

# Character becomes possessed by senjaq
character_event = {
	id = emf_heresy.267
	desc = EVTDESC_emf_heresy_267
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_267
		add_trait = possessed
	}
}

# Character becomes zealous
character_event = {
	id = emf_heresy.268
	desc = EVTDESC_emf_heresy_268
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_268
		add_trait = zealous
	}
}

# Character becomes stronger
character_event = {
	id = emf_heresy.269
	desc = EVTDESC_emf_heresy_269
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_269
		if = {
			limit = {
				is_weak_trigger = no
				is_strong_trigger = no
			}
			add_trait = robust
		}
		if = {
			limit = { is_weak_trigger = yes }
			remove_trait = weak
			remove_trait = feeble
		}
	}
}

# Veneration of the Senjaq
character_event = {
	id = emf_heresy.270
	title = EVTNAME_emf_heresy_270
	desc = EVTDESC_emf_heresy_270
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	trigger = {
		OR = {
			has_character_flag = holding_peacock_feast
			liege = { has_character_flag = holding_peacock_feast }
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_270
		piety = 10
		random_list = {
			30 = {
				modifier = {
					factor = 0
					OR = {
						trait = humble
						trait = proud
					}
				}
				add_trait = humble
			}
			30 = {
				modifier = {
					factor = 0
					OR = {
						trait = temperate
						trait = gluttonous
					}
				}
				add_trait = temperate
			}
			20 = {
				prestige = 25
			}
			40 = {
			}
		}
	}
}

# Donation of Money
character_event = {
	id = emf_heresy.271
	title = EVTNAME_emf_heresy_271
	desc = EVTDESC_emf_heresy_271
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	trigger = {
		controls_religion = no
		OR = {
			has_character_flag = holding_peacock_feast
			liege = { has_character_flag = holding_peacock_feast }
		}
	}
	
	option = { # GIVE A LOT
		name = EVTOPTA_emf_heresy_271
		trigger = {
			NOT = { trait = greedy }
			NOT = { trait = cynical }
		}
		piety = 50
		if = {
			limit = { religion_head = { always = yes } }
			religion_head = {
				ROOT = { transfer_scaled_wealth = { to = PREV value = 0.25 } }
			}
		}
		if = {
			limit = { NOT = { religion_head = { always = yes } } }
			scaled_wealth = -0.25
		}
		add_trait = charitable
	}
	option = { # GIVE SOME
		name = EVTOPTB_emf_heresy_271
		piety = 10
		if = {
			limit = { religion_head = { always = yes } }
			religion_head = {
				ROOT = { transfer_scaled_wealth = { to = PREV value = 0.05 } }
			}
		}
		if = {
			limit = { NOT = { religion_head = { always = yes } } }
			scaled_wealth = -0.05
		}
		if = {
			limit = { trait = charitable }
			remove_trait = charitable
		}
	}
	option = { # BUGGER THAT
		name = EVTOPTC_emf_heresy_271
		trigger = {
			NOT = { trait = charitable }
			NOT = { trait = zealous }
		}
		piety = -25
		if = {
			limit = {
				NOT = { trait = greedy }
			}
			random = {
				chance = 25
				add_trait = greedy
			}
		}
		if = {
			limit = {
				NOT = { trait = cynical }
			}
			random = {
				chance = 25
				add_trait = cynical
			}
		}
	}
}

# Sermon - host and guests
character_event = {
	id = emf_heresy.272
	desc = EVTDESC_emf_heresy_272
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	trigger = {
		OR = {
			has_character_flag = holding_peacock_feast
			liege = { has_character_flag = holding_peacock_feast }
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_272
	}
}

# Festival ends
character_event = {
	id = emf_heresy.273
	desc = EVTDESC_emf_heresy_273
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	trigger = {
		OR = {
			has_character_flag = holding_peacock_feast
			liege = { has_character_flag = holding_peacock_feast }
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_273
		trigger = { has_character_flag = holding_peacock_feast }
		set_character_flag = held_recent_feast
		clr_character_flag = holding_peacock_feast
		hidden_tooltip = { emf_can_disturb_effect = yes }
	}
	option = {
		name = EVTOPTA_emf_heresy_273
		trigger = { NOT = { has_character_flag = holding_peacock_feast } }
		clr_character_flag = attending_peacock_feast
		hidden_tooltip = { emf_can_disturb_effect = yes }
		liege = {
			reverse_opinion = {
				modifier = opinion_enjoyed_feast
				who = ROOT
				years = 2
			}
		}
	}
}

# The feast is cancelled due to war
character_event = {
	id = emf_heresy.274
	desc = EVTDESC72112
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion

	only_rulers = yes
	religion = yazidi

	trigger = {
		war = yes
		OR = {
			has_character_flag = holding_peacock_feast
			has_character_flag = planning_peacock_feast
		}
	}

	mean_time_to_happen = {
		days = 1
	}

	option = {
		name = EVTOPTA72112
		if = {
			limit = { has_character_flag = planning_peacock_feast }
			clr_character_flag = planning_peacock_feast
			scaled_wealth = 0.25
		}
		hidden_tooltip = {
			clr_character_flag = holding_peacock_feast
			set_character_flag = held_recent_feast
			emf_can_disturb_effect = yes
		}
		any_vassal = {
			limit = { has_character_flag = attending_peacock_feast }
			letter_event = {
				id = emf_heresy.275
				tooltip = EVTTOOLTIP72113
			}
			hidden_tooltip = {
				emf_can_disturb_effect = yes
				clr_character_flag = attending_peacock_feast
			}
		}
	}
}

# Feast cancelled: notify invited vassals
letter_event = {
	id = emf_heresy.275
	desc = EVTDESC72113
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA72113
	}
}

# The feast is cancelled due to death of liege
character_event = {
	id = emf_heresy.276
	
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		OR = {
			has_character_flag = holding_peacock_feast
			has_character_flag = planning_peacock_feast
		}
	}

	immediate = {
		if = {
			limit = { has_character_flag = planning_peacock_feast }
			clr_character_flag = planning_peacock_feast
			scaled_wealth = 0.25
		}
		hidden_tooltip = {
			clr_character_flag = holding_peacock_feast
			emf_can_disturb_effect = yes
		}
		any_vassal = {
			limit = { has_character_flag = attending_peacock_feast }
			character_event = { id = emf_heresy.277 }
			hidden_tooltip = {
				emf_can_disturb_effect = yes
				clr_character_flag = attending_peacock_feast
			}
		}
	}
}

# Feast cancelled: notify invited vassals
character_event = {
	id = emf_heresy.277
	desc = EVTDESC_emf_heresy_277
	picture = GFX_evt_death
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_emf_heresy_277
	}
}

### KOASASA EVENTS

# Yazidi youth is believed to be a koasasa
narrative_event = {
	id = emf_heresy.278
	title = EVTNAME_emf_heresy_278
	picture = GFX_evt_imam
	border = GFX_event_narrative_frame_religion
	
	desc = {
		text = EVTDESC_emf_heresy_278_taus
		trigger = { ROOT = { trait = koasasa_taus } }
	}
	desc = {
		text = EVTDESC_emf_heresy_278_israfel
		trigger = { ROOT = { trait = koasasa_israfel } }
	}
	desc = {
		text = EVTDESC_emf_heresy_278_azrael
		trigger = { ROOT = { trait = koasasa_azrael } }
	}
	desc = {
		text = EVTDESC_emf_heresy_278_mihael
		trigger = { ROOT = { trait = koasasa_mihael } }
	}
	desc = {
		text = EVTDESC_emf_heresy_278_dardael
		trigger = { ROOT = { trait = koasasa_dardael } }
	}
	desc = {
		text = EVTDESC_emf_heresy_278_samael
		trigger = { ROOT = { trait = koasasa_samael } }
	}
	desc = {
		text = EVTDESC_emf_heresy_278_nurael
		trigger = { ROOT = { trait = koasasa_nurael } }
	}
	
	major = yes
	hide_from = yes
	show_ROOT = yes
	
	only_men = yes
	min_age = 15
	max_age = 20
	prisoner = no
	capable_only = yes
	religion = yazidi
	
	trigger = {
		is_reincarnated = no
		calc_true_if = {
			amount = 2
			trait = possessed
			is_smart_trigger = yes
			trait = fair
			martial = 15
			martial = 20
			diplomacy = 15
			stewardship = 15
			intrigue = 15
			learning = 15
		}
		NOR = {
			trait = cynical
			trait = inbred
			is_dumb_trigger = yes
			is_weak_trigger = yes
			trait = clubfooted
			trait = harelip
			trait = hunchback
			trait = lisp
			trait = stutter
			trait = ugly
			trait = dwarf
		}
		OR = {
			NOT = { koasasa_taus = { is_alive = yes } }
			NOT = { koasasa_israfel = { is_alive = yes } }
			NOT = { koasasa_azrael = { is_alive = yes } }
			NOT = { koasasa_mihael = { is_alive = yes } }
			NOT = { koasasa_dardael = { is_alive = yes } }
			NOT = { koasasa_samael = { is_alive = yes } }
			NOT = { koasasa_nurael = { is_alive = yes } }
		}
	}
	
	major_trigger = {
		religion = yazidi
		same_realm = ROOT	
	}
	
	mean_time_to_happen = {
		months = 1200
		modifier = {
			factor = 0.5
			ai = no
		}
		modifier = {
			factor = 1.25
			NOR = {
				martial = 15
				diplomacy = 15
				stewardship = 15
				intrigue = 15
				learning = 15
			}
		}
		modifier = {
			factor = 0.75
			trait = zealous
		}
		modifier = {
			factor = 0.5
			trait = possessed
		}
		modifier = {
			factor = 0.5
			NOT = { koasasa_taus = { is_alive = yes } }
			NOT = { koasasa_israfel = { is_alive = yes } }
			NOT = { koasasa_azrael = { is_alive = yes } }
			NOT = { koasasa_mihael = { is_alive = yes } }
			NOT = { koasasa_dardael = { is_alive = yes } }
			NOT = { koasasa_samael = { is_alive = yes } }
			NOT = { koasasa_nurael = { is_alive = yes } }
		}
		modifier = {
			factor = 0.5
			calc_true_if = {
				amount = 3
				trait = possessed
				is_smart_trigger = yes
				trait = fair
				martial = 15
				martial = 20
				diplomacy = 15
				stewardship = 15
				intrigue = 15
				learning = 15
			}
		}
		modifier = {
			factor = 0.25
			calc_true_if = {
				amount = 4
				trait = possessed
				is_smart_trigger = yes
				trait = fair
				martial = 15
				martial = 20
				diplomacy = 15
				stewardship = 15
				intrigue = 15
				learning = 15
			}
		}
	}
	
	immediate = {
		ROOT = {
			random_list = {
				10 = {
					modifier = {
						factor = 0
						koasasa_taus = { is_alive = yes }
					}
					add_trait = koasasa_taus
				}
				10 = {
					modifier = {
						factor = 0
						koasasa_israfel = { is_alive = yes }
					}
					add_trait = koasasa_israfel
				}
				10 = {
					modifier = {
						factor = 0
						koasasa_azrael = { is_alive = yes }
					}
					add_trait = koasasa_azrael
				}
				10 = {
					modifier = {
						factor = 0
						koasasa_mihael = { is_alive = yes }
					}
					add_trait = koasasa_mihael
				}
				10 = {
					modifier = {
						factor = 0
						koasasa_dardael = { is_alive = yes }
					}
					add_trait = koasasa_dardael
				}
				10 = {
					modifier = {
						factor = 0
						koasasa_samael = { is_alive = yes }
					}
					add_trait = koasasa_samael
				}
				10 = {
					modifier = {
						factor = 0
						koasasa_nurael = { is_alive = yes }
					}
					add_trait = koasasa_nurael
				}
			}
		}			
	}
	
	option = {
		name = EVTOPTA_emf_heresy_278
		trigger = { character = ROOT }
		piety = 250
	}
	option = {
		name = EVTOPTB_emf_heresy_278
		trigger = { NOT = { character = ROOT } }
	}
}

# YAZIDI PILGRIMAGE EVENTS

# Preparing for the pilgrimage
character_event = {
	id = emf_heresy.279
	desc = EVTDESC_emf_heresy_279
	picture = GFX_evt_council
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes

	option = {
		name = EVTOPTA_SoA_5016 #I will start making travel plans
		set_character_flag = pilgrimage_to_lalish
		hidden_tooltip = {
			character_event = { id = emf_heresy.280 days = 15 }
			emf_do_not_disturb_effect = yes
		}
		if = {
			limit = { ai = no }
			chronicle = {
				entry = CHRONICLE_PILGRIMAGE_TO_LALISH
				picture = GFX_evt_pilgrims_epic_journey
			}
		}
	}
}

# Setting out for Lalish (also selects events for road)
character_event = {
	id = emf_heresy.280
	desc = EVTDESC_emf_heresy_280
	picture = GFX_evt_carriage
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SoA_5022 #My journey begins!
		clr_character_flag = preparing_yazidi_pilgrimage
		hidden_tooltip = {
			add_trait = on_pilgrimage
			set_character_flag = good_pilgrimage
			narrative_event = { id = emf_heresy.281 days = 30 }
		}
		hidden_tooltip = {
			if = {
				limit = {
					location = {
						distance = {
							where = 697	# Mosul
							value = 600	# Even Longer journey
						}
					}
				}
				random_list = {
					10 = {  character_event = { id = SoA.5026 days = 5 random = 4 } } # List for even longer journeys only
					10 = {  character_event = { id = SoA.5027 days = 5 random = 4 } }
					10 = {  narrative_event = { id = SoA.5028 days = 5 random = 4 } }
					10 = {  character_event = { id = SoA.5029 days = 5 random = 4 } }
					10 = {  character_event = { id = SoA.5030 days = 5 random = 4 } }
				}
			}
			
			if = {
				limit = {
					location = {
						distance = {
							where = 697	# Mosul
							value = 400	# Longer journey
						}
					}
				}
				random_list = {
					10 = {  character_event = { id = SoA.5026 days = 10 random = 5 } } # List for longer journeys only
					10 = {  character_event = { id = SoA.5027 days = 10 random = 5 } }
					10 = {  narrative_event = { id = SoA.5028 days = 10 random = 5 } }
					10 = {  character_event = { id = SoA.5029 days = 10 random = 5 } }
					10 = {  character_event = { id = SoA.5030 days = 10 random = 5 } }
				}
			}
	
			random_list = {
				10 = {  character_event = { id = SoA.5031 days = 16 random = 6 } } # List that is always checked
				10 = {  character_event = { id = SoA.5032 days = 16 random = 6 } }
				10 = {  narrative_event = { id = SoA.5033 days = 16 random = 6 } }
				10 = {  character_event = { id = SoA.5034 days = 16 random = 6 } }
				10 = {  character_event = { id = SoA.5035 days = 16 random = 6 } }
				10 = {  character_event = { id = SoA.5036 days = 16 random = 6 } }
				10 = {  character_event = { id = SoA.5037 days = 16 random = 6 } }
				10 = {  character_event = { id = SoA.5038 days = 16 random = 6 } }
				10 = {  character_event = { id = SoA.5039 days = 16 random = 6 } }
			}
		}
	}
}

# Arrived at Lalish (also selects events while in the city)
narrative_event = {
	id = emf_heresy.281
	title = EVTNAME_emf_heresy_281
	desc = EVTDESC_emf_heresy_281
	picture = GFX_evt_yazidi
	border = GFX_event_narrative_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			10 = {
				if = {
					limit = { NOT = { trait = cynical } }
					character_event = { id = SoA.5056 }   # Stimulated to learning
				}
				if = {
					limit = { trait = cynical }
					random_list = {
						20 = { character_event = { id = SoA.5057 } }  # Strong religious experience
						10 = { character_event = { id = SoA.5058 } }  # Disappointed in the place
						20 = { character_event = { id = SoA.5060 } }  # Learns things of the world - cosmopolitan
						20 = { character_event = { id = SoA.5061 } }  # Generally impressed
					}
				}
			}
			10 = {
				if = {
					limit = {
						OR = {
							trait = mastermind_theologian
							trait = scholarly_theologian
						}
					}
					character_event = { id = SoA.5059 }  # Mastermind theologian impresses everyone
				}
				if = {
					limit = {
						NOT = { trait = mastermind_theologian }
						NOT = { trait = scholarly_theologian }
					}
					random_list = {
						20 = { character_event = { id = SoA.5057 } }  # Strong religious experience
						10 = { character_event = { id = SoA.5058 } }  # Disappointed in the place
						20 = { character_event = { id = SoA.5060 } }  # Learns things of the world - cosmopolitan
						20 = { character_event = { id = SoA.5061 } }  # Generally impressed
					}
				}
			}
			10 = {
				if = {
					limit = { trait = lustful }
					character_event = { id = SoA.5062 }    # Lustful tourist having fun
				}
				if = {
					limit = { NOT = { trait = lustful }	}
					random_list = {
						20 = { character_event = { id = SoA.5057 } }  # Strong religious experience
						10 = { character_event = { id = SoA.5058 } }  # Disappointed in the place
						20 = { character_event = { id = SoA.5060 } }  # Learns things of the world - cosmopolitan
						20 = { character_event = { id = SoA.5061 } }  # Generally impressed
					}
				}
			}
			10 = {
				if = {
					limit = { trait = homosexual }
					character_event = { id = SoA.5063 }    # Freedom
				}
				if = {
					limit = { NOT = { trait = homosexual } }
					random_list = {
						20 = {  character_event = { id = SoA.5057 } }  # Strong religious experience
						10 = {  character_event = { id = SoA.5058 } }  # Disappointed in the place
						20 = {  character_event = { id = SoA.5060 } }  # Learns things of the world - cosmopolitan
						20 = {  character_event = { id = SoA.5061 } }  # Generally impressed
					}
				}
			}
			10 = {                  # Monks cure pilgrim of disease - attributed to God's hand?
				if = {
					limit = {
						OR = {
							trait = ill
							trait = pneumonic
							trait = syphilitic
						}
					}
					narrative_event = { id = SoA.5064 }
				}
				if = {
					limit = {
						NOR = {
							trait = ill
							trait = pneumonic
							trait = syphilitic							
						}
					}
					random_list = {
						20 = {  character_event = { id = SoA.5057 } }  # Strong religious experience
						10 = {  character_event = { id = SoA.5058 } }  # Disappointed in the place
						20 = {  character_event = { id = SoA.5060 } }  # Learns things of the world - cosmopolitan
						20 = {  character_event = { id = SoA.5061 } }  # Generally impressed
					}
				}
			}
			10 = {
				if = {
					limit = {
						OR = {
							trait = lunatic
							trait = possessed
						}
					}
					character_event = { id = SoA.5065 }  # Lunatic/possessed decides (s)he is God
				}
				if = {
					limit = {
						NOR = {
							trait = lunatic
							trait = possessed							
						}
					}
					random_list = {
						20 = {  character_event = { id = SoA.5057 } }  # Strong religious experience
						10 = {  character_event = { id = SoA.5058 } }  # Disappointed in the place
						20 = {  character_event = { id = SoA.5060 } }  # Learns things of the world - cosmopolitan
						20 = {  character_event = { id = SoA.5061 } }  # Generally impressed
					}
				}
			}
			10 = {
				if = {
					limit = {
						OR = {
							trait = drunkard
							trait = hedonist
						}
					}
					character_event = { id = SoA.5066 }  # Drunkard/hedonist event
				}
				if = {
					limit = {
						NOR = {
							trait = drunkard
							trait = hedonist
						}
					}
					random_list = {
						20 = {  character_event = { id = SoA.5057 } }  # Strong religious experience
						10 = {  character_event = { id = SoA.5058 } }  # Disappointed in the place
						20 = {  character_event = { id = SoA.5060 } }  # Learns things of the world - cosmopolitan
						20 = {  character_event = { id = SoA.5061 } }  # Generally impressed
					}
				}
			}
		}
	}

	option = {
		name = EVTOPTA_emf_heresy_281
		if = {
			limit = { trait = decadent }
			remove_trait = decadent
		}	
	}
}

# Good pilgrimage
character_event = {
	id = emf_heresy.282
	desc = EVTDESC_SoA_5091
	picture = GFX_evt_castle_construction
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SoA_5091 #A great experience!
		clr_character_flag = pilgrimage_to_lalish
		clr_character_flag = good_pilgrimage
		add_trait = yazidi_pilgrim
		hidden_tooltip = { remove_trait = on_pilgrimage }
		piety = 30
	}
}

# Disappointing pilgrimage
character_event = {
	id = emf_heresy.283
	desc = EVTDESC_SoA_5092
	picture = GFX_evt_castle_construction
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SoA_5092 #I won't tell my family what really happened out there
		clr_character_flag = pilgrimage_to_lalish
		clr_character_flag = bad_pilgrimage
		add_trait = yazidi_pilgrim
		hidden_tooltip = { remove_trait = on_pilgrimage }
		piety = -10
		if = {
			limit = { NOT = { trait = cynical } }
			random = {
				chance = 20
				add_trait = cynical
			}
		}
	}
}

# Abominable pilgrimage - very unusual outcome
character_event = {
	id = emf_heresy.284
	desc = EVTDESC_SoA_5093
	picture = GFX_evt_lunatic
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SoA_5093
		clr_character_flag = pilgrimage_to_lalish
		clr_character_flag = abominable_pilgrimage
		add_trait = yazidi_pilgrim
		hidden_tooltip = { remove_trait = on_pilgrimage }
		piety = -100
		if = {
			limit = { NOT = { trait = cynical } }
			random = {
				chance = 50
				add_trait = cynical
			}
		}
	}
}


#######################################
# NEW SUNNI EVENTS
#######################################

# Option to change regnal name as Sunni Caliph
character_event = {
	id = emf_heresy.1799
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		FROM = { title = d_sunni }
		NOR = { 
			has_character_flag = d_sunni_regnal_name 
			has_character_flag = d_sunni_regnal_name_history_exception 
		}
	}
	
	immediate = {
		character_event = { id = emf_heresy.1800 days = 1 }
	}
}

character_event = {
	id = emf_heresy.1800
	title = EVTNAME_emf_heresy_1800
	desc = EVTDESC_emf_heresy_1800
	picture = GFX_evt_caliph
	
	is_triggered_only = yes
	
	trigger = {
		has_landed_title = FROMFROM
	}
	
	immediate = { set_character_flag = d_sunni_regnal_name }
	
	option = {
		name = EVTOPTA_emf_heresy_1800 # I will keep my name
		trigger = { ai = no }
	}
	option = {
		name = EVTOPTB_emf_heresy_1800 # I will choose a new name
		custom_tooltip = {
			text = SELECT_REGNAL_NAME
			hidden_tooltip = {
				character_event = { id = emf_heresy.1801 }
			}
		}
	}
}

# List of regnal name options
character_event = {
	id = emf_heresy.1801
	title = EVTNAME_emf_heresy_1800
	desc = EVTDESC_emf_heresy_1801
	picture = GFX_evt_caliph
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_1801 # Actually, I do prefer my own name
		trigger = { ai = no }
		d_sunni = {
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Mustansir } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = temperate
				trait = slothful
				trait = indolent
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Mustansir
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Mustansir"
	}
	option = {
		name = EVTOPTC_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Mustamsik } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = kind
				trait = patient
				trait = slothful
				trait = affectionate
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Mustamsik
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Mustamsik"
	}
	option = {
		name = EVTOPTD_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Hakim } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = scholar
				trait = theologian
				trait = mystic
				trait = curious
				trait = erudite
				learning = 12
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Hakim
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Hakim"
	}
	option = {
		name = EVTOPTE_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Mustasim } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = celibate
				trait = humble
				trait = chaste
				trait = timid
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Mustasim
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Musta'sim"
	}
	option = {
		name = EVTOPTF_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Zahir } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = proud
				trait = arbitrary
				trait = haughty
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Zahir
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Zahir"
	}
	option = {
		name = EVTOPTG_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Nasir } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = wroth
				trait = greedy
				trait = ambitious
				trait = zealous
				trait = idolizer
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Nasir
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Nasir"
	}
	option = {
		name = EVTOPTH_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Mustadi } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = sympathy_christendom
				trait = sympathy_pagans
				trait = sympathy_zoroastrianism
				trait = sympathy_judaism
				trait = sympathy_indian
				trait = curious
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Mustadi
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Mustadi"
	}
	option = {
		name = EVTOPTI_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Mustanjid } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = humble
				trait = cynical
				trait = curious
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Mustanjid
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Mustanjid"
	}
	option = {
		name = EVTOPTJ_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Muqtafi } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = zealous
				trait = trusting
				trait = craven
				trait = idolizer
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Muqtafi
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Muqtafi"
	}
	option = {
		name = EVTOPTK_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Rashid } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = just
				trait = kind
				trait = scholar
				trait = brooding
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Rashid
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Rashid"
	}
	option = {
		name = EVTOPTL_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Mustarshid } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = content
				trait = slothful
				trait = temperate
				trait = conscientious
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Mustarshid
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Mustarshid"
	}
	option = {
		name = EVTOPTM_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Mustazhir } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = scholar
				trait = theologian
				trait = mystic
				trait = erudite
				trait = curious
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Mustazhir
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Mustazhir"
	}
	option = {
		name = EVTOPTN_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Muqtadi } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = zealous
				trait = arbitrary
				trait = content
				trait = haughty
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Muqtadi
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Muqtadi"
	}
	option = {
		name = EVTOPTO_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Qaim } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = ambitious
				trait = cynical
				trait = arbitrary
				trait = willful
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Qaim
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Qa'im"
	}
	option = {
		name = EVTOPTP_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Qadir } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = paranoid
				trait = cruel
				trait = ambitious
				trait = proud
				trait = haughty
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Qadir
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Qadir"
	}
	option = {
		name = EVTOPTQ_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Tai } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = trusting
				trait = diligent
				trait = fussy
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Tai
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Ta'i"
	}
	option = {
		name = EVTOPTR_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Muti } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = shy
				trait = envious
				trait = honest
				trait = rowdy
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Muti
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Muti"
	}
	option = {
		name = EVTOPTS_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Mustakfi } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = greedy
				trait = gluttonous
				trait = temperate
				trait = fussy
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Mustakfi
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Mustakfi"
	}
	option = {
		name = EVTOPTT_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Muttaqi } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = craven
				trait = zealous
				trait = wroth
				trait = brooding
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Muttaqi
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Muttaqi"
	}
	option = {
		name = EVTOPTU_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Radi } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = content
				trait = temperate
				trait = kind
				trait = affectionate
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Radi
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Radi"
	}
	option = {
		name = EVTOPTV_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Qahir } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = brave
				trait = wroth
				trait = arbitrary
				trait = playful
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Qahir
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Qahir"
	}
	option = {
		name = EVTOPTW_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Muqtadir } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = proud
				trait = lustful
				trait = ambitious
				trait = playful
				martial = 15
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Muqtadir
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Muqtadir"
	}
	option = {
		name = EVTOPTX_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Muktafi } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = content
				trait = slothful
				trait = stubborn
				trait = haughty
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Muktafi
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Muktafi"
	}
	option = {
		name = EVTOPTY_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Mutadid } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = trusting
				trait = honest
				trait = craven
				trait = affectionate
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Mutadid
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Mu'tadid"
	}
	option = {
		name = EVTOPTZ_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Mutamid } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = charitable
				trait = envious
				trait = indolent
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Mutamid
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Mu'tamid"
	}
	option = {
		name = EVTOPTAA_emf_heresy_1801
		trigger = { 
			OR = {
				NOT = { d_sunni = { has_title_flag = al_Muhtadi } }
				d_sunni = { check_variable = { which = caliphnumber value = 24 } }
			}
			OR = {
				trait = gregarious
				trait = deceitful
				trait = charitable
				trait = playful
				NOT = { age = 6 }
				AND = {
					d_sunni = { check_variable = { which = caliphnumber value = 18 } }
					NOT = { d_sunni = { check_variable = { which = caliphnumber value = 24 } } }
				}
			}
		}
		d_sunni = {
			set_title_flag = al_Muhtadi
			hidden_tooltip = { change_variable = { which = "caliphnumber" value = 1 } }
		}
		set_name = "Al-Muhtadi"
	}
}

# Some Caliphate titles can only fall to close relatives
character_event = {
	id = emf_heresy.1802
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			OR = {
				title = d_ismaili
				title = d_zaydi
				title = d_shiite
			}
		}
		FROMFROM = {
			NOT = { is_close_relative = ROOT }
		}
	}
	
	immediate = {
		FROMFROM = { save_event_target_as = former_owner }
		character_event = { id = emf_heresy.1803 days = 1 }
	}
}

character_event = {
	id = emf_heresy.1803
	desc = EVTDESC_emf_heresy_1803
	picture = GFX_evt_throne_room_arabic
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_1803 # The title is rightfully mine
		trigger = {
			trait = sayyid
			piety = 250
		}
		piety = -250
	}
	option = {
		name = EVTOPTB_emf_heresy_1803 # So be it
		trigger = {
			OR = {
				NOT = { trait = sayyid }
				NOT = { piety = 250 }
			}
		}
		if = {
			limit = { event_target:former_owner = { is_alive = yes } }
			FROMFROM = {
				usurp_title_only = event_target:former_owner
				hidden_tooltip = { remove_claim = ROOT }
			}
			break = yes
		}
		unsafe_destroy_landed_title = FROMFROM
	}
}

# ANARCHY AT SAMARRA EVENTS

# Caliphate administration seized from a weak caliph
narrative_event = {
	id = emf_heresy.1900
	title = EVTNAME_emf_heresy_1900
	desc = EVTDESC_emf_heresy_1900
	picture = GFX_evt_throne_room_arabic
	
	major = yes
	hide_from = yes
	show_ROOT = yes
	
	only_playable = yes
	religion = sunni
	prisoner = no
	only_men = yes
	
	trigger = {
		has_landed_title = d_sunni
		year = 800
		realm_size = 150
		war = no
		NOR = {
			diplomacy = 10
			martial = 10
			stewardship = 10
			intrigue = 10
			d_sunni = { has_title_flag = anarchy_at_samarra_happened }
		}
	}
	
	major_trigger = {
		OR = {
			religion_group = muslim
			capital_scope = {
				ROOT = {
					capital_scope = {
						NOT = {
							distance = {
								where = PREVPREV
								value = 600	# Same part of the world
							}
						}
					}
				}
			}
		}
	}

	mean_time_to_happen = {
		months = 24
		modifier = {
			factor = 0.5
			NOR = {
				diplomacy = 5
				martial = 5
				stewardship = 5
				intrigue = 5
			}
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_1900
		trigger = { has_landed_title = d_sunni }
		set_global_flag = anarchy_at_samarra
		d_sunni = { set_title_flag = anarchy_at_samarra_happened }
		add_trait = court_anarchy
		hidden_tooltip = {
			primary_title = { add_law = infighting_0 }
			if = {
				limit = { has_dlc = "Zeus" }
				primary_title = {
					add_law = law_voting_power_1
					add_law = war_voting_power_1
					add_law = revoke_title_voting_power_1
					add_law = imprison_voting_power_1
					add_law = grant_title_voting_power_1
					add_law = banish_voting_power_1
					add_law = execution_voting_power_1
				}
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_1900
		trigger = {
			NOT = { has_landed_title = d_sunni }
			religion_group = muslim
		}
		tooltip = {
			ROOT = { add_trait = court_anarchy }
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_1900
		trigger = {
			NOT = { has_landed_title = d_sunni }
			NOT = { religion_group = muslim }
		}
		tooltip = {
			ROOT = { add_trait = court_anarchy }
		}
	}
}

# Clean up court anarchy upon succession
character_event = {
	id = emf_heresy.1901
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		FROM = { title = d_sunni }
		has_global_flag = anarchy_at_samarra
		NOT = { trait = court_anarchy }
	}
	
	immediate = {
		clr_global_flag = anarchy_at_samarra
		FROMFROM = {
			remove_trait = court_anarchy
			any_demesne_title = {
				revoke_law = infighting_0
				revoke_law = infighting_1
			}
		}
		any_demesne_title = {
			revoke_law = infighting_0
			revoke_law = infighting_1
		}
	}
}

# Caliph succeeds at restoring order (fired from decision)
narrative_event = {
	id = emf_heresy.1902
	title = EVTNAME_emf_heresy_1902
	desc = EVTDESC_emf_heresy_1902
	picture = GFX_evt_caliph

	major = yes
	hide_from = yes
	show_ROOT = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		OR = {
			religion_group = muslim
			capital_scope = {
				ROOT = {
					capital_scope = {
						NOT = {
							distance = {
								where = PREVPREV
								value = 600	# Same part of the world
							}
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_1902
		trigger = { has_landed_title = d_sunni }
		clr_global_flag = anarchy_at_samarra
		hidden_tooltip = {
			any_demesne_title = {
				revoke_law = infighting_0
				revoke_law = infighting_1
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_1902
		trigger = {
			NOT = { has_landed_title = d_sunni }
			religion_group = muslim
		}
		if = {
			limit = { trait = court_anarchy }
			remove_trait = court_anarchy
		}
		hidden_tooltip = {
			any_demesne_title = {
				revoke_law = infighting_0
				revoke_law = infighting_1
			}
		}
	}
	option = {
		name = OK
		trigger = {
			NOT = { has_landed_title = d_sunni }
			NOT = { religion_group = muslim }
		}
	}
}

# A random realm lord will declare independence while the anarchy reigns
character_event = {
	id = emf_heresy.1903

	hide_window = yes
	
	only_playable = yes
	religion = sunni
	only_men = yes
	
	trigger = {
		has_landed_title = d_sunni
		trait = court_anarchy
		has_global_flag = anarchy_at_samarra
		is_primary_war_defender = no
		in_revolt = no
	}
	
	mean_time_to_happen = {
		years = 3
	}

	immediate = {
		random_vassal = {
			limit = {
				war = no
				in_revolt = no
				real_tier = KING
				NOT = { any_realm_province = { has_province_flag = emf_capital_connected } }
				capital_scope = { any_neighbor_province = { owner_under_ROOT = no } }
				NOR = {
					dynasty = ROOT
					opinion = { who = ROOT value = 0 }
					has_character_flag = refuse_caliph_breakaway
				}
			}
			character_event = { id = emf_heresy.1904 }
			break = yes
		}
		random_vassal = {
			limit = {
				war = no
				in_revolt = no
				real_tier = DUKE
				NOT = { any_realm_province = { has_province_flag = emf_capital_connected } }
				capital_scope = { any_neighbor_province = { owner_under_ROOT = no } }
				NOR = {
					dynasty = ROOT
					opinion = { who = ROOT value = 0 }
					has_character_flag = refuse_caliph_breakaway
				}
			}
			character_event = { id = emf_heresy.1904 }
			break = yes
		}
		random_vassal = {
			limit = {
				war = no
				in_revolt = no
				real_tier = COUNT
				NOT = { any_demesne_province = { has_province_flag = emf_capital_connected } }
				capital_scope = { any_neighbor_province = { owner_under_ROOT = no } }
				NOR = {
					dynasty = ROOT
					opinion = { who = ROOT value = 0 }
					has_character_flag = refuse_caliph_breakaway
				}
			}
			character_event = { id = emf_heresy.1904 }
			break = yes
		}
		random_vassal = {
			limit = {
				war = no
				in_revolt = no
				real_tier = KING
				NOT = { any_realm_province = { has_province_flag = emf_capital_connected } }
				any_demesne_province = { any_neighbor_province = { owner_under_ROOT = no } }
				NOR = {
					dynasty = ROOT
					opinion = { who = ROOT value = 0 }
					has_character_flag = refuse_caliph_breakaway
				}
			}
			character_event = { id = emf_heresy.1904 }
			break = yes
		}
		random_vassal = {
			limit = {
				war = no
				in_revolt = no
				real_tier = DUKE
				NOT = { any_realm_province = { has_province_flag = emf_capital_connected } }
				any_demesne_province = { any_neighbor_province = { owner_under_ROOT = no } }
				NOR = {
					dynasty = ROOT
					opinion = { who = ROOT value = 0 }
					has_character_flag = refuse_caliph_breakaway
				}
			}
			character_event = { id = emf_heresy.1904 }
			break = yes
		}
		random_vassal = {
			limit = {
				war = no
				in_revolt = no
				real_tier = COUNT
				NOT = { any_demesne_province = { has_province_flag = emf_capital_connected } }
				any_demesne_province = { any_neighbor_province = { owner_under_ROOT = no } }
				NOR = {
					dynasty = ROOT
					opinion = { who = ROOT value = 0 }
					has_character_flag = refuse_caliph_breakaway
				}
			}
			character_event = { id = emf_heresy.1904 }
			break = yes
		}
		random_vassal = {
			limit = {
				war = no
				in_revolt = no
				real_tier = KING
				NOT = { any_realm_province = { has_province_flag = emf_capital_connected } }
				any_realm_province = { any_neighbor_province = { owner_under_ROOT = no } }
				NOR = {
					dynasty = ROOT
					opinion = { who = ROOT value = 0 }
					has_character_flag = refuse_caliph_breakaway
				}
			}
			character_event = { id = emf_heresy.1904 }
			break = yes
		}
		random_vassal = {
			limit = {
				war = no
				in_revolt = no
				real_tier = DUKE
				NOT = { any_realm_province = { has_province_flag = emf_capital_connected } }
				any_realm_province = { any_neighbor_province = { owner_under_ROOT = no } }
				NOR = {
					dynasty = ROOT
					opinion = { who = ROOT value = 0 }
					has_character_flag = refuse_caliph_breakaway
				}
			}
			character_event = { id = emf_heresy.1904 }
			break = yes
		}
		random_vassal = {
			limit = {
				war = no
				in_revolt = no
				real_tier = KING
				capital_scope = { any_neighbor_province = { owner_under_ROOT = no } }
				NOR = {
					dynasty = ROOT
					opinion = { who = ROOT value = 0 }
					has_character_flag = refuse_caliph_breakaway
				}
			}
			character_event = { id = emf_heresy.1904 }
			break = yes
		}
		random_vassal = {
			limit = {
				war = no
				in_revolt = no
				real_tier = DUKE
				capital_scope = { any_neighbor_province = { owner_under_ROOT = no } }
				NOR = {
					dynasty = ROOT
					opinion = { who = ROOT value = 0 }
					has_character_flag = refuse_caliph_breakaway
				}
			}
			character_event = { id = emf_heresy.1904 }
			break = yes
		}
		random_vassal = {
			limit = {
				war = no
				in_revolt = no
				real_tier = COUNT
				capital_scope = { any_neighbor_province = { owner_under_ROOT = no } }
				NOR = {
					dynasty = ROOT
					opinion = { who = ROOT value = 0 }
					has_character_flag = refuse_caliph_breakaway
				}
			}
			character_event = { id = emf_heresy.1904 }
			break = yes
		}
		random_vassal = {
			limit = {
				war = no
				in_revolt = no
				real_tier = KING
				any_demesne_province = { any_neighbor_province = { owner_under_ROOT = no } }
				NOR = {
					dynasty = ROOT
					opinion = { who = ROOT value = 0 }
					has_character_flag = refuse_caliph_breakaway
				}
			}
			character_event = { id = emf_heresy.1904 }
			break = yes
		}
		random_vassal = {
			limit = {
				war = no
				in_revolt = no
				real_tier = DUKE
				any_demesne_province = { any_neighbor_province = { owner_under_ROOT = no } }
				NOR = {
					dynasty = ROOT
					opinion = { who = ROOT value = 0 }
					has_character_flag = refuse_caliph_breakaway
				}
			}
			character_event = { id = emf_heresy.1904 }
			break = yes
		}
		random_vassal = {
			limit = {
				war = no
				in_revolt = no
				real_tier = COUNT
				any_demesne_province = { any_neighbor_province = { owner_under_ROOT = no } }
				NOR = {
					dynasty = ROOT
					opinion = { who = ROOT value = 0 }
					has_character_flag = refuse_caliph_breakaway
				}
			}
			character_event = { id = emf_heresy.1904 }
			break = yes
		}
		random_vassal = {
			limit = {
				war = no
				in_revolt = no
				real_tier = KING
				any_realm_province = { any_neighbor_province = { owner_under_ROOT = no } }
				NOR = {
					dynasty = ROOT
					opinion = { who = ROOT value = 0 }
					has_character_flag = refuse_caliph_breakaway
				}
			}
			character_event = { id = emf_heresy.1904 }
			break = yes
		}
		random_vassal = {
			limit = {
				war = no
				in_revolt = no
				real_tier = DUKE
				any_realm_province = { any_neighbor_province = { owner_under_ROOT = no } }
				NOR = {
					dynasty = ROOT
					opinion = { who = ROOT value = 0 }
					has_character_flag = refuse_caliph_breakaway
				}
			}
			character_event = { id = emf_heresy.1904 }
			break = yes
		}
	}
}

# Ruler decides whether or not to break free of the caliph
character_event = {
	id = emf_heresy.1904
	desc = EVTDESC_emf_heresy_1904
	picture = GFX_evt_throne_room
	
	is_triggered_only = yes

	option = {
		name = EVTOPTA_emf_heresy_1904
		ai_chance = {
			factor = 4
		}
		log = "emf_heresy.1904: [Root.GetBestName] ([Root.PrimaryTitle.GetID]) has broken away from [Root.Liege.GetBestName] due to the Anarchy at Samarra"
		FROM = {
			liege = {
				if = {
					limit = { NOT = { character = PREV } }
					set_defacto_vassal = ROOT
				}
				if = {
					limit = { character = PREV }
					ROOT = {
						set_defacto_liege = ROOT
						character_event = { id = emf_core.65 } # Capital-connected territory
					}
					character_event = { id = emf_core.65 } # Capital-connected territory
				}
			}
		}
		emf_liege_change_effect = yes
		hidden_tooltip = {
			FROM = { character_event = { id = emf_heresy.1905 } }
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_1904
		ai_chance = {
			factor = 1
		}
		set_character_flag = refuse_caliph_breakaway
		piety = 50
	}
}

# Caliph hears of the ruler breaking free
character_event = {
	id = emf_heresy.1905
	desc = EVTDESC_emf_heresy_1905
	picture = GFX_evt_throne_room
	
	is_triggered_only = yes
	
	option = {
		name = CURSES
		opinion = { who = FROM modifier = opinion_rightful_vassal years = 20 }
		hidden_tooltip = { opinion = { who = FROM modifier = opinion_rightful_subjugation } }
	}
}


#######################################
# KHARIJITE EVENTS
#######################################

### KHARIJITE REBELLION

# Kharijite rebels rise up in Mosul during the Anarchy at Samarra
province_event = {
	id = emf_heresy.1906

	hide_window = yes
	
	trigger = {
		province_id = 697
		owner = {
			OR = {
				has_landed_title = d_sunni
				any_liege = { has_landed_title = d_sunni }
			}
		}
		has_global_flag = anarchy_at_samarra
		had_global_flag = { flag = EMF days = 730 }
		NOT = { has_province_flag = kharijite_revolt }
	}
	
	mean_time_to_happen = {
		years = 5
		modifier = {
			factor = 0.1
			year = 866
		}
	}
	
	immediate = {	
		set_province_flag = kharijite_revolt
		if = {
			limit = { NOT = { religion = kharijite } }
			religion = kharijite
		}
		
		create_character = {
			random_traits = yes
			dynasty = 1000124392 #Al-Shari
			name = "Musawir"
			religion = kharijite
			culture = ROOT
			female = no
			age = 32
			attributes = {
				martial = 15
				learning = 7
			}
			trait = heresiarch
			trait = zealous
			trait = skilled_tactician
			trait = unyielding_leader
			trait = holy_warrior
		}

		new_character = {
			set_character_flag = heretic_revolter			
			create_title = {
				tier = DUKE
				landless = yes
				temporary = yes
				rebel = yes
				culture = ROOT
				name = "KHARIJITE_REBELLION"
				holder = THIS
				ruler = "IMAM"
				ruler_female = "CALIPHA"
				foa = "CALIPH_FOA"
			}			
			spawn_unit = {
				province = ROOT
				home = ROOT
				owner = THIS
				scaled_by_biggest_garrison = 1.8
				troops = {
					archers = { 6 6 }
					light_cavalry = { 4 4 }
					light_infantry = { 10 10 }
				}
				attrition = 0
				maintenance_multiplier = 0
			}
			create_character = {
				random_traits = yes
				dynasty = none
				religion = kharijite
				culture = THIS
				female = no
				age = 30
				attributes = {
					martial = 7
				}
				trait = skilled_tactician
				trait = peasant_leader
			}
			new_character = {
				spawn_unit = {
					province = ROOT
					home = ROOT
					owner = PREV
					scaled_by_biggest_garrison = 1.8
					troops = {
						archers = { 6 6 }
						light_cavalry = { 4 4 }
						light_infantry = { 10 10 }
					}
					attrition = 0.0
					disband_on_peace = yes
					maintenance_multiplier = 0
				}
			}
			create_character = {
				random_traits = yes
				dynasty = none
				religion = THIS
				culture = THIS
				female = no
				age = 23
				attributes = {
					martial = 7
				}
				trait = skilled_tactician
				trait = peasant_leader
			}
			new_character = {
				spawn_unit = {
					province = ROOT
					home = ROOT
					owner = PREV
					scaled_by_biggest_garrison = 1.8
					troops = {
						archers = { 6 6 }
						light_cavalry = { 4 4 }
						light_infantry = { 10 10 }
					}
					attrition = 0.0
					disband_on_peace = yes
					maintenance_multiplier = 0
				}
			}
			
			# DoW on the province top liege
			ROOT = {
				owner = {
					top_liege = {
						reverse_war = {
							target = PREVPREVPREV
							casus_belli = heretic_revolt
						}
						reverse_opinion = {
							who = PREVPREVPREV
							modifier = opinion_evil_tyrant
						}
					}
				}
			}
		}
		
		#inform the lieges
		owner = {
			top_liege = {
				character_event = { id = emf_heresy.1907 }
			}
		}
	}
}

# Rulers informed of the kharajite uprising
character_event = {
	id = emf_heresy.1907
	desc = EVTDESC_emf_heresy_1907
	picture = GFX_evt_heretic
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	major = yes
	
	major_trigger = {
		OR = {
			same_realm = ROOT
			capital_scope = {
				ROOT = {
					capital_scope = {
						NOT = {
							distance = {
								where = PREVPREV
								value = 600	# Same part of the world
							}
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_1907
		trigger = {
			NOT = { religion = sunni }
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_1907
		trigger = {
			religion = sunni
		}
	}
}

# KAFIR EVENTS

# Liege declares a subject as kafir (triggered via decision)
letter_event = {
	id = emf_heresy.1915
	desc = EVTDESC_emf_heresy_1915
	
	is_triggered_only = yes

	option = {
		name = EVTOPTA_emf_heresy_1915
		add_trait = kharijite_kafir
		piety = -100
	}
}

# Vassal declares a liege as kafir (triggered via decision)
letter_event = {
	id = emf_heresy.1916
	desc = EVTDESC_emf_heresy_1916
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_1915
		add_trait = kharijite_kafir
		piety = -100
	}
}

# Public execution (triggered via decision)
long_character_event = {
	id = emf_heresy.1917
	picture = GFX_evt_beheading
	border = GFX_event_long_frame_religion
	
	desc = {
		text = EVTDESC_emf_heresy_1917_family
		trigger = {
			ROOT = {
				OR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_spouse
		trigger = {
			ROOT = {
				is_married = FROM
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_dynasty
		trigger = {
			ROOT = {
				dynasty = FROM
				NOR = {
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_saoshyant
		trigger = {
			ROOT = {
				OR = {
					trait = saoshyant
					trait = saoshyant_descendant
				}
				NOR = {
					dynasty = FROM
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_pope
		trigger = {
			ROOT = {
				has_landed_title = k_papal_state
				NOR = {
					dynasty = FROM
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					trait = saoshyant
					trait = saoshyant_descendant
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_patriarch
		trigger = {
			ROOT = {
				has_landed_title = k_orthodox
				NOR = {
					dynasty = FROM
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_caliph
		trigger = {
			ROOT = {
				controls_religion = yes
				religion_group = muslim
				NOR = {
					religion = ROOT
					dynasty = FROM
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_jewish_head
		trigger = {
			ROOT = {
				controls_religion = yes
				religion_group = jewish_group
				NOR = {
					dynasty = FROM
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_zoro_head
		trigger = {
			ROOT = {
				controls_religion = yes
				religion_group = zoroastrian_group
				NOR = {
					dynasty = FROM
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_king_israel
		trigger = {
			ROOT = {
				has_landed_title = k_israel
				NOR = {
					dynasty = FROM
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
				}
			}
		}
	}	
	desc = {
		text = EVTDESC_emf_heresy_1917_emperor
		trigger = {
			ROOT = {
				real_tier = EMPEROR
				NOR = {
					dynasty = FROM
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_christian_head
		trigger = {
			ROOT = {
				controls_religion = yes
				religion_group = christian
				NOR = {
					dynasty = FROM
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = KING
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_pagan_head
		trigger = {
			ROOT = {
				controls_religion = yes
				religion_group = pagan_group
				NOR = {
					dynasty = FROM
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = KING
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_king
		trigger = {
			ROOT = {
				real_tier = KING
				NOR = {
					dynasty = FROM
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = KING
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
					AND = {
						controls_religion = yes
						religion_group = pagan_group
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_crusader
		trigger = {
			ROOT = {
				trait = crusader
				NOR = {
					dynasty = FROM
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = DUKE
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
					AND = {
						controls_religion = yes
						religion_group = pagan_group
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_sayyid
		trigger = {
			ROOT = {
				trait = sayyid
				NOR = {
					dynasty = FROM
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = DUKE
					trait = crusader
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
					AND = {
						controls_religion = yes
						religion_group = pagan_group
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_duke
		trigger = {
			ROOT = {
				real_tier = DUKE
				NOR = {
					dynasty = FROM
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = DUKE
					trait = crusader
					trait = sayyid
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
					AND = {
						controls_religion = yes
						religion_group = pagan_group
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_kafir
		trigger = {
			ROOT = {
				trait = kharijite_kafir
				NOR = {
					dynasty = FROM
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = COUNT
					trait = crusader
					trait = sayyid
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
					AND = {
						controls_religion = yes
						religion_group = pagan_group
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_pirate
		trigger = {
			ROOT = {
				trait = viking
				NOR = {
					dynasty = FROM
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = COUNT
					trait = crusader
					trait = sayyid
					trait = kharijite_kafir
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
					AND = {
						controls_religion = yes
						religion_group = pagan_group
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_genius
		trigger = {
			ROOT = {
				trait = genius
				NOR = {
					dynasty = FROM
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = COUNT
					trait = crusader
					trait = sayyid
					trait = kharijite_kafir
					trait = viking
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
					AND = {
						controls_religion = yes
						religion_group = pagan_group
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_imbecile
		trigger = {
			ROOT = {
				trait = imbecile
				NOR = {
					dynasty = FROM
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = COUNT
					trait = crusader
					trait = sayyid
					trait = kharijite_kafir
					trait = viking
					trait = genius
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
					AND = {
						controls_religion = yes
						religion_group = pagan_group
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_count
		trigger = {
			ROOT = {
				real_tier = COUNT
				NOR = {
					dynasty = FROM
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = COUNT
					trait = crusader
					trait = sayyid
					trait = kharijite_kafir
					trait = viking
					trait = genius
					trait = imbecile
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
					AND = {
						controls_religion = yes
						religion_group = pagan_group
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1917_generic
		trigger = {
			ROOT = {
				NOR = {
					dynasty = FROM
					is_married = FROM
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = BARON
					trait = crusader
					trait = sayyid
					trait = kharijite_kafir
					trait = viking
					trait = genius
					trait = imbecile
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
					AND = {
						controls_religion = yes
						religion_group = pagan_group
					}
				}
			}
		}
	}	
	
	is_triggered_only = yes
	major = yes
	
	major_trigger = {
		OR = {
			character = ROOT
			character = FROM
			is_liege_or_above = ROOT
			is_liege_or_above = FROM
			dynasty = ROOT
			is_close_relative = ROOT
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_1917_family
		trigger = {
			character = FROM
			ROOT = {
				OR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = -50
		piety = 100
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_spouse
		trigger = {
			character = FROM
			ROOT = {
				is_married = FROM
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = -25
		piety = 50
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_dynasty
		trigger = {
			character = FROM
			ROOT = {
				dynasty = FROM
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					is_married = FROM
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = -25
		piety = 25
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_saoshyant
		trigger = {
			character = FROM
			ROOT = {
				OR = {
					trait = saoshyant
					trait = saoshyant_descendant
				}
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					is_married = FROM
					dynasty = FROM
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = 100
		piety = 1000
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_pope
		trigger = {
			character = FROM
			ROOT = {
				has_landed_title = k_papal_state
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					is_married = FROM
					dynasty = FROM
					trait = saoshyant
					trait = saoshyant_descendant
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = 50
		piety = 500
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_patriarch
		trigger = {
			character = FROM
			ROOT = {
				has_landed_title = k_orthodox
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					is_married = FROM
					dynasty = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = 50
		piety = 500
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_caliph
		trigger = {
			character = FROM
			ROOT = {
				controls_religion = yes
				religion_group = muslim
				NOR = {
					religion = ROOT
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					is_married = FROM
					dynasty = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = 50
		piety = 500
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_jewish_head
		trigger = {
			character = FROM
			ROOT = {
				controls_religion = yes
				religion_group = jewish_group
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					is_married = FROM
					dynasty = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = 50
		piety = 500
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_zoro_head
		trigger = {
			character = FROM
			ROOT = {
				controls_religion = yes
				religion_group = zoroastrian_group
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					is_married = FROM
					dynasty = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = 50
		piety = 500
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_king_israel
		trigger = {
			character = FROM
			ROOT = {
				has_landed_title = k_israel
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					is_married = FROM
					dynasty = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = 50
		piety = 500
	}	
	option = {
		name = EVTOPTA_emf_heresy_1917_emperor
		trigger = {
			character = FROM
			ROOT = {
				real_tier = EMPEROR
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					is_married = FROM
					dynasty = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = 50
		piety = 250
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_christian_head
		trigger = {
			character = FROM
			ROOT = {
				controls_religion = yes
				religion_group = christian
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					is_married = FROM
					dynasty = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = KING
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = 50
		piety = 500
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_pagan_head
		trigger = {
			character = FROM
			ROOT = {
				controls_religion = yes
				religion_group = pagan_group
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					is_married = FROM
					dynasty = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = KING
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = 50
		piety = 250
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_king
		trigger = {
			character = FROM
			ROOT = {
				real_tier = KING
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					is_married = FROM
					dynasty = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = KING
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
					AND = {
						controls_religion = yes
						religion_group = pagan_group
					}
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = 25
		piety = 250
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_crusader
		trigger = {
			character = FROM
			ROOT = {
				trait = crusader
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					is_married = FROM
					dynasty = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = DUKE
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
					AND = {
						controls_religion = yes
						religion_group = pagan_group
					}
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = 20
		piety = 100
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_sayyid
		trigger = {
			character = FROM
			ROOT = {
				trait = sayyid
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					is_married = FROM
					dynasty = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					trait = crusader
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = DUKE
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
					AND = {
						controls_religion = yes
						religion_group = pagan_group
					}
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = 15
		piety = 100
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_duke
		trigger = {
			character = FROM
			ROOT = {
				real_tier = DUKE
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					is_married = FROM
					dynasty = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					trait = crusader
					trait = sayyid
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = DUKE
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
					AND = {
						controls_religion = yes
						religion_group = pagan_group
					}
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = 15
		piety = 50
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_kafir
		trigger = {
			character = FROM
			ROOT = {
				trait = kharijite_kafir
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					is_married = FROM
					dynasty = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					trait = crusader
					trait = sayyid
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = COUNT
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
					AND = {
						controls_religion = yes
						religion_group = pagan_group
					}
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = 10
		piety = 50
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_pirate
		trigger = {
			character = FROM
			ROOT = {
				trait = viking
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					is_married = FROM
					dynasty = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					trait = crusader
					trait = sayyid
					trait = kharijite_kafir
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = COUNT
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
					AND = {
						controls_religion = yes
						religion_group = pagan_group
					}
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = 10
		piety = 50
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_genius
		trigger = {
			character = FROM
			ROOT = {
				trait = genius
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					is_married = FROM
					dynasty = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					trait = crusader
					trait = sayyid
					trait = kharijite_kafir
					trait = viking
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = COUNT
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
					AND = {
						controls_religion = yes
						religion_group = pagan_group
					}
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = 10
		piety = 25
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_imbecile
		trigger = {
			character = FROM
			ROOT = {
				trait = imbecile
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					is_married = FROM
					dynasty = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					trait = crusader
					trait = sayyid
					trait = kharijite_kafir
					trait = viking
					trait = genius
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = COUNT
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
					AND = {
						controls_religion = yes
						religion_group = pagan_group
					}
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = -50
		piety = 10
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_count
		trigger = {
			character = FROM
			ROOT = {
				real_tier = COUNT
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_child_of = FROM
					is_married = FROM
					dynasty = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					trait = crusader
					trait = sayyid
					trait = kharijite_kafir
					trait = viking
					trait = genius
					trait = imbecile
					has_landed_title = k_papal_state
					has_landed_title = k_orthodox
					has_landed_title = k_israel
					higher_real_tier_than = COUNT
					AND = {
						controls_religion = yes
						religion_group = muslim
					}
					AND = {
						controls_religion = yes
						religion_group = jewish_group
					}
					AND = {
						controls_religion = yes
						religion_group = zoroastrian_group
					}
					AND = {
						controls_religion = yes
						religion_group = christian
					}
					AND = {
						controls_religion = yes
						religion_group = pagan_group
					}
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = 10
		piety = 25
	}
	option = {
		name = EVTOPTA_emf_heresy_1917_generic
		trigger = {
			character = FROM
			ROOT = {
				NOR = {
					sibling = FROM
					is_father = FROM
					is_mother = FROM
					is_married = FROM
					is_child_of = FROM
					dynasty = FROM
					trait = saoshyant
					trait = saoshyant_descendant
					trait = crusader
					trait = sayyid
					trait = kharijite_kafir
					trait = viking
					trait = genius
					trait = imbecile
					higher_real_tier_than = BARON
					AND = {
						controls_religion = yes
						OR = {
							religion_group = christian
							religion_group = muslim
							religion_group = jewish_group
							religion_group = zoroastrian_group
							religion_group = pagan_group
						}
					}	
				}
			}
		}
		ROOT = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
		prestige = 10
		piety = 10
	}
	option = {
		name = EVTOPTB_emf_heresy_1917
		trigger = {
			character = ROOT
		}
		tooltip = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_1917
		trigger = {
			NOR = {
				character = ROOT
				character = FROM
			}
			OR = {
				is_liege_or_above = ROOT
				dynasty = ROOT
				is_close_relative = ROOT
				NOT = { religion_group = muslim }
			}
		}
		tooltip = {
			ROOT = {
				death = {
					death_reason = death_execution
					killer = FROM
				}
			}
		}
	}
	option = {
		name = EVTOPTD_emf_heresy_1917
		trigger = {
			NOR = {
				character = ROOT
				character = FROM
				is_liege_or_above = ROOT
				dynasty = ROOT
				is_close_relative = ROOT
			}
			religion_group = muslim
		}
		tooltip = {
			ROOT = {
				death = {
					death_reason = death_execution
					killer = FROM
				}
			}
		}
	}
}

# Bounce for execution event
character_event = {
	id = emf_heresy.1918
	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			long_character_event = { id = emf_heresy.1917 }
		}
	}
}

# Kafir attempts to remove gluttonous
character_event = {
	id = emf_heresy.1920
	desc = EVTDESC_emf_heresy_1920
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_1920
		hidden_tooltip = {
			emf_do_not_disturb_effect = yes
			character_event = { id = emf_heresy.1921 days = 10 }
		}
	}
}

# Gluttonous removed after fasting completed
character_event = {
	id = emf_heresy.1921
	desc = EVTDESC_emf_heresy_1921
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_1921
		emf_can_disturb_effect = yes
		remove_trait = gluttonous
		random_list = {
			10 = {
				modifier = {
					factor = 0
					is_weak_trigger = yes
				}
				modifier = {
					factor = 0.5
					is_strong_trigger = yes
				}
				add_trait = feeble
			}
			30 = {
				modifier = {
					factor = 0
					trait = temperate
				}
				add_trait = temperate
			}
			60 = {
				modifier = {
					factor = 1.5
					is_weak_trigger = yes
				}
				modifier = {
					factor = 0.5
					is_strong_trigger = yes
				}
				health = -1
			}
		}
	}
}

# Kafir attempts to remove greedy
character_event = {
	id = emf_heresy.1922
	desc = EVTDESC_emf_heresy_1922
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_1922
		emf_can_disturb_effect = yes
		remove_trait = greedy
		random = {
			chance = 25
			modifier = {
				factor = 2
				trait = kind
			}
			modifier = {
				factor = 1.5
				trait = humble
			}
			modifier = {
				factor = 1.5
				trait = content
			}
			modifier = {
				factor = 0.75
				trait = proud
			}
			modifier = {
				factor = 0.75
				trait = ambitious
			}
			modifier = {
				factor = 0.5
				trait = cruel
			}
			modifier = {
				factor = 0.5
				trait = envious
			}
			add_trait = charitable
		}
	}
}

# Kafir attempts to remove slothful
character_event = {
	id = emf_heresy.1923
	desc = EVTDESC_emf_heresy_1923
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_1923
		emf_can_disturb_effect = yes
		remove_trait = slothful
		random = {
			chance = 50
			add_trait = stressed
		}
	}
}

# Kafir attempts to remove arbitrary	
character_event = {
	id = emf_heresy.1924
	desc = EVTDESC_emf_heresy_1924
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_1924
		emf_can_disturb_effect = yes
		remove_trait = arbitrary
		random_list = {
			50 = { change_stewardship = -1 }
			35 = { change_stewardship = -2 }
			15 = { }
		}
	}
}

# Kafir attempts to remove cynical
character_event = {
	id = emf_heresy.1925
	desc = EVTDESC_emf_heresy_1925
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = { emf_can_disturb_effect = yes }
	
	option = {
		name = EVTOPTA_emf_heresy_1925
		trigger = { NOT = { trait = deceitful } }
		remove_trait = cynical
		random_list = {
			50 = { add_trait = deceitful }
			50 = { add_trait = zealous }
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_1925
		trigger = { trait = deceitful }
		tooltip_info = deceitful
		remove_trait = cynical
	}
}

# Kafir attempts to remove drunkard
character_event = {
	id = emf_heresy.1926
	desc = EVTDESC_emf_heresy_1926
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_1926
		emf_can_disturb_effect = yes
		remove_trait = drunkard 
		random_list = {
			50 = {
				modifier = {
					factor = 0
					trait = humble
				}
				add_trait = humble
			}
			10 = { change_diplomacy = 1 }
			10 = { change_martial = 1 }
			10 = { change_intrigue = 1 }
			20 = {
				modifier = {
					factor = 1.5
					is_weak_trigger = yes
				}
				modifier = {
					factor = 0.5
					is_strong_trigger = yes
				}
				health = -1
			}
		}
	}
}

# Kafir attempts to remove hedonist
character_event = {
	id = emf_heresy.1927
	desc = EVTDESC_emf_heresy_1927
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_1926
		emf_can_disturb_effect = yes
		remove_trait = hedonist
		random_list = {
			50 = {
				modifier = {
					factor = 0
					trait = humble
				}
				add_trait = humble
			}
			10 = { change_diplomacy = 1 }
			10 = { change_martial = 1 }
			10 = { change_intrigue = 1 }
			20 = { add_trait = chaste }
		}
	}
}

# Kafir attempts to remove decadent
character_event = {
	id = emf_heresy.1928
	desc = EVTDESC_emf_heresy_1928
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_1926
		emf_can_disturb_effect = yes
		remove_trait = decadent
		random_list = {
			50 = {
				modifier = {
					factor = 0
					trait = humble
				}
				add_trait = humble
			}
			10 = { change_diplomacy = 1 }
			10 = { change_martial = 1 }
			10 = { change_intrigue = 1 }
			20 = { }
		}
	}
}

# Kafir clears their name
character_event = {
	id = emf_heresy.1929
	desc = EVTDESC_emf_heresy_1929
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	major = yes
	
	major_trigger = {
		religion = kharijite
		OR = {
			character = ROOT
			same_realm = ROOT
			dynasty = ROOT
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_1929
		trigger = { character = ROOT }
		remove_trait = kharijite_kafir 
		piety = 100
	}
	option = {
		name = EVTOPTB_emf_heresy_1929
		trigger = { NOT = { character = ROOT } }
		tooltip = { ROOT = { remove_trait = kharijite_kafir } }
	}
}


#######################################
# HURUFI/SUFI EVENTS
#######################################

# Muslim becomes a poet (fired via decision)
character_event = {
	id = emf_heresy.1930
	desc = EVTDESC_emf_heresy_1930
	picture = GFX_evt_diwan_poetry
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
		prestige = 50
		add_trait = poet
		random_list = {
			10 = { change_learning = 1 }
			10 = { change_intrigue = 1 }
			10 = { change_diplomacy = 1 }
			70 = {}
		}
	}
}

# Bounce event for writing Muslim Epic Poem
character_event = {
	id = emf_heresy.1931

	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = writing_epic_poem
	}

	immediate = {
		if = {
			limit = {
				OR = {
					NOT = { religion_group = muslim }
					NOT = { trait = poet }
				}
			}
			remove_character_modifier = writing_epic_poem
			break = yes
		}
		if = {
			limit = {
				OR = {
					is_ill = yes
					war = yes
					liege = { war = yes }
					prisoner = yes
					trait = incapable
					trait = depressed
					trait = stressed
				}
			}
			character_event = { id = emf_heresy.1932 }
			break = yes
		}	
		if = {
			limit = { is_variable_equal = { which = poem_completeness value = 4 } }
			character_event = { id = emf_heresy.1940 }
			break = yes
		}
		random_list = {
			10 = { character_event = { id = emf_heresy.1933 } } # Need inspiration
			10 = { character_event = { id = emf_heresy.1934 } } # Topics of study
			10 = {
				modifier = {
					factor = 0.5
					trait = chaste
				}
				modifier = {
					factor = 0
					OR = {
						trait = eunuch
						trait = celibate
					}
				}
				character_event = { id = emf_heresy.1935 } # Object of desire
			}
			10 = { character_event = { id = emf_heresy.1936 } } # Writer's Block
			10 = { character_event = { id = emf_heresy.1937 } } # Giving into despair
			10 = { character_event = { id = emf_heresy.1938 } } # Giving into procrastination
			40 = { character_event = { id = emf_heresy.1939 } } # Breakthrough
		}
	}
}

# Work on the Epic Poem is delayed
character_event = {
	id = emf_heresy.1932
	picture = GFX_evt_diwan_poetry
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_emf_heresy_1932_incapable
		trigger = { trait = incapable }
	}
	desc = {
		text = EVTDESC_emf_heresy_1932_prisoner
		trigger = {
			NOT = { trait = incapable }
			prisoner = yes
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1932_depressed
		trigger = {
			NOT = { trait = incapable }
			prisoner = no
			trait = depressed
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1932_stressed
		trigger = {
			NOT = { trait = depressed }
			NOT = { trait = incapable }
			prisoner = no
			trait = stressed
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1932_sick
		trigger = {
			NOT = { trait = stressed }
			NOT = { trait = depressed }
			NOT = { trait = incapable }
			prisoner = no
			is_ill = yes
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1932_war
		trigger = {
			NOT = { trait = stressed }
			NOT = { trait = depressed }
			NOT = { trait = incapable }
			prisoner = no
			is_ill = no
			OR = {
				war = yes
				liege = { war = yes }
			}
		}
	}
	
	is_triggered_only = yes
	
	option = {
		name = CURSES
		trigger = {
			OR = {
				trait = incapable
				prisoner = yes
				trait = depressed
				trait = stressed
			}
		}
		if = {
			limit = {
				OR = {
					trait = incapable
					prisoner = yes
				}
			}
			remove_character_modifier = writing_epic_poem
		}
		if = {
			limit = {
				OR = {
					trait = depressed
					trait = stressed
				}
			}
			random = {
				chance = 50
				remove_character_modifier = writing_epic_poem
			}
		}
	}
	option = {
		name = EVTOPTA_emf_heresy_1932 # I will continue
		ai_chance = {
			factor = 75
		}
		trigger = {
			NOR = {
				trait = incapable
				prisoner = yes
				trait = depressed
				trait = stressed
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_1932 # I give up!
		ai_chance = {
			factor = 25
		}
		trigger = {
			NOR = {
				trait = incapable
				prisoner = yes
				trait = depressed
				trait = stressed
			}
		}
		remove_character_modifier = writing_epic_poem
		random = {
			chance = 25
			add_trait = depressed
		}
	}
}

# Need inspiration for the Epic Poem
character_event = { 
	id = emf_heresy.1933
	desc = EVTDESC_emf_heresy_1933
	picture = GFX_evt_diwan_poetry
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = {
			text = EVTOPTA_emf_heresy_1933_women
			trigger = { NOT = { trait = homosexual } }
		}
		name = {
			text = EVTOPTA_emf_heresy_1933_men
			trigger = { trait = homosexual }
		}
		random_list = {
			10 = {
				modifier = {
					factor = 0
					trait = decadent
				}
				modifier = {
					factor = 2
					trait = lustful
				}
				modifier = {
					factor = 3
					trait = hedonist
				}
				add_trait = decadent
			}
			90 = {
				custom_tooltip = {
					text = EPIC_POEM_ADVANCES
					hidden_tooltip = {
						change_variable = { which = "poem_completeness" value = 1 }
					}
				}
			}
		}
		piety = -50
		if = {
			limit = {
				trait = lustful
				NOT = { trait = hedonist }
			}
			random = {
				chance = 50
				add_trait = hedonist
			}
		}
		if = {
			limit = { NOT = { trait = lustful } }
			random = {
				chance = 50
				add_trait = lustful
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_1933 #Wine
		random_list = {
			10 = {
				modifier = {
					factor = 0
					trait = decadent
				}
				modifier = {
					factor = 3
					trait = drunkard
				}
				add_trait = decadent
			}
			90 = {
				custom_tooltip = {
					text = EPIC_POEM_ADVANCES
					hidden_tooltip = {
						change_variable = { which = "poem_completeness" value = 1 }
					}
				}
			}
		}
		piety = -50
		if = {
			limit = { NOT = { trait = drunkard } }
			random = {
				chance = 50
				add_trait = drunkard
			}
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_1933 #Song
		random_list = {
			20 = {
				modifier = {
					factor = 0
					trait = decadent
				}
				add_trait = decadent
			}
			80 = {
				custom_tooltip = {
					text = EPIC_POEM_ADVANCES
					hidden_tooltip = {
						change_variable = { which = "poem_completeness" value = 1 }
					}
				}
			}
		}
		piety = -100
		prestige = -100
	}
	option = {
		name = EVTOPTD_emf_heresy_1933 #All At Once!
		random_list = {
			5 = {
				modifier = {
					factor = 0
					trait = decadent
				}
				modifier = {
					factor = 2
					trait = drunkard
				}
				modifier = {
					factor = 2
					trait = lustful
				}
				modifier = {
					factor = 3
					trait = hedonist
				}
				add_trait = decadent
			}
			60 = {
				custom_tooltip = {
					text = EPIC_POEM_ADVANCES
					hidden_tooltip = {
						change_variable = { which = "poem_completeness" value = 1 }
					}
				}
			}
			35 = {
				custom_tooltip = {
					text = EPIC_POEM_ADVANCES_MORE
					hidden_tooltip = {
						change_variable = { which = "poem_completeness" value = 2 }
					}
				}
			}
		}
		piety = -100
		prestige = 100
		if = {
			limit = {
				trait = lustful
				NOT = { trait = hedonist }
			}
			random = {
				chance = 50
				add_trait = hedonist
			}
		}
		if = {
			limit = { NOT = { trait = lustful } }
			random = {
				chance = 50
				add_trait = lustful
			}
		}
		if = {
			limit = { NOT = { trait = drunkard } }
			random = {
				chance = 50
				add_trait = drunkard
			}
		}
	}
}

# Topics of study for the Epic Poem
character_event = {
	id = emf_heresy.1934
	desc = EVTDESC_emf_heresy_1934
	picture = GFX_evt_diwan_poetry
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes

	option = {
		name = EVTOPTA_emf_heresy_1934 #Study Nobility
		random = {
			chance = 50
			change_diplomacy = 1
		}
		random = {
			chance = 70
			custom_tooltip = {
				text = EPIC_POEM_ADVANCES
				hidden_tooltip = {
					change_variable = { which = "poem_completeness" value = 1 }
				}
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_1934 #Study War
		random = {
			chance = 50
			change_martial = 1
		}
		random = {
			chance = 70
			custom_tooltip = {
				text = EPIC_POEM_ADVANCES
				hidden_tooltip = {
					change_variable = { which = "poem_completeness" value = 1 }
				}
			}
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_1934 #Study Library
		random = {
			chance = 50
			change_learning = 1
		}
		random = {
			chance = 70
			custom_tooltip = {
				text = EPIC_POEM_ADVANCES
				hidden_tooltip = {
					change_variable = { which = "poem_completeness" value = 1 }
				}
			}
		}
	}
}

# Object of desire appears to be beyond reach
character_event = {
	id = emf_heresy.1935
	picture = GFX_evt_lovers
	border = GFX_event_normal_frame_religion
	
	desc = {
		text = EVTDESC_emf_heresy_1935_female
		trigger = { NOT = { trait = homosexual } }
	}
	desc = {
		text = EVTDESC_emf_heresy_1935_male
		trigger = { trait = homosexual }
	}
	
	is_triggered_only = yes

	option = {
		name = EVTOPTA_emf_heresy_1935 #Visit whorehouse
		if = {
			limit = {
				trait = lustful
				NOT = { trait = hedonist }
			}
			random = {
				chance = 50
				add_trait = hedonist
			}
		}
		if = {
			limit = { NOT = { trait = lustful } }
			random = {
				chance = 50
				add_trait = lustful
			}
		}
		piety = -100
		random = {
			chance = 60
			custom_tooltip = {
				text = EPIC_POEM_ADVANCES
				hidden_tooltip = {
					change_variable = { which = "poem_completeness" value = 1 }
				}
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_1935 #Unrequited love
		piety = 100
		if = {
			limit = { NOT = { trait = chaste } }
			add_trait = chaste
		}
		random = {
			chance = 40
			custom_tooltip = {
				text = EPIC_POEM_ADVANCES
				hidden_tooltip = {
					change_variable = { which = "poem_completeness" value = 1 }
				}
			}
		}
	}
	option = {
		name = {
			text = EVTOPTC_emf_heresy_1935_female
			trigger = { NOT = { trait = homosexual } }
		}
		name = {
			text = EVTOPTC_emf_heresy_1935_male
			trigger = { trait = homosexual }
		}
		trigger = {
			NOT = { num_of_lovers = 3 }
		}
		piety = -50
		custom_tooltip = {
			text = EPIC_POEM_ADVANCES
			hidden_tooltip = {
				change_variable = { which = "poem_completeness" value = 1 }
			}
		}
		random_list = {
			5 = { add_trait = depressed }
			5 = { add_trait = stressed }
			20 = {
				modifier = {
					factor = 0
					trait = homosexual
				}
				modifier = {
					factor = 0
					is_married = yes
				}
				modifier = {
					factor = 0
					NOT = { age = 43 }
				}
				modifier = {
					factor = 0
					has_character_modifier = cradle_robber
				}
				add_character_modifier = {
					name = cradle_robber
					years = 5
				}
			}
			20 = {
				modifier = {
					factor = 0
					trait = homosexual
				}
				modifier = {
					factor = 0
					is_married = no
				}
				modifier = {
					factor = 0
					has_character_modifier = adulterer
				}
				add_character_modifier = {
					name = adulterer
					years = 10
				}
			}
			20 = {
				modifier = {
					factor = 0
					has_character_modifier = known_sodomite
				}
				modifier = {
					factor = 0
					NOT = { trait = homosexual }
				}
				add_character_modifier = {
					name = known_sodomite
					years = 20
				}
			}
			30 = {
				modifier = {
					factor = 0
					trait = homosexual
				}
				modifier = {
					factor = 0
					is_ruler = no
				}
				create_random_diplomat = {
					random_traits = yes
					dynasty = random
					female = yes
					age = 18
					religion = ROOT
					culture = ROOT
					trait = fair
				}
				new_character = {
					add_lover = ROOT
				}
			}
			30 = {
				modifier = {
					factor = 0
					NOT = { trait = homosexual }
				}
				modifier = {
					factor = 0
					is_ruler = no
				}
				create_random_diplomat = {
					random_traits = yes
					dynasty = random
					female = no
					age = 18
					religion = ROOT
					culture = ROOT
					trait = homosexual
					trait = fair
				}
				new_character = {
					add_lover = ROOT
				}
			}
		}
	}
}

# Suffering from writer's block
character_event = {
	id = emf_heresy.1936
	desc = EVTDESC_emf_heresy_1936
	picture = GFX_evt_diwan_poetry
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes

	option = {
		name = EVTOPTA_emf_heresy_1936 #Enjoy Life!
		prestige = 100
		random_list = {
			5 = {
				modifier = {
					factor = 0
					OR = {
						NOT = { trait = lustful }
						NOT = { trait = gluttonous }
						NOT = { trait = drunkard }
						NOT = { trait = decadent }
					}
				}
				health = -1.0
			}
			10 = {
				modifier = {
					factor = 0
					OR = {
						NOT = { trait = lustful }
						NOT = { trait = gluttonous }
						NOT = { trait = drunkard }
						NOT = { trait = decadent }
					}
				}
				health = -0.5
			}
			20 = {
				modifier = {
					factor = 0
					trait = lustful
				}
				add_trait = lustful
			}
			20 = {
				modifier = {
					factor = 0
					trait = gluttonous
				}
				add_trait = gluttonous
			}
			20 = {
				modifier = {
					factor = 0
					trait = drunkard
				}
				add_trait = drunkard
			}
			20 = {
				modifier = {
					factor = 0
					trait = decadent
				}
				add_trait = decadent
			}
			20 = {
				custom_tooltip = {
					text = EPIC_POEM_ADVANCES
					hidden_tooltip = {
						change_variable = { which = "poem_completeness" value = 1 }
					}
				}
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_1936 #Fast and pray
		piety = 100
		random_list = {
			20 = {
				modifier = {
					factor = 0
					trait = temperate
				}
				add_trait = temperate
			}
			20 = {
				health = -1
			}
			20 = {
				add_trait = ill
			}
			20 = {
				modifier = {
					factor = 0
					trait = diligent
				}
				add_trait = diligent
			}
			20 = {
				custom_tooltip = {
					text = EPIC_POEM_ADVANCES
					hidden_tooltip = {
						change_variable = { which = "poem_completeness" value = 1 }
					}
				}
			}
		}
	}
}

# Giving into despair
character_event = {
	id = emf_heresy.1937
	desc = EVTDESC_emf_heresy_1937
	picture = GFX_evt_diwan_poetry
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes

	option = {
		name = EVTOPTA_emf_heresy_1937 #Give up
		remove_character_modifier = writing_epic_poem
	}
	option = {
		name = EVTOPTB_emf_heresy_1937 #Try even harder
		trigger = { NOT = { trait = slothful } }
		random = {
			chance = 50
			add_trait = depressed
		}
		random = {
			chance = 50
			add_trait = stressed
			hidden_tooltip = {
				if = {
					limit = { trait = depressed }
					remove_trait = stressed
				}
			}
		}
		if = {
			limit = { NOT = { trait = diligent } }
			random = {
				chance = 50
				add_trait = diligent
			}
		}
		custom_tooltip = {
			text = EPIC_POEM_ADVANCES
			hidden_tooltip = {
				change_variable = { which = "poem_completeness" value = 1 }
			}
		}
	}
}

# Giving into procrastination
character_event = {
	id = emf_heresy.1938
	desc = EVTDESC_emf_heresy_1938
	picture = GFX_evt_diwan_poetry
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes

	option = {
		name = EVTOPTA_emf_heresy_1938 # I'll get around to it someday 
		if = {
			limit = { NOT = { trait = slothful } }
			random = {
				chance = 50
				add_trait = slothful
			}
		}
		random = {
			chance = 30
			custom_tooltip = {
				text = EPIC_POEM_ADVANCES
				hidden_tooltip = {
					change_variable = { which = "poem_completeness" value = 1 }
				}
			}
		}
	}
}

# Break through
character_event = {
	id = emf_heresy.1939
	desc = EVTDESC_emf_heresy_1939
	picture = GFX_evt_diwan_poetry
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes

	option = {
		name = EVTOPTA_emf_heresy_1939 #I'm pretty good at this
		prestige = 50
		custom_tooltip = {
			text = EPIC_POEM_ADVANCES
			hidden_tooltip = {
				change_variable = { which = "poem_completeness" value = 1 }
			}
		}
	}
}

# Epic Poem is completed!
character_event = {
	id = emf_heresy.1940
	desc = EVTDESC_emf_heresy_1940
	picture = GFX_evt_diwan_poetry
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_1940 #Finally!
		prestige = 1000
		piety = 500
		remove_character_modifier = writing_epic_poem
		add_trait = hurufi_diwan
		hidden_tooltip = {
			random_list = {
				30 = {
					modifier = {
						factor = 2
						trait = decadent
					}
					modifier = {
						factor = 1.5
						NOR = {
							diplomacy = 15
							learning = 15
						}
					}
					character_event = { id = emf_heresy.1941 days = 2 random = 2 } # Bad Result
				}
				70 = {
					modifier = {
						factor = 1.5
						diplomacy = 15
					}
					modifier = {
						factor = 1.5
						diplomacy = 20
					}
					character_event = { id = emf_heresy.1942 days = 2 random = 2 } # Good Result
				}
			}
		}
	}
}

# Epic Poem is not received well by the court 
character_event = {
	id = emf_heresy.1941
	desc = EVTDESC_emf_heresy_1941
	picture = GFX_evt_diwan_poetry
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	major = yes
	hide_from = yes
	show_ROOT = yes
	
	major_trigger = {
		same_realm = ROOT
	}

	option = {
		name = EVTOPTA_emf_heresy_1941
		trigger = { character = ROOT }
		prestige = -200
		remove_trait = hurufi_diwan
		random_list = {
			5 = {
				modifier = {
					factor = 0
					trait = lunatic
				}
				add_trait = lunatic
			}
			80 = {
				modifier = {
					factor = 0
					trait = shy
				}
				add_trait = shy
			}
			20 = {
				modifier = {
					factor = 0
					trait = wroth
				}
				add_trait = wroth
			}
			20 = {
				modifier = {
					factor = 0
					trait = paranoid
				}
				add_trait = paranoid
			}
		}
	}
	option = {
		name = I_SEE
		trigger = { NOT = { character = ROOT } }
	}
}

# Epic Poem is well-received by the court 
character_event = {
	id = emf_heresy.1942
	desc = EVTDESC_emf_heresy_1942
	picture = GFX_evt_diwan_poetry
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	major = yes
	hide_from = yes
	show_ROOT = yes
	
	major_trigger = {
		same_realm = ROOT
	}

	option = {
		name = EVTOPTA_emf_heresy_1942
		trigger = { character = ROOT }
		prestige = 100
	}
	option = {
		name = EVTOPTB_emf_heresy_1942
		trigger = { NOT = { character = ROOT } }
	}
}

# Bounce event for studying
character_event = {
	id = emf_heresy.1943
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hurufi_studying
	}
	
	immediate = {
		if = {
			limit = {
				OR = {
					NOT = { religion_group = muslim }
					prisoner = yes
					trait = incapable
					NOR = {
						has_focus = focus_theology
						is_playable = no
					}
				}
			}
			remove_character_modifier = hurufi_studying
			emf_can_disturb_effect = yes
			clr_character_flag = hurufi_studying_1
			clr_character_flag = hurufi_studying_2
			clr_character_flag = hurufi_studying_3
			break = yes
		}
		
		random_list = {
			5 = { 
				modifier = {
					factor = 0
					NOT = { age = 50 }
				}
				modifier = {
					factor = 2
					trait = infirm
				}
				modifier = {
					factor = 2
					OR = {
						has_character_flag = hurufi_studying_2
						has_character_flag = hurufi_studying_3
					}
				}
				character_event = { id = emf_heresy.1944 } #Go blind
			}
			10 = {
				modifier = {
					factor = 1.5
					has_character_flag = hurufi_studying_2
				}
				modifier = {
					factor = 0
					has_character_flag = hurufi_studying_3
				}
				character_event = { id = emf_heresy.1945 } #Increase attributes
			}
			15 = {
				modifier = {
					factor = 0
					is_weak_trigger = yes
				}
				modifier = {
					factor = 0.65
					has_character_flag = hurufi_studying_2
				}
				modifier = {
					factor = 0.35
					has_character_flag = hurufi_studying_3
				}
				character_event = { id = emf_heresy.1946 } #Becomes weak
			}
			5 = {
				modifier = {
					factor = 0
					is_smart_trigger = yes
				}
				modifier = {
					factor = 2
					has_character_flag = hurufi_studying_2
				}
				modifier = {
					factor = 0
					has_character_flag = hurufi_studying_3
				}
				character_event = { id = emf_heresy.1947 } #Becomes quick
			}
			5 = {
				modifier = {
					factor = 0
					trait = mystic
				}
				modifier = {
					factor = 0
					has_character_flag = hurufi_studying_1
				}
				modifier = {
					factor = 0.5
					has_character_flag = hurufi_studying_2
				}
				character_event = { id = emf_heresy.1948 } #Becomes mystic
			}
			5 = {
				modifier = {
					factor = 0
					OR = {
						has_character_flag = hurufi_studying_2
						has_character_flag = hurufi_studying_3
					}
				}
				character_event = { id = emf_heresy.1949 } #Becomes depressed
			}
			10 = {
				modifier = {
					factor = 0
					trait = chaste
				}
				modifier = {
					factor = 0.5
					has_character_flag = hurufi_studying_3
				}
				character_event = { id = emf_heresy.1950 } #Becomes chaste
			}
			5 = {
				modifier = {
					factor = 0
					OR = {
						trait = elusive_shadow
						trait = grey_eminence
						trait = midas_touched
						trait = brilliant_strategist
						trait = mastermind_theologian
					}
				}
				modifier = {
					factor = 2
					OR = {
						has_character_flag = hurufi_studying_2
						has_character_flag = hurufi_studying_3
					}
				}
				character_event = { id = emf_heresy.1951 } #Increases education trait
			}
			5 = {
				modifier = {
					factor = 0
					trait = genius
				}
				modifier = {
					factor = 0
					has_character_flag = hurufi_studying_1
				}
				modifier = {
					factor = 2
					has_character_flag = hurufi_studying_3
				}
				character_event = { id = emf_heresy.1952 } #Gains genius
			}
			10 = {
				modifier = {
					factor = 0
					trait = ill
				}
				character_event = { id = emf_heresy.1953 } #Becomes ill
			}
			15 = {
				modifier = {
					factor = 0
					OR = {
						has_character_flag = hurufi_studying_1
						has_character_flag = hurufi_studying_2
					}
				}
				character_event = { id = emf_heresy.1954 } #Wrong omen
			}
			30 = {
				modifier = {
					factor = 0
					OR = {
						has_character_flag = hurufi_studying_1
						has_character_flag = hurufi_studying_2
					}
				}
				character_event = { id = emf_heresy.1955 } #Good omen
			}
			15 = {
				modifier = {
					factor = 0
					OR = {
						has_character_flag = hurufi_studying_1
						has_character_flag = hurufi_studying_2
					}
				}
				character_event = { id = emf_heresy.1956 } #Bad omen
			}
			30 = {
				character_event = { id = emf_heresy.1957 } #Gains piety
			}
		}
		emf_can_disturb_effect = yes
		clr_character_flag = hurufi_studying_1
		clr_character_flag = hurufi_studying_2
		clr_character_flag = hurufi_studying_3
	}
}

# Studying character becomes blind
character_event = {
	id = emf_heresy.1944
	desc = EVTDESC_emf_heresy_1944
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes

	option = {
		name = EVTOPTA_emf_heresy_1944
		remove_character_modifier = hurufi_studying
		add_trait = blinded
	}
}

# Studying character gains attributes
character_event = {
	id = emf_heresy.1945
	desc = EVTDESC_emf_heresy_1945
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				learning = 20
				trait = hurufi_mystic_b
			}
			remove_trait = hurufi_mystic_b
			add_trait = hurufi_mystic_c
		}
		if = {
			limit = {
				learning = 14
				trait = hurufi_mystic_a
			}
			remove_trait = hurufi_mystic_a
			add_trait = hurufi_mystic_b
		}
		if = {
			limit = {
				learning = 8
				NOR = { 
					trait = hurufi_mystic_a
					trait = hurufi_mystic_b
					trait = hurufi_mystic_c
				}
			}
			add_trait = hurufi_mystic_a
		}
	}
	
	option = {
		name = EXCELLENT
		remove_character_modifier = hurufi_studying
		change_learning = 2
		random_list = {
			20 = { change_diplomacy = 1 }
			20 = { change_martial = 1 }
			20 = { change_stewardship = 1 }
			20 = { change_intrigue = 1 }
		}	
	}
}

# Studying character becomes weak
character_event = {
	id = emf_heresy.1946
	desc = EVTDESC_emf_heresy_1946
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				learning = 20
				trait = hurufi_mystic_b
			}
			remove_trait = hurufi_mystic_b
			add_trait = hurufi_mystic_c
		}
		if = {
			limit = {
				learning = 14
				trait = hurufi_mystic_a
			}
			remove_trait = hurufi_mystic_a
			add_trait = hurufi_mystic_b
		}
		if = {
			limit = {
				learning = 8
				NOR = { 
					trait = hurufi_mystic_a
					trait = hurufi_mystic_b
					trait = hurufi_mystic_c
				}
			}
			add_trait = hurufi_mystic_a
		}
	}

	option = {
		name = CURSES
		remove_character_modifier = hurufi_studying
		change_learning = 2
		if = {
			limit = {
				NOT = { is_strong_trigger = yes }
				NOT = { is_weak_trigger = yes }
			}
			add_trait = feeble
		}
		if = {
			limit = { is_strong_trigger = yes }
			remove_trait = strong
			remove_trait = robust
		}
	}
}

# Studying character becomes quick
character_event = {
	id = emf_heresy.1947
	desc = EVTDESC_emf_heresy_1947
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				learning = 20
				trait = hurufi_mystic_b
			}
			remove_trait = hurufi_mystic_b
			add_trait = hurufi_mystic_c
		}
		if = {
			limit = {
				learning = 14
				trait = hurufi_mystic_a
			}
			remove_trait = hurufi_mystic_a
			add_trait = hurufi_mystic_b
		}
		if = {
			limit = {
				learning = 8
				NOR = { 
					trait = hurufi_mystic_a
					trait = hurufi_mystic_b
					trait = hurufi_mystic_c
				}
			}
			add_trait = hurufi_mystic_a
		}
	}
	
	option = {
		name = EXCELLENT
		remove_character_modifier = hurufi_studying
		change_learning = 2
		add_trait = quick
	}
}

# Studying character becomes mystic
character_event = {
	id = emf_heresy.1948
	desc = EVTDESC_emf_heresy_1948
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				learning = 20
				trait = hurufi_mystic_b
			}
			remove_trait = hurufi_mystic_b
			add_trait = hurufi_mystic_c
		}
		if = {
			limit = {
				learning = 14
				trait = hurufi_mystic_a
			}
			remove_trait = hurufi_mystic_a
			add_trait = hurufi_mystic_b
		}
		if = {
			limit = {
				learning = 8
				NOR = { 
					trait = hurufi_mystic_a
					trait = hurufi_mystic_b
					trait = hurufi_mystic_c
				}
			}
			add_trait = hurufi_mystic_a
		}
	}
	
	option = {
		name = EXCELLENT
		remove_character_modifier = hurufi_studying
		change_learning = 2
		if = {
			limit = { trait = scholar }
			remove_trait = scholar
		}
		if = {
			limit = { trait = theologian }
			remove_trait = theologian
		}
		add_trait = mystic
	}
}

# Studying character becomes depressed
character_event = {
	id = emf_heresy.1949
	desc = EVTDESC_emf_heresy_1949
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes

	option = {
		name = CURSES
		remove_character_modifier = hurufi_studying
		change_learning = -1
		add_trait = depressed
	}
}

# Studying character becomes chaste
character_event = {
	id = emf_heresy.1950
	desc = EVTDESC_emf_heresy_1950
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				learning = 20
				trait = hurufi_mystic_b
			}
			remove_trait = hurufi_mystic_b
			add_trait = hurufi_mystic_c
		}
		if = {
			limit = {
				learning = 14
				trait = hurufi_mystic_a
			}
			remove_trait = hurufi_mystic_a
			add_trait = hurufi_mystic_b
		}
		if = {
			limit = {
				learning = 8
				NOR = { 
					trait = hurufi_mystic_a
					trait = hurufi_mystic_b
					trait = hurufi_mystic_c
				}
			}
			add_trait = hurufi_mystic_a
		}
	}
	
	option = {
		name = OK
		remove_character_modifier = hurufi_studying
		change_learning = 2
		add_trait = chaste
		piety = 50
	}
}

# Studying character increases education trait
character_event = {
	id = emf_heresy.1951
	desc = EVTDESC_emf_heresy_1951
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				learning = 20
				trait = hurufi_mystic_b
			}
			remove_trait = hurufi_mystic_b
			add_trait = hurufi_mystic_c
		}
		if = {
			limit = {
				learning = 14
				trait = hurufi_mystic_a
			}
			remove_trait = hurufi_mystic_a
			add_trait = hurufi_mystic_b
		}
		if = {
			limit = {
				learning = 8
				NOR = { 
					trait = hurufi_mystic_a
					trait = hurufi_mystic_b
					trait = hurufi_mystic_c
				}
			}
			add_trait = hurufi_mystic_a
		}
	}
	
	option = {
		name = EXCELLENT
		remove_character_modifier = hurufi_studying
		change_learning = 2
		if = {
			limit = { trait = skilled_tactician }
			remove_trait = skilled_tactician
			add_trait = brilliant_strategist
		}
		if = {
			limit = { trait = tough_soldier }
			remove_trait = tough_soldier
			add_trait = skilled_tactician
		}
		if = {
			limit = { trait = misguided_warrior }
			remove_trait = misguided_warrior
			add_trait = tough_soldier
		}	
		if = {
			limit = { trait = intricate_webweaver }
			remove_trait = intricate_webweaver
			add_trait = elusive_shadow
		}
		if = {
			limit = { trait = flamboyant_schemer }
			remove_trait = flamboyant_schemer
			add_trait = intricate_webweaver
		}
		if = {
			limit = { trait = amateurish_plotter }
			remove_trait = amateurish_plotter
			add_trait = flamboyant_schemer
		}	
		if = {
			limit = { trait = charismatic_negotiator }
			remove_trait = charismatic_negotiator
			add_trait = grey_eminence
		}
		if = {
			limit = { trait = underhanded_rogue }
			remove_trait = underhanded_rogue
			add_trait = charismatic_negotiator
		}
		if = {
			limit = { trait = naive_appeaser }
			remove_trait = naive_appeaser
			add_trait = underhanded_rogue
		}		
		if = {
			limit = { trait = fortune_builder }
			remove_trait = fortune_builder
			add_trait = midas_touched
		}
		if = {
			limit = { trait = thrifty_clerk }
			remove_trait = thrifty_clerk
			add_trait = fortune_builder
		}
		if = {
			limit = { trait = indulgent_wastrel }
			remove_trait = indulgent_wastrel
			add_trait = thrifty_clerk
		}
		if = {
			limit = { trait = scholarly_theologian }
			remove_trait = scholarly_theologian
			add_trait = mastermind_theologian
		}
		if = {
			limit = { trait = martial_cleric }
			remove_trait = martial_cleric
			add_trait = scholarly_theologian
		}
		if = {
			limit = { trait = detached_priest }
			remove_trait = detached_priest
			add_trait = martial_cleric
		}
	}
}

# Studying character becomes genius
character_event = {
	id = emf_heresy.1952
	desc = EVTDESC_emf_heresy_1952
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				learning = 20
				trait = hurufi_mystic_b
			}
			remove_trait = hurufi_mystic_b
			add_trait = hurufi_mystic_c
		}
		if = {
			limit = {
				learning = 14
				trait = hurufi_mystic_a
			}
			remove_trait = hurufi_mystic_a
			add_trait = hurufi_mystic_b
		}
		if = {
			limit = {
				learning = 8
				NOR = { 
					trait = hurufi_mystic_a
					trait = hurufi_mystic_b
					trait = hurufi_mystic_c
				}
			}
			add_trait = hurufi_mystic_a
		}
	}
	
	option = {
		name = EXCELLENT
		remove_character_modifier = hurufi_studying
		change_learning = 2
		add_trait = genius
	}
}

# Studying character becomes ill
character_event = {
	id = emf_heresy.1953
	desc = EVTDESC_emf_heresy_1953
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				learning = 20
				trait = hurufi_mystic_b
			}
			remove_trait = hurufi_mystic_b
			add_trait = hurufi_mystic_c
		}
		if = {
			limit = {
				learning = 14
				trait = hurufi_mystic_a
			}
			remove_trait = hurufi_mystic_a
			add_trait = hurufi_mystic_b
		}
		if = {
			limit = {
				learning = 8
				NOR = { 
					trait = hurufi_mystic_a
					trait = hurufi_mystic_b
					trait = hurufi_mystic_c
				}
			}
			add_trait = hurufi_mystic_a
		}
	}
	
	option = {
		name = OK
		remove_character_modifier = hurufi_studying
		change_learning = 1
		add_trait = ill
	}
}

# Wrong Omen
character_event = {
	id = emf_heresy.1954
	desc = EVTDESC_emf_heresy_1954
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = CURSES
		if = {
			limit = { has_character_modifier = hurufi_studying }
			remove_character_modifier = hurufi_studying
			add_trait = depressed
			change_learning = -1
		}
		add_character_modifier = {
			name = wrong_omen
			duration = 365
		}
	}
}

# Good Omen
character_event = {
	id = emf_heresy.1955
	desc = EVTDESC_emf_heresy_1955
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				learning = 20
				trait = hurufi_mystic_b
			}
			remove_trait = hurufi_mystic_b
			add_trait = hurufi_mystic_c
		}
		if = {
			limit = {
				learning = 14
				trait = hurufi_mystic_a
			}
			remove_trait = hurufi_mystic_a
			add_trait = hurufi_mystic_b
		}
		if = {
			limit = {
				learning = 8
				NOR = { 
					trait = hurufi_mystic_a
					trait = hurufi_mystic_b
					trait = hurufi_mystic_c
				}
			}
			add_trait = hurufi_mystic_a
		}
	}
	
	option = {
		name = EXCELLENT
		if = {
			limit = { has_character_modifier = hurufi_studying }
			remove_character_modifier = hurufi_studying
			change_learning = 2
		}
		add_character_modifier = {
			name = good_omen
			duration = 365
		}
	}
}

# Bad Omen
character_event = {
	id = emf_heresy.1956
	desc = EVTDESC_emf_heresy_1956
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				learning = 20
				trait = hurufi_mystic_b
			}
			remove_trait = hurufi_mystic_b
			add_trait = hurufi_mystic_c
		}
		if = {
			limit = {
				learning = 14
				trait = hurufi_mystic_a
			}
			remove_trait = hurufi_mystic_a
			add_trait = hurufi_mystic_b
		}
		if = {
			limit = {
				learning = 8
				NOR = { 
					trait = hurufi_mystic_a
					trait = hurufi_mystic_b
					trait = hurufi_mystic_c
				}
			}
			add_trait = hurufi_mystic_a
		}
	}
	
	option = {
		name = OK
		if = {
			limit = { has_character_modifier = hurufi_studying }
			remove_character_modifier = hurufi_studying
			change_learning = 1
		}
		add_character_modifier = {
			name = bad_omen
			duration = 365
		}
	}
}

# Studying character receives bonus piety
character_event = {
	id = emf_heresy.1957
	desc = EVTDESC_emf_heresy_1957
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				learning = 20
				trait = hurufi_mystic_b
			}
			remove_trait = hurufi_mystic_b
			add_trait = hurufi_mystic_c
		}
		if = {
			limit = {
				learning = 14
				trait = hurufi_mystic_a
			}
			remove_trait = hurufi_mystic_a
			add_trait = hurufi_mystic_b
		}
		if = {
			limit = {
				learning = 8
				NOR = { 
					trait = hurufi_mystic_a
					trait = hurufi_mystic_b
					trait = hurufi_mystic_c
				}
			}
			add_trait = hurufi_mystic_a
		}
	}
	
	option = {
		name = EXCELLENT
		if = {
			limit = { has_character_modifier = hurufi_studying }
			remove_character_modifier = hurufi_studying
			change_learning = 1
		}
		piety = 150
	}
}

# Bounce event for reading omens
character_event = {
	id = emf_heresy.1958
	
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		remove_character_modifier = do_not_disturb
		add_character_modifier = {
			name = hurufi_prediction
			duration = 730
		}
		random_list = {
			10 = { character_event = { id = emf_heresy.1954 } } #Wrong Omen
			50 = { character_event = { id = emf_heresy.1955 } } #Good Omen
			20 = { character_event = { id = emf_heresy.1956 } } #Bad Omen
			20 = { character_event = { id = emf_heresy.1957 } } #Extra Piety
		}
	}
}


#######################################
# DRUZE EVENTS
#######################################

# Druze becomes Uqqal after studying
character_event = {
	id = emf_heresy.1965
	desc = EVTDESC_emf_heresy_1965
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	min_age = 16
	religion = druze
	capable_only = yes
	prisoner = no
	
	trigger = {
		learning = 8
		trait = druze_juhhal
		piety = 0
		OR = { 
			has_focus = focus_theology
			has_ambition = obj_druze_esoteric_learning
		}
		OR = {
			trait = just
			trait = temperate
			trait = charitable
			trait = humble
			has_ambition = obj_druze_esoteric_learning
		} 
		NOR = {
			trait = druze_uqqal
			trait = druze_ajawid
			trait = cynical
			has_character_flag = no_druze_initiate
		}
	}
	
	mean_time_to_happen = {
		years = 5
		modifier = {
			factor = 0.8
			trait = just
		}
		modifier = {
			factor = 0.8
			trait = temperate
		}
		modifier = {
			factor = 0.8
			trait = charitable
		}
		modifier = {
			factor = 0.8
			trait = humble
		}
		modifier = {
			factor = 1.5
			trait = arbitrary
		}
		modifier = {
			factor = 1.5
			trait = gluttonous
		}
		modifier = {
			factor = 1.5
			trait = greedy
		}
		modifier = {
			factor = 1.5
			trait = proud
		}
		modifier = {
			factor = 0.9
			piety = 100
		}
		modifier = {
			factor = 0.8
			learning = 10
		}
		modifier = {
			factor = 0.8
			learning = 12
		}
		modifier = {
			factor = 0.8
			learning = 14
		}
		modifier = {
			factor = 0.8
			learning = 16
		}
		modifier = {
			factor = 0.8
			learning = 18
		}
		modifier = {
			factor = 0.8
			learning = 20
		}
		modifier = {
			factor = 0.5
			has_focus = focus_theology
			has_ambition = obj_druze_esoteric_learning
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_1965
		narrative_event = { id = emf_heresy.1966 days = 1 random = 2 }
	}	
	option = {
		name = EVTOPTB_emf_heresy_1965
		set_character_flag = no_druze_initiate
		piety = -50
	}
}

narrative_event = {
	id = emf_heresy.1966
	title = EVTNAME_emf_heresy_1966
	desc = EVTDESC_emf_heresy_1966
	picture = GFX_evt_imam
	border = GFX_event_narrative_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_1966
		add_trait = druze_uqqal
	}
}

# Druze Uqqal becomes Ajawid
character_event = {
	id = emf_heresy.1967
	desc = EVTDESC_emf_heresy_1967
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	
	min_age = 16
	religion = druze
	capable_only = yes
	prisoner = no
	
	trigger = {
		trait = druze_uqqal
		piety = 250
		learning = 12
		calc_true_if = {
			amount = 2
			trait = just
			trait = temperate
			trait = charitable
			trait = humble
			learning = 15
			piety = 500
		}
		NOR = {
			trait = druze_ajawid
			trait = cynical
			trait = slothful
			trait = cruel
			trait = lunatic
			trait = decadent
		}
	}
	
	mean_time_to_happen = {
		years = 10
		modifier = {
			factor = 0.8
			trait = just
		}
		modifier = {
			factor = 0.8
			trait = temperate
		}
		modifier = {
			factor = 0.8
			trait = charitable
		}
		modifier = {
			factor = 0.8
			trait = humble
		}
		modifier = {
			factor = 1.5
			trait = arbitrary
		}
		modifier = {
			factor = 1.5
			trait = gluttonous
		}
		modifier = {
			factor = 1.5
			trait = greedy
		}
		modifier = {
			factor = 1.5
			trait = proud
		}
		modifier = {
			factor = 0.9
			piety = 500
		}
		modifier = {
			factor = 0.9
			piety = 750
		}
		modifier = {
			factor = 0.9
			piety = 1000
		}
		modifier = {
			factor = 0.5
			has_focus = focus_theology
		}
		modifier = {
			factor = 1.5
			top_liege = { 
				any_realm_character = {
					trait = druze_ajawid
				}
			}
		}
		modifier = {
			factor = 2.0
			top_liege = { 
				any_realm_character = {
					trait = druze_ajawid
					count = 2
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_1967
		piety = 200
		add_trait = druze_ajawid
	}
}

# Druze Shaykh becomes religion head
narrative_event = {
	id = emf_heresy.1968
	title = EVTNAME_emf_heresy_1968
	desc = EVTDESC_emf_heresy_1968
	picture = GFX_evt_imam
	border = GFX_event_narrative_frame_religion

	is_triggered_only = yes
	major = yes
	
	immediate = {
		set_global_flag = druze_shaykh
	}
	
	option = {
		name = EVTOPTA_emf_heresy_1968
		trigger = { religion = druze }
	}
	option = {
		name = EVTOPTB_emf_heresy_1968
		trigger = {
			NOT = { religion = druze }
			religion_group = muslim
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_1968
		trigger = {
			NOT = { religion_group = muslim }
		}
	}
}


#######################################
# SHI'ITE EVENTS
#######################################

# Isma'ili Imamah claimant passes on trait to heir
character_event = {
	id = emf_heresy.1970
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		trait = imamah_claimant
	}
	
	immediate = {
		remove_trait = imamah_claimant
		# Pass it onto heir first, if one exists
		if = {
			limit = {
				is_ruler = yes
				current_heir = {
					is_female = no
					religion = ismaili
					NOT = { trait = incapable }
				}
			}
			current_heir = {
				set_character_flag = is_imamah_claimant
				add_trait = imamah_claimant
				add_pressed_claim = d_ismaili
			}		
			break = yes
		}
		# Then pass onto eldest son
		random_child = {
			limit = {
				is_alive = yes
				is_female = no
				religion = ismaili
				NOR = {
					trait = bastard
					trait = incapable
					any_sibling = {
						is_alive = yes
						is_female = no
						religion = ismaili
						NOT = { trait = bastard }
						NOT = { trait = incapable }
						is_older_than = PREV
					}
				}
			}
			set_character_flag = is_imamah_claimant
			add_trait = imamah_claimant
			add_pressed_claim = d_ismaili
			break = yes
		}
		# Then pass onto eldest brother
		random_sibling = {
			limit = {
				is_alive = yes
				is_female = no
				trait = sayyid
				religion = ismaili
				NOR = {
					trait = bastard
					trait = incapable
					any_sibling = {
						is_alive = yes
						is_female = no
						trait = sayyid
						religion = ismaili
						NOT = { trait = bastard }
						NOT = { trait = incapable }
						NOT = { character = ROOT }
						is_older_than = PREV
					}
				}
			}
			set_character_flag = is_imamah_claimant
			add_trait = imamah_claimant
			add_pressed_claim = d_ismaili
			break = yes
		}
		# Then pass onto eldest grandson
		random_dynasty_member = {
			limit = {
				is_alive = yes
				is_female = no
				trait = sayyid
				religion = ismaili
				father_even_if_dead = {
					is_child_of = ROOT
					NOT = { trait = bastard }
				}
				NOR = {
					trait = bastard
					trait = incapable
					any_dynasty_member = {
						is_alive = yes
						is_female = no
						trait = sayyid
						religion = ismaili
						father_even_if_dead = {
							is_child_of = ROOT
							NOT = { trait = bastard }
						}
						NOT = { trait = bastard }
						NOT = { trait = incapable }
						is_older_than = PREV
					}
				}
			}
			set_character_flag = is_imamah_claimant
			add_trait = imamah_claimant
			add_pressed_claim = d_ismaili
		}
	}
}

# Existing Imamah claimant starts uprising
character_event = {
	id = emf_heresy.1971
	
	hide_window = yes
	
	min_age = 18
	max_age = 50
	only_men = yes
	capable_only = yes
	prisoner = no
	religion = ismaili

	trigger = {
		ai = yes
		year = 900
		trait = imamah_claimant
		d_ismaili = { has_holder = no }
		OR = {
			diplomacy = 8
			martial = 8
		}
		NOR = {
			higher_tier_than = DUKE
			trait = incapable
			trait = content
			trait = humble
			trait = cynical
			trait = imbecile
			trait = inbred
			has_character_flag = led_ismaili_caliphate_revolt
			has_global_flag = ismaili_caliphate_revolt
			has_global_flag = ismaili_caliphate_revolt_ongoing
		}
		any_independent_ruler = {
			ai = yes
			is_landed = yes
			higher_tier_than = DUKE
			religion_group = muslim
			NOT = { religion = ismaili }
			OR = {
				trait = dynasty_decadence_low
				trait = dynasty_decadence_med
				trait = dynasty_decadence_high
			}
			OR = {
				NOT = { is_liege_of = ROOT }
				NOT = { reverse_opinion = { who = ROOT value = 0 } }
			}
			capital_scope = {
				OR = {
					region = world_persia
					region = world_middle_east_jerusalem
					region = world_africa_north
				}
			}
			any_realm_province = {
				religion_group = muslim
				OR = {
					region = world_persia
					region = world_middle_east_jerusalem
					region = world_africa_north
				}
				kingdom = {
					OR = {
						has_holder = no
						holder_scope = { character = PREVPREVPREV }
					}
					num_title_realm_provs = {
						who = PREVPREV
						value = 6
					}
				}
			}
		}
	}
	
	mean_time_to_happen = {
		months = 100
		modifier = {
			factor = 0.5
			trait = ambitious
		}
		modifier = {
			factor = 0.75
			trait = zealous
		}
		modifier = {
			factor = 2
			NOT = { diplomacy = 4 }
		}
		modifier = {
			factor = 1.5
			NOT = { diplomacy = 8 }
		}
		modifier = {
			factor = 0.8
			diplomacy = 12
		}
		modifier = {
			factor = 0.8
			diplomacy = 14
		}
		modifier = {
			factor = 0.8
			diplomacy = 16
		}
		modifier = {
			factor = 0.8
			diplomacy = 18
		}
		modifier = {
			factor = 0.8
			diplomacy = 20
		}
		modifier = {
			factor = 2
			NOT = { martial = 4 }
		}
		modifier = {
			factor = 1.5
			NOT = { martial = 8 }
		}
		modifier = {
			factor = 0.8
			martial = 12
		}
		modifier = {
			factor = 0.8
			martial = 14
		}
		modifier = {
			factor = 0.8
			martial = 16
		}
		modifier = {
			factor = 0.8
			martial = 18
		}
		modifier = {
			factor = 0.8
			martial = 20
		}
		modifier = {
			factor = 1.5
			NOT = { intrigue = 4 }
		}
		modifier = {
			factor = 1.25
			NOT = { intrigue = 8 }
		}
		modifier = {
			factor = 0.9
			intrigue = 12
		}
		modifier = {
			factor = 0.9
			intrigue = 14
		}
		modifier = {
			factor = 0.9
			intrigue = 16
		}
		modifier = {
			factor = 0.9
			intrigue = 18
		}
		modifier = {
			factor = 0.9
			intrigue = 20
		}
		modifier = {
			factor = 1.5
			NOR = {
				diplomacy = 12
				martial = 12
				intrigue = 12
			}
		}
		modifier = {
			factor = 0.5
			year = 900
		}
		modifier = {
			factor = 0.5
			year = 950
		}
		modifier = {
			factor = 0.25
			year = 1000
		}
		modifier = {
			factor = 0.25
			year = 1050
		}
		modifier = {
			factor = 0.25
			year = 1100
		}
	}
	
	immediate = {
		log = "emf_heresy.1971: [Root.GetBestName] is an existing Isma'ili Imamah claimant who has begun the Isma'ili Caliphate Revolt"
		set_character_flag = ismaili_caliphate_pretender
		set_character_flag = led_ismaili_caliphate_revolt
		set_global_flag = ismaili_caliphate_revolt
		save_event_target_as = ismaili_revolter
		
		# Give priority to Africa/Egypt
		random_independent_ruler = {
			limit = {
				ai = yes
				is_landed = yes
				higher_tier_than = DUKE
				religion_group = muslim
				NOT = { religion = ismaili }
				OR = {
					trait = dynasty_decadence_low
					trait = dynasty_decadence_med
					trait = dynasty_decadence_high
				}
				OR = {
					NOT = { is_liege_of = ROOT }
					NOT = { reverse_opinion = { who = ROOT value = 0 } }
				}
				capital_scope = {
					OR = {
						region = world_persia
						region = world_middle_east_jerusalem
						region = world_africa_north
					}
				}
				any_realm_province = {
					religion_group = muslim
					kingdom = {
						OR = {
							title = k_egypt
							title = k_africa
						}
						OR = {
							has_holder = no
							holder_scope = { character = PREVPREVPREV }
						}
						num_title_realm_provs = {
							who = PREVPREV
							value = 6
						}
					}
				}
			}
			save_event_target_as = ismaili_revolt_target
			random_realm_province = {
				limit = {
					religion_group = muslim
					kingdom = {
						OR = {
							title = k_egypt
							title = k_africa
						}
						OR = {
							has_holder = no
							holder_scope = { character = PREVPREVPREV }
						}
						num_title_realm_provs = {
							who = PREVPREV
							value = 6
						}
					}
				}
				kingdom = { save_event_target_as = ismaili_revolt_target_title }
			}
			if = {
				limit = {
					is_ruler = yes
					primary_title = {
						NOT = { kingdom = { title = event_target:ismaili_revolt_target_title } }
					}
				}
				set_character_flag = abdicated_claimant
				primary_title = { save_event_target_as = abdicated_title }
				current_heir = {
					ROOT = { transfer_scaled_wealth = { to = PREV value = all } }
				}
				abdicate = yes
			}
			event_target:ismaili_revolter = {
				narrative_event = { id = emf_heresy.1972 }
			}
			break = yes
		}
		
		# Then anywhere else on continental Africa
		random_independent_ruler = {
			limit = {
				ai = yes
				is_landed = yes
				higher_tier_than = DUKE
				religion_group = muslim
				NOT = { religion = ismaili }
				OR = {
					trait = dynasty_decadence_low
					trait = dynasty_decadence_med
					trait = dynasty_decadence_high
				}
				OR = {
					NOT = { is_liege_of = ROOT }
					NOT = { reverse_opinion = { who = ROOT value = 0 } }
				}
				capital_scope = {
					OR = {
						region = world_persia
						region = world_middle_east_jerusalem
						region = world_africa_north
					}
				}
				any_realm_province = {
					religion_group = muslim
					region = world_africa_north
					kingdom = {
						OR = {
							has_holder = no
							holder_scope = { character = PREVPREVPREV }
						}
						num_title_realm_provs = {
							who = PREVPREV
							value = 6
						}
					}
				}
			}
			save_event_target_as = ismaili_revolt_target
			random_realm_province = {
				limit = {
					religion_group = muslim
					region = world_africa_north
					kingdom = {
						OR = {
							has_holder = no
							holder_scope = { character = PREVPREVPREV }
						}
						num_title_realm_provs = {
							who = PREVPREV
							value = 6
						}
					}
				}
				kingdom = { save_event_target_as = ismaili_revolt_target_title }
			}
			if = {
				limit = {
					is_ruler = yes
					primary_title = {
						NOT = { kingdom = { title = event_target:ismaili_revolt_target_title } }
					}
				}
				set_character_flag = abdicated_claimant
				primary_title = { save_event_target_as = abdicated_title }
				current_heir = {
					ROOT = { transfer_scaled_wealth = { to = PREV value = all } }
				}
				abdicate = yes
			}
			event_target:ismaili_revolter = {
				narrative_event = { id = emf_heresy.1972 }
			}
			break = yes
		}

		# Failing that, anywhere valid will do
		random_independent_ruler = {
			limit = {
				ai = yes
				is_landed = yes
				higher_tier_than = DUKE
				religion_group = muslim
				NOT = { religion = ismaili }
				OR = {
					trait = dynasty_decadence_low
					trait = dynasty_decadence_med
					trait = dynasty_decadence_high
				}
				OR = {
					NOT = { is_liege_of = ROOT }
					NOT = { reverse_opinion = { who = ROOT value = 0 } }
				}
				capital_scope = {
					OR = {
						region = world_persia
						region = world_middle_east_jerusalem
						region = world_africa_north
					}
				}
				any_realm_province = {
					religion_group = muslim
					OR = {
						region = world_persia
						region = world_middle_east_jerusalem
						region = world_africa_north
					}
					kingdom = {
						OR = {
							has_holder = no
							holder_scope = { character = PREVPREVPREV }
						}
						num_title_realm_provs = {
							who = PREVPREV
							value = 6
						}
					}
				}
			}
			save_event_target_as = ismaili_revolt_target
			random_realm_province = {
				limit = {
					religion_group = muslim
					OR = {
						region = world_persia
						region = world_middle_east_jerusalem
						region = world_africa_north
					}
					kingdom = {
						OR = {
							has_holder = no
							holder_scope = { character = PREVPREVPREV }
						}
						num_title_realm_provs = {
							who = PREVPREV
							value = 6
						}
					}
				}
				kingdom = { save_event_target_as = ismaili_revolt_target_title }
			}
		}		
		if = {
			limit = {
				is_ruler = yes
				primary_title = {
					NOT = { kingdom = { title = event_target:ismaili_revolt_target_title } }
				}
			}
			set_character_flag = abdicated_claimant
			primary_title = { save_event_target_as = abdicated_title }
			current_heir = {
				ROOT = { transfer_scaled_wealth = { to = PREV value = all } }
			}
			abdicate = yes
		}
		event_target:ismaili_revolter = {
			narrative_event = { id = emf_heresy.1972 }
		}
	}
}

# Main Isma'ili Caliphate Revolt event
narrative_event = {
	id = emf_heresy.1972
	title = EVTNAME_emf_heresy_1972
	picture = GFX_evt_bishop_muslim
	border = GFX_event_narrative_frame_religion
	
	desc = {
		text = EVTDESC_emf_heresy_1972_found
		trigger = {
			event_target:ismaili_revolter = {
				has_character_flag = found_claimant
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1972_abdicate
		trigger = {
			event_target:ismaili_revolter = {
				NOT = { has_character_flag = found_claimant }
				has_character_flag = abdicated_claimant
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1972
		trigger = {
			event_target:ismaili_revolter = {
				NOT = { has_character_flag = found_claimant }
				NOT = { has_character_flag = abdicated_claimant }
			}
		}
	}

	is_triggered_only = yes
	hide_from = yes
	show_ROOT = yes
	major = yes
	
	immediate = {
		set_global_flag = ismaili_caliphate_revolt_ongoing
		event_target:ismaili_revolt_target = {
			random_realm_province = {
				limit = { kingdom = { title = event_target:ismaili_revolt_target_title } }
				event_target:ismaili_revolter = {
					create_title = {
						tier = KING
						landless = yes
						temporary = yes
						culture = THIS
						name = ISMAILI_CALIPHATE_REVOLT
						holder = THIS
						ruler = "IMAM"
						ruler_female = "IMAMA"
						foa = "CALIPH_FOA"
					}
					primary_title = {
						add_law = succ_turkish_succession
					}
					any_dynasty_member = {
						limit = {
							is_ruler = no
							prisoner = no
							is_close_relative = PREV
						}
						move_character = PREV
					}
					create_character = {
						random_traits = yes
						dynasty = none
						religion = THIS
						culture = THIS
						female = no
						age = 30
						trait = brilliant_strategist
					}
					new_character = {
						opinion = { who = PREV modifier = opinion_loyal_vassal multiplier = 2 }
						spawn_unit = {
							province = PREVPREV
							home = PREVPREV
							owner = PREV
							match_character = PREVPREVPREV
							match_mult = 0.5
							attrition = 0.25
							maintenance_multiplier = 0
							reinforces = yes
							disband_on_peace = yes
						}
					}
					create_character = {
						random_traits = yes
						dynasty = none
						religion = THIS
						culture = THIS
						female = no
						age = 27
						trait = brilliant_strategist
					}
					new_character = {
						opinion = { who = PREV modifier = opinion_loyal_vassal multiplier = 2 }
						spawn_unit = {
							province = PREVPREV
							home = PREVPREV
							owner = PREV
							match_character = PREVPREVPREV
							match_mult = 0.3
							attrition = 0.25
							maintenance_multiplier = 0
							reinforces = yes
							disband_on_peace = yes
						}
					}
					create_character = {
						random_traits = yes
						dynasty = none
						religion = THIS
						culture = THIS
						female = no
						age = 25
						trait = skilled_tactician
					}
					new_character = {
						opinion = { who = PREV modifier = opinion_loyal_vassal multiplier = 2 }
						spawn_unit = {
							province = PREVPREV
							home = PREVPREV
							owner = PREV
							match_character = PREVPREVPREV
							match_mult = 0.15
							attrition = 0.25
							maintenance_multiplier = 0
							disband_on_peace = yes
						}
					}
					create_character = {
						random_traits = yes
						dynasty = none
						religion = THIS
						culture = THIS
						female = no
						age = 23
						trait = skilled_tactician
					}
					new_character = {
						opinion = { who = PREV modifier = opinion_loyal_vassal multiplier = 2 }
						spawn_unit = {
							province = PREVPREV
							home = PREVPREV
							owner = PREV
							match_character = PREVPREVPREV
							match_mult = 0.15
							attrition = 0.25
							maintenance_multiplier = 0
							disband_on_peace = yes
						}
					}
					create_character = {
						random_traits = yes
						dynasty = none
						religion = THIS
						culture = THIS
						female = no
						age = 27
						trait = skilled_tactician
					}
					new_character = {
						opinion = { who = PREV modifier = opinion_loyal_vassal multiplier = 2 }
						spawn_unit = {
							province = PREVPREV
							home = PREVPREV
							owner = PREV
							match_character = PREVPREVPREV
							match_mult = 0.15
							attrition = 0.25
							maintenance_multiplier = 0
							disband_on_peace = yes
						}
					}
					create_character = {
						random_traits = yes
						dynasty = none
						religion = THIS
						culture = THIS
						female = no
						age = 24
						trait = skilled_tactician
					}
					new_character = {
						opinion = { who = PREV modifier = opinion_loyal_vassal multiplier = 2 }
						spawn_unit = {
							province = PREVPREV
							home = PREVPREV
							owner = PREV
							match_character = PREVPREVPREV
							match_mult = 0.15
							attrition = 0.25
							maintenance_multiplier = 0
							disband_on_peace = yes
						}
					}
					create_character = {
						random_traits = yes
						dynasty = none
						religion = THIS
						culture = THIS
						female = no
						age = 32
						trait = brilliant_strategist
					}
					new_character = {
						opinion = { who = PREV modifier = opinion_loyal_vassal multiplier = 2 }
						spawn_unit = {
							province = PREVPREV
							home = PREVPREV
							owner = PREV
							match_character = PREVPREVPREV
							match_mult = 0.15
							attrition = 0.25
							maintenance_multiplier = 0
							cannot_inherit = yes
							disband_on_peace = yes
						}
					}
					create_character = {
						random_traits = yes
						dynasty = none
						religion = THIS
						culture = THIS
						female = no
						age = 25
						trait = skilled_tactician
					}
					new_character = {
						opinion = { who = PREV modifier = opinion_loyal_vassal multiplier = 2 }
						spawn_unit = {
							province = PREVPREV
							home = PREVPREV
							owner = PREV
							match_character = PREVPREVPREV
							match_mult = 0.15
							attrition = 0.25
							maintenance_multiplier = 0
							cannot_inherit = yes
							disband_on_peace = yes
						}
					}
					create_character = {
						random_traits = yes
						dynasty = none
						religion = THIS
						culture = THIS
						female = no
						age = 28
						trait = skilled_tactician
					}
					new_character = {
						opinion = { who = PREV modifier = opinion_loyal_vassal multiplier = 2 }
						spawn_unit = {
							province = PREVPREV
							home = PREVPREV
							owner = PREV
							match_character = PREVPREVPREV
							match_mult = 0.15
							attrition = 0.25
							maintenance_multiplier = 0
							cannot_inherit = yes
							disband_on_peace = yes
						}
					}
					create_random_priest = {
						random_traits = yes
						dynasty = none
						religion = THIS
						culture = THIS
						female = no
						age = 50
					}
					new_character = {
						opinion = { who = PREV modifier = opinion_loyal_vassal multiplier = 2 }
					}
					create_random_diplomat = {
						random_traits = yes
						dynasty = none
						religion = THIS
						culture = THIS
						female = no
						age = 40
					}
					new_character = {
						opinion = { who = PREV modifier = opinion_loyal_vassal multiplier = 2 }
					}
					create_random_intriguer = {
						random_traits = yes
						dynasty = none
						religion = THIS
						culture = THIS
						female = no
						age = 40
					}
					new_character = {
						opinion = { who = PREV modifier = opinion_loyal_vassal multiplier = 2 }
					}
					war = {
						target = PREVPREV
						casus_belli = emf_ismaili_caliphate_rising
						thirdparty_title = PREV
						tier = KING
						infamy = 0
					}
					recalc_succession = yes
				}
			}
		}
	}
	
	option = {
		name = CURSES
		trigger = { character = event_target:ismaili_revolt_target }
	}
	option = {
		name = "EVTOPTB39640"
		trigger = { religion = ismaili }
	}
	option = {
		name = "EVTOPTC39640"
		trigger = {
			religion_group = muslim
			NOT = { religion = ismaili }
			NOT = { character = event_target:ismaili_revolt_target }
		}
	}
	option = {
		name = "EVTOPTD39640"
		trigger = {
			NOT = { religion_group = muslim }
			NOT = { character = event_target:ismaili_revolt_target }
		}
	}
}

# Event troops received upon forming the Ismaili Caliphate
character_event = {
	id = emf_heresy.1973
	desc = EVTDESC_emf_heresy_1973
	picture = GFX_evt_bishop_muslim
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
		d_ismaili = { set_title_flag = ismaili_followers }
		capital_scope = {
			ROOT = {
				spawn_unit = {
					province = PREV
					home = PREV
					owner = THIS
					troops = {
						light_infantry = { 1600 1600 }
						light_cavalry = { 840 840 }
						heavy_infantry = { 210 210 }
						knights = { 55 55 }
					}
					attrition = 1.0
					maintenance_multiplier = 0
					earmark = ismaili_claimant
				}
				spawn_unit = {
					province = PREV
					home = PREV
					owner = THIS
					troops = {
						light_infantry = { 1600 1600 }
						light_cavalry = { 840 840 }
						heavy_infantry = { 210 210 }
						knights = { 55 55 }
					}
					attrition = 1.0
					maintenance_multiplier = 0
					earmark = ismaili_claimant
				}
				spawn_unit = {
					province = PREV
					home = PREV
					owner = THIS
					troops = {
						light_infantry = { 1600 1600 }
						light_cavalry = { 840 840 }
						heavy_infantry = { 210 210 }
						knights = { 55 55 }
					}
					attrition = 1.0
					maintenance_multiplier = 0
					earmark = ismaili_claimant
				}
			}
		}		
	}
}

# Prompt AI Imamah claimant to marry
character_event = {
	id = emf_heresy.1974
	
	hide_window = yes
	ai = yes
	min_age = 20
	prisoner = no
	capable_only = yes
	has_character_flag = is_imamah_claimant
	
	trigger = {
		is_married = no
		is_ill = no
		fertility = 0.33
	}
	
	mean_time_to_happen = {
		months = 6
	}
	
	immediate = {
		if = {
			limit = { is_ruler = no }
			liege = {
				create_character = {
					random_traits = yes
					dynasty = random
					female = yes
					age = 17
					culture = ROOT
					religion = ROOT
				}
				new_character = {
					add_spouse = ROOT
				}
				break = yes
			}
		}
		create_character = {
			random_traits = yes
			dynasty = random
			female = yes
			age = 17
			culture = ROOT
			religion = ROOT
		}
		new_character = {
			add_spouse = ROOT
		}
	}
}
		
# Prompt AI Imamah claimant to have children
character_event = {
	id = emf_heresy.1975
	
	hide_window = yes
	ai = yes
	min_age = 20
	prisoner = no
	capable_only = yes
	has_character_flag = is_imamah_claimant
	
	trigger = {
		is_married = yes
		fertility = 0.33
		NOR = {
			any_child = {
				is_female = no
				NOT = { trait = bastard }
			}
			any_spouse = { is_pregnant = yes }
		}
		any_spouse = {
			is_pregnant = no
			is_ill = no
			prisoner = no
			NOT = { trait = incapable }
			fertility = 0.33
		}
	}
	
	mean_time_to_happen = {
		months = 6
	}
	
	immediate = {
		random_spouse = {
			limit = {
				is_pregnant = no
				is_ill = no
				prisoner = no
				NOT = { trait = incapable }
				fertility = 0.33
			}
			ROOT = { impregnate = PREV }
		}
	}
}

# New Imamah Claimant arises
narrative_event = {
	id = emf_heresy.1976
	title = EVTNAME_emf_heresy_1976
	desc = EVTDESC_emf_heresy_1976
	picture = GFX_evt_bishop_muslim
	border = GFX_event_narrative_frame_religion
	
	major = yes
	hide_from = yes
	show_ROOT = yes
	is_triggered_only = yes
	
	major_trigger = {
		religion_group = muslim
	}
	
	option = {
		name = EVTOPTA_emf_heresy_1976
		trigger = {
			religion = ismaili
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_1976
		trigger = {
			NOT = { religion = ismaili }
		}
	}
}

# Isma'ili Caliphate established
narrative_event = {
	id = emf_heresy.1977
	title = EVTNAME_emf_heresy_1977
	desc = EVTDESC_emf_heresy_1977
	picture = GFX_evt_caliph
	border = GFX_event_narrative_frame_religion
	
	major = yes
	hide_from = yes
	show_ROOT = yes
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_1977
		trigger = {
			character = ROOT
		}
		hidden_tooltip = {
			any_vassal = {
				limit = {
					is_playable = yes
					religion = ismaili
				}
				character_event = { id = emf_heresy.1978 days = 4 } # Choose whether to convert
			}
			any_independent_ruler = {
				limit = {
					NOT = { character = ROOT }
					is_playable = yes
					religion = ismaili
				}
				character_event = { id = emf_heresy.1978 days = 4 } # Choose whether to convert
			}
		}
	}
	option = {
		name = EVTOPTA_emf_heresy_1978 # Stay Ismaili
		trigger = {
			NOT = { character = ROOT }
			religion = ismaili
			independent = yes
		}
		ai_chance = {
			factor = 75
			modifier = {
				factor = 0.5
				trait = zealous
				NOR = {
					is_close_relative = ROOT
					dynasty = ROOT
					has_non_aggression_pact_with = ROOT
					is_allied_with = ROOT
				}
			}
			modifier = {
				factor = 1.5
				trait = humble
			}
			modifier = {
				factor = 1.5
				trait = craven
			}
			modifier = {
				factor = 1.5
				trait = content
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_1978 # Become Qarmatian
		trigger = {
			NOT = { character = ROOT }
			religion = ismaili
			independent = yes
			controls_religion = no
			mercenary = no
			holy_order = no
			can_change_religion = yes
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0
				OR = {
					is_close_relative = ROOT
					dynasty = ROOT
					has_non_aggression_pact_with = ROOT
					is_allied_with = ROOT
					trait = decadent
				}
			}
			modifier = {
				factor = 0
				NOR = {
					trait = zealous
					trait = lunatic
					trait = paranoid
					trait = proud
					trait = wroth
					trait = misguided_warrior
					trait = tough_soldier
					trait = skilled_tactician
					trait = brilliant_strategist
				}
			}
			modifier = {
				factor = 0
				trait = cynical
			}
			modifier = {
				factor = 3
				trait = lunatic
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 1.5
				trait = proud
			}
			modifier = {
				factor = 1.5
				trait = brave
			}
			modifier = {
				factor = 2
				independent = yes
				real_tier = KING
			}
			modifier = {
				factor = 3
				independent = yes
				real_tier = EMPEROR
			}
		}
		hidden_tooltip = { religion_authority = { modifier = ruler_converted_from } }
		religion = qarmatian
		hidden_tooltip = { religion_authority = { modifier = ruler_converted_to } }
		any_demesne_title = {
			limit = {
				tier = COUNT
				location = { religion = ismaili }
			}
			location = { religion = qarmatian }
		}
		hidden_tooltip = {
			any_courtier = {
				limit = {
					religion = ismaili
					is_ruler = no
					controls_religion = no
					mercenary = no
					holy_order = no
					can_change_religion = yes
				}
				religion = qarmatian
			}
			any_vassal = {
				limit = {
					religion = ismaili
					is_playable = no
					controls_religion = no
					mercenary = no
					holy_order = no
					can_change_religion = yes
				}
				religion = qarmatian
				any_courtier = {
					limit = {
						religion = ismaili
						is_ruler = no
						controls_religion = no
						mercenary = no
						holy_order = no
						can_change_religion = yes
					}
					religion = qarmatian
				}
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_1977
		trigger = {
			NOT = { character = ROOT }
			religion = ismaili
			independent = no
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_1976
		trigger = {
			NOT = { religion = ismaili }
			religion_group = muslim
		}
	}
	option = {
		name = EVTOPTD_emf_heresy_1976
		trigger = {
			NOT = { religion_group = muslim }
		}
	}
}

# Ismaili vassal must decide whether to become Qarmatian
character_event = {
	id = emf_heresy.1978
	picture = GFX_evt_bishop_muslim
	border = GFX_event_normal_frame_religion
	
	desc = {
		text = EVTDESC_emf_heresy_1978_caliph
		trigger = {
			FROM = {
				religion = ismaili
				controls_religion = ismaili
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1978_ismaili
		trigger = {
			FROM = {
				religion = ismaili
				NOT = { controls_religion = ismaili }
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_1978_qarmatian
		trigger = { FROM = { religion = qarmatian } }
	}
	
	is_triggered_only = yes
	
	trigger = {
		religion = ismaili
		is_playable = yes
	}
	
	immediate = {
		any_vassal = {
			limit = {
				is_playable = yes
				religion = ismaili
			}
			character_event = { id = emf_heresy.1978 days = 4 }
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_1978 # Stay Ismaili
		ai_chance = {
			factor = 75
			modifier = {
				factor = 0.5
				trait = zealous
				religion_head = {
					NOR = {
						is_close_relative = ROOT
						dynasty = ROOT
						has_non_aggression_pact_with = ROOT
						is_allied_with = ROOT
					}
				}
			}
			modifier = {
				factor = 1.5
				trait = humble
			}
			modifier = {
				factor = 1.5
				trait = craven
			}
			modifier = {
				factor = 1.5
				trait = content
			}
			modifier = {
				factor = 1.5
				liege = { religion = ismaili }
			}
		}
	}
	option = {
		name = EVTOPTA_emf_heresy_1978 # Become Qarmatian
		trigger = {
			controls_religion = no
			mercenary = no
			holy_order = no
			can_change_religion = yes
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0
				religion_head = {
					OR = {
						is_close_relative = ROOT
						dynasty = ROOT
						has_non_aggression_pact_with = ROOT
						is_allied_with = ROOT
						trait = decadent
					}
				}
			}
			modifier = {
				factor = 0
				NOR = {
					trait = zealous
					trait = lunatic
					trait = paranoid
					trait = proud
					trait = wroth
					trait = misguided_warrior
					trait = tough_soldier
					trait = skilled_tactician
					trait = brilliant_strategist
					any_liege = { religion = qarmatian }
				}
			}
			modifier = {
				factor = 2
				any_close_relative = { religion = qarmatian }
			}
			modifier = {
				factor = 0
				trait = cynical
			}
			modifier = {
				factor = 3
				trait = lunatic
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 1.5
				trait = paranoid
			}
			modifier = {
				factor = 1.5
				trait = proud
			}
			modifier = {
				factor = 1.5
				trait = brave
			}
			modifier = {
				factor = 2
				independent = yes
				real_tier = KING
			}
			modifier = {
				factor = 3
				independent = yes
				real_tier = EMPEROR
			}
			modifier = {
				factor = 3
				liege = { religion = qarmatian }
			}
		}
		hidden_tooltip = { religion_authority = { modifier = ruler_converted_from } }
		religion = qarmatian
		hidden_tooltip = { religion_authority = { modifier = ruler_converted_to } }
		any_demesne_title = {
			limit = {
				tier = COUNT
				location = { religion = ismaili }
			}
			location = { religion = qarmatian }
		}
		hidden_tooltip = {
			any_courtier = {
				limit = {
					religion = ismaili
					is_ruler = no
					controls_religion = no
					mercenary = no
					holy_order = no
					can_change_religion = yes
				}
				religion = qarmatian
			}
			any_vassal = {
				limit = {
					religion = ismaili
					is_playable = no
					controls_religion = no
					mercenary = no
					holy_order = no
					can_change_religion = yes
				}
				religion = qarmatian
				any_courtier = {
					limit = {
						religion = ismaili
						is_ruler = no
						controls_religion = no
						mercenary = no
						holy_order = no
						can_change_religion = yes
					}
					religion = qarmatian
				}
			}
		}
	}
}		


#######################################
# CATHAR EVENTS
#######################################

# Cathar child gains chaste
character_event = {
	id = emf_heresy.2000
	desc = EVTDESC_emf_heresy_2000
	picture = GFX_evt_child_talking
	
	is_triggered_only = yes
	
	min_age = 6
	max_age = 16
	religion = cathar

	trigger = {
		educator = { always = yes }
		NOT = { personality_traits = 5 }
		NOT = { trait = lustful }
		NOT = { trait = chaste }
	}
	
	weight_multiplier = {
		days = 1
		modifier = {
			factor = 0.1
			educator = { trait = lustful }
		}
		modifier = {
			factor = 2.0
			educator = { trait = chaste }
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2000
		add_trait = chaste
	}
}

# Cathar male child becomes homosexual
character_event = {
	id = emf_heresy.2001
	desc = EVTDESC_emf_heresy_2001
	picture = GFX_evt_brothel
	
	min_age = 13
	max_age = 16
	only_men = yes
	religion = cathar
	
	trigger = {
		is_married = no
		NOR = {
			trait = homosexual
			trait = celibate
		}
	}

	mean_time_to_happen = {
		months = 960
		modifier = {
			factor = 0.75
			trait = zealous
		}
		modifier = {
			factor = 1.5
			trait = chaste
		}
		modifier = {
			factor = 0.5
			trait = trusting
			any_courtier = {
				age = 13
				NOT = { age = 18 }
				is_female = no
				trait = homosexual
				reverse_opinion = { who = ROOT value = 0 }
			}
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2001
		add_trait = homosexual
	}
}

# Cathar female child becomes homosexual
character_event = {
	id = emf_heresy.2002
	desc = EVTDESC_emf_heresy_2002
	picture = GFX_evt_garden
	
	min_age = 12
	max_age = 16
	only_women = yes
	religion = cathar
	
	trigger = {
		is_married = no
		NOR = {
			trait = homosexual
			trait = celibate
		}		
	}

	mean_time_to_happen = {
		months = 960
		modifier = {
			factor = 0.75
			trait = zealous
		}
		modifier = {
			factor = 1.5
			trait = chaste
		}
		modifier = {
			factor = 0.5
			trait = trusting
			any_courtier = {
				age = 13
				NOT = { age = 18 }
				is_female = yes
				trait = homosexual
				reverse_opinion = { who = ROOT value = 0 }
			}
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2001
		add_trait = homosexual
	}
}

# Adult Cathar becomes celibate
character_event = {
	id = emf_heresy.2003
	desc = EVTDESC_emf_heresy_2003
	picture = GFX_evt_brothel
	
	min_age = 25
	religion = cathar
	
	is_triggered_only = yes
	
	trigger = {
		religion = cathar
		trait = zealous
		NOR = {
			trait = celibate
			trait = hedonist
		}
	}
	
	weight_multiplier = {
		days = 1
		modifier = {
			factor = 2
			trait = chaste
		}
		modifier = {
			factor = 0.5
			trait = lustful
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2003
		add_trait = celibate
	}
}

# Cathar/Bogomilist ruler adopts a child (fired from decision)
character_event = {
	id = emf_heresy.2006
	desc = EVTDESC_emf_heresy_2006
	picture = GFX_evt_child_talking
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { capital_scope = { religion = ROOT } }
			capital_scope = { save_event_target_as = adopted_province }
			break = yes
		}
		random_realm_province = {
			limit = { religion = ROOT }
			save_event_target_as = adopted_province
		}
	}

	option = {
		name = EVTOPTA_emf_heresy_2006
		piety = 20
		create_character = {
			random_traits = yes
			dynasty = ROOT
			religion = ROOT
			culture = event_target:adopted_province
			female = no
			age = 5
			health = 6.5
			trait = adopted
			attributes = {
				learning = 2
				diplomacy = 2
				martial = 2
				stewardship = 2
				intrigue = 2
			}
		}
		new_character = {
			if = {
				limit = { ROOT = { is_female = no } }
				set_father = ROOT
			}
			if = {
				limit = { ROOT = { is_female = yes } }
				set_mother = ROOT
			}
			random_list = {
				1 = { add_trait = genius }
				2 = { add_trait = quick }
				3 = { add_trait = strong }
				4 = { change_diplomacy = 2 }
				4 = { change_learning = 2 }
				4 = { change_martial = 2 }
				4 = { change_stewardship = 2 }
				4 = { change_intrigue = 2 }
				10 = { }
			}
			if = {
				limit = { has_dlc = "Zeus" }
				random_list = {
					3 = { add_trait = timid }
					1 = { add_trait = brooding }
					1 = { add_trait = curious }
				}
			}
			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				random_list = {
					3 = { add_trait = shy }
					1 = { add_trait = humble }
					1 = { add_trait = trusting }
				}
			}
		}
		recalc_succession = yes
	}
}

# Council of Saint-Flix
province_event = {
	id = emf_heresy.2010
	
	hide_window = yes
	
	trigger = {
		religion = catholic
		OR = {
			year = 1160
			AND = {
				year = 1100
				NOT = { religion_authority = 0.60 }
			}
		}
		OR = {
			culture = occitan
			AND = {
				year = 1175
				culture = frankish
			}
			AND = {
				year = 1175
				culture = arpitan
			}
			AND = {
				year = 1200
				region = world_europe_west_francia
			}
			year = 1225
		}
		any_province_holding = { holding_type = city }
		any_neighbor_province = { religion = catholic }
		NOR = {
			owner = { war = yes }
			religion_authority = 0.75
			any_independent_ruler = { religion = cathar }
			has_global_flag = cathar_activated
		}
	}
	
	mean_time_to_happen = {
		months = 120
		modifier = {
			factor = 0.75
			county = { title = c_carcassonne }
		}
		modifier = {
			factor = 1.5
			NOT = { culture = occitan }
		}
		modifier = {
			factor = 0.8
			NOT = { religion_authority = 0.70 }
		}
		modifier = {
			factor = 0.8
			NOT = { religion_authority = 0.65 }
		}
		modifier = {
			factor = 0.8
			NOT = { religion_authority = 0.60 }
		}
		modifier = {
			factor = 0.8
			NOT = { religion_authority = 0.55 }
		}
		modifier = {
			factor = 0.8
			NOT = { religion_authority = 0.50 }
		}
		modifier = {
			factor = 1.5
			NOT = { year = 1165 }
		}
		modifier = {
			factor = 0.5
			year = 1175
		}
		modifier = {
			factor = 0.25
			year = 1200
		}
		modifier = {
			factor = 0.1
			year = 1225
		}
	}
	
	immediate = {
		set_global_flag = cathar_activated
		any_neighbor_province = {
			count = 3
			limit = {
				religion = ROOT
				culture = ROOT
			}
			religion = cathar
			add_province_modifier = {
				name = heretic_stronghold
				duration = 3650
			}
		}
		religion = cathar
		add_province_modifier = {
			name = heretic_stronghold
			duration = 3650
		}
		random_province_holding = {
			limit = { holding_type = city }
			save_event_target_as = council_location
		}
		owner = {
			narrative_event = { id = emf_heresy.2011 }
		}
	}
}

narrative_event = {
	id = emf_heresy.2011
	title = EVTTITLE_emf_heresy_2011
	desc = EVTDESC_emf_heresy_2011
	picture = GFX_evt_heretic_pride
	border = GFX_event_narrative_frame_religion

	major = yes
	is_triggered_only = yes
	hide_from = yes
	
	major_trigger = {
		OR = {
			any_demesne_province = { religion = cathar }
			religion = cathar
			religion = bogomilist
			capital_scope = {
				NOT = {
					distance = {
						where = FROM
						value = 600	# Same part of the world
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2011
		trigger = {
			religion = catholic
			any_demesne_province = { religion = cathar }
		}
		piety = -100
		hidden_tooltip = {
			create_character = {
				random_traits = yes
				dynasty = random
				religion = cathar
				culture = ROOT
				female = no
				age = 35
				trait = mastermind_theologian
				trait = perfecti
				trait = zealous
				trait = gregarious
				trait = scholar
				attributes = {
					learning = 5
					diplomacy = 5
				}
			}
			new_character = {
				set_character_flag = title_monk
				set_special_character_title = MONK_BROTHER
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2011
		trigger = {
			religion = catholic
			NOT = { any_demesne_province = { religion = cathar } }
		}
	}
	option = {
		name = I_SEE
		trigger = {
			NOR = {
				religion = catholic
				religion = bogomilist
			}
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_2011
		trigger = {
			religion = bogomilist
		}
	}
}

# Cathars are allowed to use holy wars/crusades once holy war is used against them
character_event = {
	id = emf_heresy.2012
	title = EVTTITLE_emf_heresy_2012
	desc = EVTDESC_emf_heresy_2012
	picture = GFX_evt_heresy_defeated
	border = GFX_event_normal_frame_war
	
	major = yes
	only_rulers = yes
	religion = cathar
	
	trigger = {
		is_heretic = yes
		war = yes
		any_war = {
			attacker = {
				is_parent_religion = ROOT
				any_demesne_title = { temporary = no }
			}
			defender = { character = ROOT }
			OR = {
				using_cb = crusade
				using_cb = religious
			}
		}
		NOT = { has_global_flag = cathar_holy_war_enabled }
	}
	
	major_trigger = {
		religion = cathar
	}
	
	mean_time_to_happen = {
		days = 10
    }

	immediate = {
		set_global_flag = cathar_holy_war_enabled
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2012
	}
}

# A Cathar Patriarch is elected (fired from decision)
character_event = {
	id = emf_heresy.2013
	
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		activate_title = { title = d_cathar status = yes }
		
		# First pick appropriate realm priest
		random_realm_lord = {
			limit = {
				religion = cathar
				is_theocracy = yes
				capital_holding = { is_holy_site = ROOT }
				prisoner = no
				trait = perfecti
				NOT = { trait = incapable }
			}
			d_cathar = { grant_title = PREV }
			set_defacto_liege = ROOT
			emf_liege_change_effect = yes
			save_event_target_as = new_cathar_pope
			ROOT = { narrative_event = { id = emf_heresy.2014 } }
			break = yes
		}
		
		# Failing that, create a new character
		create_random_priest = {
			random_traits = yes
			dynasty = random
			religion = cathar
			culture = ROOT
			age = 40
			health = 7
			trait = quick
			trait = zealous
			trait = perfecti
			trait = scholar
			trait = mastermind_theologian
			attributes = {
				learning = 5
				diplomacy = 5
				martial = 2
				stewardship = 5
				intrigue = 5
			}
		}
		new_character = {
			d_cathar = { grant_title = PREV }
			ROOT = {
				random_realm_title = {
					limit = { is_holy_site = ROOT }
					gain_title = PREVPREV
				}
			}
			set_defacto_liege = ROOT
			emf_liege_change_effect = yes
			save_event_target_as = new_cathar_pope
		}
		narrative_event = { id = emf_heresy.2014 }
	}
}

# The rest of the world is told about the new Cathar Patriarch
narrative_event = {
	id = emf_heresy.2014
	title = EVTTITLE_emf_heresy_2014
	desc = EVTDESC_emf_heresy_2014
	picture = GFX_evt_pope
	border = GFX_event_narrative_frame_religion
	sound = church_bells

	major = yes

	is_triggered_only = yes

	option = {
		name = EVTOPTA_emf_heresy_2014
		trigger = {
			NOT = { religion = cathar }
			religion_group = christian
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2014
		trigger = { NOT = { religion_group = christian } }
	}
	option = {
		name = EVTOPTC_emf_heresy_2014
		trigger = { religion = cathar }
	}
}

#######################################
# LOLLARD EVENTS
#######################################

# John Wycliff appears in England
narrative_event = {
	id = emf_heresy.2015
	title = EVTNAME_emf_heresy_2015
	desc = EVTDESC_emf_heresy_2015
	picture = GFX_evt_lollard_heresy
	border = GFX_event_narrative_frame_religion

	major = yes
	only_rulers = yes
	religion = catholic
	
	trigger = {
		war = no
		year = 1300
		tier = KING
		any_realm_province = {
			region = custom_england
			religion = catholic
		}
		NOR = {
			religion_authority = 0.60
			any_realm_province = { religion = lollard }
			any_independent_ruler = { religion = lollard }
			has_global_flag = lollard_activated
		}
	}

	major_trigger = {
		OR = {
			character = ROOT
			religion = lollard
			capital_scope = {
				NOT = {
					distance = {
						where = event_target:new_lollard_stronghold
						value = 600	# Same part of the world
					}
				}
			}
		}
	}

	mean_time_to_happen = {
		months = 500
		modifier = {
			factor = 0.5
			year = 1325
		}
		modifier = {
			factor = 0.5
			year = 1350
		}
		modifier = {
			factor = 0.25
			year = 1375
		}
		modifier = {
			factor = 0.1
			year = 1400
		}
	}
	
	immediate = {
		set_global_flag = lollard_activated
		random_realm_province = {
			limit = {
				region = custom_england
				religion = catholic 
			}
			save_event_target_as = new_lollard_stronghold
			religion = lollard
			add_province_modifier = {
				name = heretic_stronghold
				duration = 3650
            }
			if = {
				limit = { culture = english }
				owner = {
					create_character = {
						name = "John"
						random_traits = yes
						dynasty = 1000124390 #Wycliff
						religion = lollard
						culture = english
						female = no
						age = 39
						trait = mastermind_theologian
						trait = humble
						trait = zealous
						trait = gregarious
						trait = scholar
						trait = monk
						attributes = {
							learning = 5
							diplomacy = 5
						}
					}
					new_character = {
						save_event_target_as = lollard_founder
						set_character_flag = title_monk
						set_special_character_title = MONK_BROTHER
					}
				}
			}
			if = {
				limit = { NOT = { culture = english } }
				owner = {
					create_character = {
						random_traits = yes
						dynasty = random
						religion = lollard
						culture = PREV
						female = no
						age = 39
						trait = mastermind_theologian
						trait = humble
						trait = zealous
						trait = gregarious
						trait = scholar
						trait = monk
						attributes = {
							learning = 5
							diplomacy = 5
						}
					}
					new_character = {
						save_event_target_as = lollard_founder
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2015
		trigger = { character = ROOT }
		piety = -100
		tooltip = {
			event_target:new_lollard_stronghold = {
				religion = lollard
				add_province_modifier = {
					name = heretic_stronghold
					duration = 3650
				}
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2015
		trigger = {
			NOT = { character = ROOT }
			religion = catholic
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_2015
		trigger = {
			NOT = { character = ROOT }
			NOT = { religion = catholic }
			religion_group = christian
		}
	}
	option = {
		name = EVTOPTD_emf_heresy_2015
		trigger = {
			NOT = { religion_group = christian }
		}
	}
}

# Lollard/Paulician/Iconoclast wins siege over a Christian temple
character_event = { 
	id = emf_heresy.2016
	desc = EVTDESC_emf_heresy_2016
	picture = GFX_evt_siege
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	trigger = {
		OR = {
			religion = lollard
			religion = paulician
			religion = iconoclast
			religion = bogomilist
		}
		FROM = { 
			holding_type = temple
			owner = {
				wealth = 50
				religion_group = christian
				NOR = {
					religion = lollard
					religion = paulician
					religion = iconoclast
					religion = bogomilist
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2016
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				religion = iconoclast
			}
			modifier = {
				factor = 5
				trait = zealous
			}
			modifier = {
				factor = 1.5
				trait = greedy
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
		}
		if = {
			limit = { NOT = { trait = iconoclast_trait } }
			add_trait = iconoclast_trait
		}
		wealth = 50
		piety = -25
		hidden_tooltip = {
			FROM = {
				owner = {
					wealth = -50
					opinion = { who = ROOT modifier = opinion_outraged years = 20 }
				}
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2016
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				trait = iconoclast_trait
			}
			modifier = {
				factor = 0
				NOT = { piety = 0 }
			}
			modifier = {
				factor = 2
				trait = cynical
			}
			modifier = {
				factor = 1.5
				trait = kind
			}
			modifier = {
				factor = 1.5
				trait = humble
			}
		}
		piety = 10
	}
}

# Bible translation is well-received
narrative_event = { 
	id = emf_heresy.2017
	title = EVTNAME_emf_heresy_2017
	desc = EVTDESC_emf_heresy_2017
	picture = GFX_evt_book_carolingian_script
	border = GFX_event_narrative_frame_religion
	
	is_triggered_only = yes
	major = yes
	
	trigger = {
		OR = {
			religion = lollard
			religion = waldensian
		}
		higher_tier_than = DUKE
		has_character_flag = bible_translation_begun
		NOT = { has_global_flag = bible_translation_finished }
	}
	
	major_trigger = {
		religion_group = christian
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2017
		trigger = { character = ROOT }
		clr_character_flag = bible_translation_begun
		set_global_flag = bible_translation_finished
		piety = 500
		prestige = 500
		religion_authority = {
			modifier = bible_translated_lollard
			years = 25
		}
		k_papal_state = {
			holder_scope = {
				religion_authority = {
					modifier = bible_translated
					years = 25
				}
			}
		}
	}
	option = {
		name = EVTOPTA_emf_heresy_2017
		trigger = {
			NOT = { character = ROOT }
			religion = ROOT
		}
		tooltip = {
			religion_authority = {
				modifier = bible_translated_lollard
				years = 25
			}
			k_papal_state = {
				holder_scope = {
					religion_authority = {
						modifier = bible_translated
						years = 25
					}
				}
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2017
		trigger = {
			NOT = { character = ROOT }
			NOT = { religion = ROOT }
		}
		tooltip = {
			ROOT = {
				religion_authority = {
					modifier = bible_translated_lollard
					years = 25
				}
			}
			k_papal_state = {
				holder_scope = {
					religion_authority = {
						modifier = bible_translated
						years = 25
					}
				}
			}
		}
	}
}

# Bible translation is poorly-received
narrative_event = { 
	id = emf_heresy.2018
	title = EVTNAME_emf_heresy_2017
	desc = EVTDESC_emf_heresy_2018
	picture = GFX_evt_book_carolingian_script
	border = GFX_event_narrative_frame_religion
	
	is_triggered_only = yes
	major = yes
	
	trigger = {
		OR = {
			religion = lollard
			religion = waldensian
		}
		higher_tier_than = DUKE
		has_character_flag = bible_translation_begun
		NOT = { has_global_flag = bible_translation_finished }
	}
	
	major_trigger = {
		religion_group = christian
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2018
		clr_character_flag = bible_translation_begun
		set_global_flag = bible_translation_finished
		piety = 250
		prestige = -250
		religion_authority = {
			modifier = bible_translated_poor_lollard
			years = 25
		}
		k_papal_state = {
			holder_scope = {
				religion_authority = {
					modifier = bible_translated_poor
					years = 25
				}
			}
		}
	}
	option = {
		name = EVTOPTA_emf_heresy_2017
		trigger = {
			NOT = { character = ROOT }
			religion = ROOT
		}
		tooltip = {
			religion_authority = {
				modifier = bible_translated_poor_lollard
				years = 25
			}
			k_papal_state = {
				holder_scope = {
					religion_authority = {
						modifier = bible_translated_poor
						years = 25
					}
				}
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2017
		trigger = {
			NOT = { character = ROOT }
			NOT = { religion = ROOT }
		}
		tooltip = {
			ROOT = {
				religion_authority = {
					modifier = bible_translated_poor_lollard
					years = 25
				}
			}
			k_papal_state = {
				holder_scope = {
					religion_authority = {
						modifier = bible_translated_poor
						years = 25
					}
				}
			}
		}
	}
}

# Ruler dies while Bible is being translated
character_event = {
	id = emf_heresy.2019
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_character_flag = bible_translation_begun
		NOT = { has_global_flag = bible_translation_finished }
	}
	
	immediate = {
		current_heir = {
			character_event = { id = emf_heresy.2020 days = 3 }
		}
	}
}

# Ruler's heir decides whether to continue work on Bible translation
character_event = {
	id = emf_heresy.2020
	desc = EVTDESC_emf_heresy_2020
	picture = GFX_evt_book_carolingian_script
	border = GFX_event_normal_frame_religion	
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2020 # Continue his work
		trigger = {
			has_regent = no
			higher_tier_than = DUKE
			OR = {
				religion = lollard
				religion = waldensian
			}
			wealth = 0
		}
		set_character_flag = bible_translation_begun
		scaled_wealth = -0.5
		random_list = {
			50 = {
				modifier = {
					factor = 1.1
					learning = 12
				}
				modifier = {
					factor = 1.1
					learning = 14
				}
				modifier = {
					factor = 1.2
					learning = 16
				}
				modifier = {
					factor = 1.2
					learning = 18
				}
				modifier = {
					factor = 1.2
					learning = 20
				}
				narrative_event = { id = emf_heresy.2017 days = 150 random = 250 tooltip = BIBLE_TRANSLATION_GOOD }
			}
			50 = {
				modifier = {
					factor = 0.8
					NOT = { learning = 8 }
				}
				modifier = {
					factor = 0.8
					NOT = { learning = 6 }
				}
				modifier = {
					factor = 0.8
					NOT = { learning = 4 }
				}
				narrative_event = { id = emf_heresy.2018 days = 150 random = 250 tooltip = BIBLE_TRANSLATION_POOR }
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2020 # His efforts die with him
		if = {
			limit = {
				OR = {
					religion = lollard
					religion = waldensian
				}
			}
			piety = -100
		}
	}
}

# Lollard ruler attempts to revoke/claim religious titles (fired from decision)
letter_event = {
	id = emf_heresy.2021
	border = GFX_event_letter_frame_religion
	
	desc = {
		text = EVTDESC_emf_heresy_2021_not_lollard
		trigger = {
			NOT = { religion = lollard }
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_2021_wicked
		trigger = {
			religion = lollard
			trait = bad_priest_christian
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_2021_high_tier
		trigger = {
			religion = lollard
			NOT = { trait = bad_priest_christian }
			higher_tier_than = COUNT
		}
	}
	
	is_triggered_only = yes
	
	trigger = {
		is_ruler = yes
		holy_order = no
		vassal_of = FROMFROM
		capital_holding = { holding_type = temple }
		NOR = {
			any_demesne_title = { temporary = yes }
			reverse_has_truce = FROMFROM
			has_non_aggression_pact_with = FROMFROM
		}
	}
	
	immediate = {
		clr_character_flag = lollard_revoking_titles
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2021 # I have no choice
		prestige = -100
		if = {
			limit = {
				OR = {
					NOT = { religion = lollard }
					trait = bad_priest_christian
				}
			}
			any_demesne_title = {
				limit = {
					OR = {
						is_theocracy = yes
						higher_tier_than = BARON
					}
				}
				usurp_title_plus_barony_if_unlanded = FROMFROM
			}
			set_defacto_liege = FROMFROM
			emf_liege_change_effect = yes
			hidden_tooltip = {
				FROMFROM = { letter_event = { id = emf_heresy.2022 } }
			}
		}
		if = {
			limit = {
				religion = lollard
				NOT = { trait = bad_priest_christian }
			}
			any_demesne_title = {
				limit = { higher_tier_than = COUNT }
				tooltip = { add_claim = FROMFROM }
			}
			hidden_tooltip = {
				FROMFROM = { letter_event = { id = emf_heresy.2023 } }
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2021 # How dare he!
		trigger = {
			higher_tier_than = BARON
			OR = {
				NOT = { religion = lollard }
				trait = bad_priest_christian
			}
		}
		FROMFROM = {
			opinion = { who = ROOT modifier = opinion_rebel_traitor years = 20 }
			hidden_tooltip = { letter_event = { id = emf_heresy.2024 } }
		}
		tooltip = {
			war = {
				target = FROMFROM
				casus_belli = overthrow_ruler
			}
		}
	}
}

# Priest accepts titles being revoked
letter_event = {
	id = emf_heresy.2022
	desc = EVTDESC_emf_heresy_2022
	border = GFX_event_letter_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
		FROM = {
			any_demesne_title = {
				limit = {
					OR = {
						is_theocracy = yes
						higher_tier_than = BARON
					}
				}
				usurp_title_plus_barony_if_unlanded = ROOT
			}
			set_defacto_liege = FROM
			emf_liege_change_effect = yes
		}
	}
}

# Lollard ruler gains claims to titles
letter_event = {
	id = emf_heresy.2023
	desc = EVTDESC_emf_heresy_2023
	border = GFX_event_letter_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
		FROM = {
			opinion = { who = ROOT modifier = opinion_outraged years = 10 }
			any_demesne_title = {
				limit = { higher_tier_than = COUNT }
				add_claim = ROOT
			}
		}
	}
}

# Priest refuses titles being revoked
letter_event = {
	id = emf_heresy.2024
	desc = EVTDESC_emf_heresy_2024
	border = GFX_event_letter_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2024
		FROM = { opinion = { who = ROOT modifier = opinion_outraged years = 20 } }
		reverse_war = {
			target = FROM
			casus_belli = overthrow_ruler
		}
	}
}

# A Lollard Primate is elected (fired from decision)
character_event = {
	id = emf_heresy.2070
	
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		activate_title = { title = d_lollard status = yes }
		
		# First pick appropriate realm priest
		random_realm_lord = {
			limit = {
				religion = lollard
				is_theocracy = yes
				capital_holding = { is_holy_site = ROOT }
				prisoner = no
				NOT = { trait = incapable }
			}
			d_lollard = { grant_title = PREV }
			set_defacto_liege = ROOT
			emf_liege_change_effect = yes
			save_event_target_as = new_lollard_primate
			ROOT = { narrative_event = { id = emf_heresy.2071 } }
			break = yes
		}
		
		# Failing that, create a new character
		create_random_priest = {
			random_traits = yes
			dynasty = random
			religion = lollard
			culture = ROOT
			age = 40
			health = 7
			trait = quick
			trait = zealous
			trait = charitable
			trait = scholar
			trait = mastermind_theologian
			attributes = {
				learning = 5
				diplomacy = 5
				martial = 2
				stewardship = 5
				intrigue = 5
			}
		}
		new_character = {
			d_lollard = { grant_title = PREV }
			ROOT = {
				random_realm_title = {
					limit = { is_holy_site = ROOT }
					gain_title = PREVPREV
				}
			}
			set_defacto_liege = ROOT
			emf_liege_change_effect = yes
			save_event_target_as = new_lollard_primate
		}
		narrative_event = { id = emf_heresy.2071 }
	}
}

# The rest of the world is told about the new Lollard Primate
narrative_event = {
	id = emf_heresy.2071
	title = EVTTITLE_emf_heresy_2071
	desc = EVTDESC_emf_heresy_2071
	picture = GFX_evt_lollard_heresy
	border = GFX_event_narrative_frame_religion
	sound = church_bells

	major = yes

	is_triggered_only = yes

	option = {
		name = EVTOPTA_emf_heresy_2071
		trigger = {
			NOT = { religion = lollard }
			religion_group = christian
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2071
		trigger = { NOT = { religion_group = christian } }
	}
	option = {
		name = EVTOPTC_emf_heresy_2071
		trigger = { religion = lollard }
	}
}

#######################################
# FRATICELLI EVENTS
#######################################

# Brother Angelo criticizes the Pope
narrative_event = {
	id = emf_heresy.2025
	title = EVTNAME_emf_heresy_2025
	desc = EVTDESC_emf_heresy_2025
	picture = GFX_evt_lollard_heresy
	border = GFX_event_narrative_frame_religion

	major = yes
	only_playable = yes
	religion = catholic
	
	trigger = {
		war = no
		year = 1200
		has_landed_title = k_papal_state
		OR = {
			trait = bad_priest_christian
			NOT = { religion_authority = 0.70 }
		}
		NOT = { has_global_flag = fraticelli_activated }
	}
	
	major_trigger = {
		religion_group = christian
	}
	
	immediate = {
		set_global_flag = fraticelli_activated
		create_character = {
			name = "Angelo"
			random_traits = yes
			dynasty = random
			religion = fraticelli
			culture = italian
			female = no
			age = 40
			trait = monk
			trait = mastermind_theologian
			trait = zealous
			trait = gregarious
			trait = scholar
			attributes = {
				learning = 5
				diplomacy = 5
			}
		}
		new_character = {
			set_character_flag = title_monk
			set_special_character_title = MONK_BROTHER
			character_event = { id = emf_heresy.2026 }
		}
	}
	
	mean_time_to_happen = {
		years = 25
		modifier = {
			factor = 0.5
			year = 1225
		}
		modifier = {
			factor = 0.5
			year = 1250
		}
		modifier = {
			factor = 0.25
			year = 1275
		}
		modifier = {
			factor = 0.1
			year = 1300
		}
	}
	option = {
		name = EVTDESC_emf_heresy_2025
		trigger = { has_landed_title = k_papal_state }
		piety = -200
		religion_authority = {
			modifier = fraticelli_reforms
			years = 25
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2025
		trigger = {
			NOT = { has_landed_title = k_papal_state }
			is_heretic = yes
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_2025
		trigger = {
			NOT = { has_landed_title = k_papal_state }
			is_heretic = no
		}
	}
}

# Catholic bishops react to the words of Brother Angelo
character_event = { 
	id = emf_heresy.2026
	
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		any_character = {
			limit = {
				ai = yes
				is_ruler = yes
				religion = catholic
				controls_religion = no
				is_theocracy = yes
				trait = mastermind_theologian
				is_within_diplo_range = ROOT
			}
			character_event = { id = emf_heresy.2027 days = 7 }
		}
	}
}

# The Catholic faithful consider the Fraticelli heresy
character_event = {
	id = emf_heresy.2027
	desc = EVTDESC_emf_heresy_2027
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = fraticelli_activated
		ai = yes
		is_ruler = yes
		religion = catholic
		controls_religion = no
		is_theocracy = yes
		trait = mastermind_theologian
		OR = {
			trait = cynical
			trait = humble
			trait = temperate
			trait = charitable
		}
		NOR = {
			rightful_religious_head = ROOT
			has_claim = k_papal_state
			trait = zealous
			trait = greedy
			trait = gluttonous
			trait = proud
			trait = bad_priest_christian
			has_character_flag = considered_fraticelli
		}
	}
	
	immediate = {
		set_character_flag = considered_fraticelli
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2027
		ai_chance = {
			factor = 20
			modifier = {
				factor = 3
				OR = {
					any_liege = { is_heretic = yes }
					father_even_if_dead = { is_heretic = yes }
					mother_even_if_dead = { is_heretic = yes }
					any_sibling = { is_heretic = yes }
					any_child = { is_heretic = yes }
				}
			}
			modifier = {
				factor = 0.5
				is_ruler = yes
			}
			modifier = {
				factor = 0.5
				is_councillor = yes
				NOT = { any_liege = { is_heretic = yes } }
			}
			modifier = {
				factor = 2
				trait = cynical
			}
			modifier = {
				factor = 1.5
				trait = just
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 0.75
				trait = arbitrary
			}
			modifier = {
				factor = 0.75
				trait = trusting
			}
			modifier = {
				factor = 0.75
				trait = patient
			}
			modifier = {
				factor = 0.5
				trait = content
			}
			modifier = {
				factor = 0.5
				trait = craven
			}
			modifier = {
				factor = 0.5
				trait = slothful
			}
		}
		if = {
			limit = { NOT = { trait = cynical } }
			random = {
				chance = 50
				add_trait = zealous
			}
		}
		if = {
			limit = { trait = cynical }
			remove_trait = cynical
		}
		if = {
			limit = { higher_tier_than = BARON }
			religion_authority = {
				modifier = ruler_converted_from
			}
		}
		religion = fraticelli
		if = {
			limit = { higher_tier_than = BARON }
			hidden_tooltip = {
				religion_authority = {
					modifier = ruler_converted_to
				}
			}
		}
		piety = 100
	}
	option = {
		name = EVTOPTB_emf_heresy_2027
		ai_chance = {
			factor = 80
		}
	}
}

#######################################
# WALDENSIAN EVENTS
#######################################

# The Poor of Lyons appear
narrative_event = {
	id = emf_heresy.2030
	title = EVTTITLE_emf_heresy_2030
	desc = EVTDESC_emf_heresy_2030
	picture = GFX_evt_heretic
	border = GFX_event_narrative_frame_religion

	major = yes
	
	religion = catholic
	only_playable = yes
	
	trigger = {
		war = no
		year = 1100
		tier = KING
		any_realm_province = {
			culture = arpitan
			religion = catholic
		}
		NOR = {
			religion_authority = 0.80
			has_global_flag = waldensian_activated
			any_independent_ruler = { religion = waldensian }
		}
	}
	
	major_trigger = {
		OR = {
			character = ROOT
			religion = waldensian
			capital_scope = {
				NOT = {
					distance = {
						where = event_target:poor_of_lyons
						value = 600	# Same part of the world
					}
				}
			}
		}
	}
	
	mean_time_to_happen = {
		years = 50
		modifier = {
			factor = 0.5
			year = 1150
		}
		modifier = {
			factor = 0.5
			year = 1175
		}
		modifier = {
			factor = 0.25
			year = 1200
		}
		modifier = {
			factor = 0.1
			year = 1225
		}
	}
	
	immediate = {
		set_global_flag = waldensian_activated
		create_character = {
			name = "Pierre"
			random_traits = yes
			dynasty = 1000124391 #Valdes
			religion = waldensian
			culture = arpitan
			female = no
			age = 40
			trait = grey_eminence
			trait = possessed
			trait = zealous
			trait = gregarious
			trait = charitable
			trait = humble
			trait = novellani
			attributes = {
				learning = 5
				diplomacy = 5
			}
		}
		new_character = {
			add_character_modifier = {
				name = voice_of_jesus
				duration = -1
			}
		}
		random_realm_province = {
			limit = {
				culture = arpitan
				religion = catholic
				county = { title = c_lyon }
			}
			save_event_target_as = poor_of_lyons
			break = yes
		}
		random_realm_province = {
			limit = {
				culture = arpitan
				religion = catholic
			}
			save_event_target_as = poor_of_lyons
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2030
		trigger = {
			character = ROOT
		}
		piety = -100
		event_target:poor_of_lyons = {
			religion = waldensian
			add_province_modifier = {
				name = heretic_stronghold
				duration = 3650
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2030
		trigger = {
			NOT = { character = ROOT }
			religion = catholic
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_2030
		trigger = {
			NOT = { religion = catholic }
		}
	}
}

# Waldensian chooses their path (fired from decision)
character_event = { 
	id = emf_heresy.2031
	desc = EVTDESC_emf_heresy_2031
	picture = GFX_evt_heretic_pride
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2031
		trigger = {
			OR = { 
				is_ruler = yes
				intrigue = 7
			}		
		}
		add_trait = sandaliati
	}
	option = {
		name = EVTOPTB_emf_heresy_2031
		trigger = {
			OR = { 
				is_priest = yes
				learning = 9
			}		
		}
		add_trait = doctores
	}
	option = {
		name = EVTOPTC_emf_heresy_2031
		trigger = {
			OR = {
				is_ruler = no
				tier = BARON
			}
		}
		add_trait = novellani
	}
}

# The first Waldensian king
character_event = { 
	id = emf_heresy.2032
	desc = EVTDESC_emf_heresy_2032
	picture = GFX_evt_heretic_pride
	border = GFX_event_normal_frame_religion
	
	only_independent = yes
	min_age = 16
	capable_only = yes
	prisoner = no
	religion = waldensian
	
	trigger = {
		higher_real_tier_than = DUKE
		piety = 200
		trait = charitable
		any_realm_province = { religion = waldensian }
		NOT = { has_global_flag = waldensian_king }
	}
	
	mean_time_to_happen = {
		years = 10
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2032
		set_global_flag = waldensian_king
		religion_authority = {
			modifier = wald_king
			years = 10
		}
	}
}

# Hospital removed from province if non-Waldensian
province_event = {
	id = emf_heresy.2033
	
	hide_window = yes
	
	trigger = {
		has_province_modifier = wald_hospital
		owner = { NOT = { religion = waldensian } }
	}
	
	mean_time_to_happen = {
		months = 1
	}
	
	immediate = {
		remove_province_modifier = wald_hospital
	}
}

# Christian temple is sacked
character_event = { 
	id = emf_heresy.2034
	desc = EVTDESC_emf_heresy_2034
	picture = GFX_evt_siege
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	trigger = {
		religion = waldensian
		FROM = { 
			holding_type = temple
			NOR = {
				title = b_roma
				title = b_canterbury
				title = b_santiago
				title = b_koln
			}
			owner = {
				religion_group = christian
				NOT = { religion = waldensian }
			}
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2034
		ai_chance = {
			factor = 75
			modifier = {
				factor = 0
				trait = greedy
			}
			modifier = {
				factor = 0.5
				trait = envious
			}
			modifier = {
				factor = 0.5
				trait = gluttonous
			}
			modifier = {
				factor = 0.5
				trait = humble
			}
			modifier = {
				factor = 0.5
				trait = cynical
			}
		}
		piety = 50
		if = {
			limit = { NOT = { trait = charitable } }
			random = {
				chance = 50
				add_trait = charitable
			}
		}
		FROM = {
			owner = {
				religion_authority = {
					modifier = relics_destroyed
					years = 5
				}
				piety = -100
			}
		}
		if = {
			limit = { is_ruler = no }
			liege = {
				random_realm_province = {
					limit = {
						religion = waldensian
						NOT = { has_province_modifier = wald_charity }
					}
					add_province_modifier = {
						name = wald_charity
						duration = 1000
					}
				}
			}
		}
		if = {
			limit = { is_ruler = yes }
			random_realm_province = {
				limit = {
					religion = waldensian
					NOT = { has_province_modifier = wald_charity }
				}
				add_province_modifier = {
					name = wald_charity
					duration = 1000
				}
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2034
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0
				trait = charitable
			}
			modifier = {
				factor = 0.5
				trait = temperate
			}
			modifier = {
				factor = 0.5
				trait = proud
			}
			modifier = {
				factor = 0.5
				trait = zealous
			}
		}
		piety = -50
		wealth = 50
		if = {
			limit = { NOT = { trait = greedy } }
			random = {
				chance = 50
				add_trait = greedy
			}
		}
		FROM = {
			owner = {
				religion_authority = {
					modifier = relics_destroyed
					years = 5
				}
				piety = -100
			}
		}
	}
}

# Christian holy site is sacked
character_event = {
	id = emf_heresy.2035
	picture = GFX_evt_heresy_defeated
	border = GFX_event_normal_frame_war
	
	desc = {
		text = EVTDESC_emf_heresy_2035_rome
		trigger = {
			FROM = { title = b_roma }
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_2035_canterbury
		trigger = {
			FROM = { title = b_canterbury }
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_2035_santiago
		trigger = {
			FROM = { title = b_santiago }
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_2035_koln
		trigger = {
			FROM = { title = b_koln }
		}
	}
	
	is_triggered_only = yes
	
	trigger = {
		religion = waldensian
		OR = {
			AND = {
				FROM = { title = b_roma }
				NOT = { has_global_flag = wald_roma }
			}
			AND = {
				FROM = { title = b_canterbury }
				NOT = { has_global_flag = wald_canterbury }
			}
			AND = {
				FROM = { title = b_santiago }
				NOT = { has_global_flag = wald_santiago }
			}
			AND = {
				FROM = { title = b_koln }
				NOT = { has_global_flag = wald_koln }
			}
		}
		FROM = {
			owner = {
				religion_group = christian
				NOT = { religion = waldensian }
			}
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2035
		if = {
			limit = { is_ruler = yes }
			piety = 200
		}
		if = {
			limit = { is_ruler = no }
			piety = 100
			liege = { piety = 100 }
		}
		if = {
			limit = { FROM = { title = b_roma } }
			set_global_flag = wald_roma
		}
		if = {
			limit = { FROM = { title = b_canterbury } }
			set_global_flag = wald_canterbury
		}
		if = {
			limit = { FROM = { title = b_santiago } }
			set_global_flag = wald_santiago
		}
		if = {
			limit = { FROM = { title = b_koln } }
			set_global_flag = wald_koln
		}
		FROM = {
			owner = {
				religion_authority = {
					modifier = wald_sack
					years = 10
				}
				piety = -300
				hidden_tooltip = { narrative_event = { id = emf_heresy.2036 days = 1 } }
			}
		}
		if = {
			limit = { is_ruler = no }
			liege = {
				random_realm_province = {
					limit = {
						religion = waldensian
						NOT = { has_province_modifier = wald_charity }
					}
					add_province_modifier = {
						name = wald_charity
						duration = 1000
					}
				}
			}
		}
		if = {
			limit = { is_ruler = yes }
			random_realm_province = {
				limit = {
					religion = waldensian
					NOT = { has_province_modifier = wald_charity }
				}
				add_province_modifier = {
					name = wald_charity
					duration = 1000
				}
			}
		}		
	}
}

# Christians informed that holy site was sacked
narrative_event = {
	id = emf_heresy.2036
	title = EVTNAME_emf_heresy_2036
	picture = GFX_evt_heresy_defeated
	border = GFX_event_narrative_frame_war
	
	desc = {
		text = EVTDESC_emf_heresy_2036_rome
		trigger = {
			FROMFROM = { title = b_roma }
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_2036_canterbury
		trigger = {
			FROMFROM = { title = b_canterbury }
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_2036_santiago
		trigger = {
			FROMFROM = { title = b_santiago }
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_2036_koln
		trigger = {
			FROMFROM = { title = b_koln }
		}
	}
	
	major = yes
	is_triggered_only = yes
	
	major_trigger = {
		religion_group = christian
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2036
		trigger = { NOT = { religion = waldensian } }
	}
	option = {
		name = EVTOPTB_emf_heresy_2036
		trigger = { religion = waldensian }
	}
}

# Refugees arrive at a Waldensian ruler's capital
character_event = { 
	id = emf_heresy.2037
	desc = EVTDESC_emf_heresy_2037
	picture = GFX_evt_pilgrims_epic_journey
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	religion = waldensian
	
	trigger = {
		war = yes
		is_ruler = yes
		demesne_size = 1
		OR = {
			NOT = { has_character_flag = wald_refugees }
			had_character_flag = { flag = wald_refugees days = 3650 }
		}
	}
	
	weight_multiplier = {
		days = 1
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2037
		set_character_flag = wald_refugees
		piety = 50
		scaled_wealth = -0.4
		if = {
			limit = { trait = greedy }
			remove_trait = greedy
		}
		if = {
			limit = {
				NOT = { trait = charitable }
				NOT = { trait = greedy }
			}
			random = {
				chance = 75
				add_trait = charitable
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2037
		set_character_flag = wald_refugees
		piety = -50
		if = {
			limit = { trait = charitable }
			remove_trait = charitable
		}
		if = {
			limit = {
				NOT = { trait = greedy }
				NOT = { trait = charitable }
			}
			random = {
				chance = 40
				add_trait = greedy
			}
		}
	}
}

# Waldensian ruler is greedy
character_event = { 
	id = emf_heresy.2038
	desc = EVTDESC_emf_heresy_2038
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	religion = waldensian
	
	trigger = {
		is_ruler = yes
		trait = greedy
		NOT = { has_character_modifier = the_greedy }
	}
	
	weight_multiplier = {
		days = 1
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2038
		piety = -50
		add_character_modifier = {
			name = the_greedy
			duration = 730
		}
	}
}

# Charitable Waldensian sees opportunity to help the poor
character_event = { 
	id = emf_heresy.2039
	desc = EVTDESC_emf_heresy_2039
	picture = GFX_evt_busy_trading_dock_republic
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	religion = waldensian
	
	trigger = {
		war = no
		is_ruler = yes
		trait = charitable
		scaled_wealth = 1.0
		wealth = 50
		OR = {
			trait = fortune_builder
			trait = thrifty_clerk
			trait = indulgent_wastrel
		}
		NOT = { has_character_flag = wald_steward }
	}
	
	weight_multiplier = {
		days = 1
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2039
		set_character_flag = wald_steward
		scaled_wealth = { value = -0.5 min = -25 }
		if = {
			limit = { trait = fortune_builder }
			remove_trait = fortune_builder
			add_trait = midas_touched
		}
		if = {
			limit = { trait = thrifty_clerk }
			remove_trait = thrifty_clerk
			add_trait = fortune_builder
		}
		if = {
			limit = { trait = indulgent_wastrel }
			remove_trait = indulgent_wastrel
			add_trait = thrifty_clerk
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2039
		set_character_flag = wald_steward
		piety = -20
	}
}

# Waldensian child learns charity
character_event = {
	id = emf_heresy.2040
	desc = EVTDESC_emf_heresy_2040
	picture = GFX_evt_child_talking
	
	is_triggered_only = yes
	
	min_age = 6
	max_age = 16
	religion = waldensian

	trigger = {
		NOT = { personality_traits = 5 }
		NOT = { trait = charitable }
		NOT = { trait = greedy }
		educator = { religion = ROOT }
	}
	
	weight_multiplier = {
		days = 1
		modifier = {
			factor = 0.1
			educator = { trait = greedy }
		}
		modifier = {
			factor = 2.0
			educator = { trait = charitable }
		}
	}	
	
	option = {
		name = EVTOPTA_emf_heresy_2040
		add_trait = charitable
		hidden_tooltip = {
			educator = {
				character_event = {
					id = 2030
					days = 3
				}
			}
		}
	}
}

# Waldensian Primate appears
narrative_event = {
	id = emf_heresy.2072
	title = EVTNAME_emf_heresy_2072
	desc = EVTDESC_emf_heresy_2072
	picture = GFX_evt_heretic_pride
	border = GFX_event_narrative_frame_religion

	major = yes
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2072
		trigger = { religion = waldensian }
	}
	option = {
		name = EVTOPTB_emf_heresy_2072
		trigger = {
			religion_group = christian
			NOT = { religion = waldensian }
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_2072
		trigger = {
			NOT = { religion_group = christian }
		}
	}
}

#######################################
# MESSALIAN EVENTS
#######################################

# Attempting to drive out the demons
character_event = {
	id = emf_heresy.2041
	desc = EVTDESC_emf_heresy_2041
	picture = GFX_evt_ritual_scroll
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2041
		set_character_flag = messalian_praying
		hidden_tooltip = {
			# Randomly pick which sin is addressed first, and whether there is a temptation event		
			random_list = {
				10 = {
					modifier = {
						factor = 0
						NOR = {
							trait = lustful
							trait = hedonist
						}
					}
					set_character_flag = driving_out_lust
					character_event = { id = emf_heresy.2045 days = 300 random = 200 } # check for success
					if = {
						limit = { NOT = { trait = homosexual } }
						random = {
							chance = 75
							character_event = { id = emf_heresy.2046 days = 150 random = 100 } # Lustful temptation
						}
					}
					if = {
						limit = { trait = homosexual }
						random = {
							chance = 75
							character_event = { id = emf_heresy.2047 days = 150 random = 100 } # Homosexual temptation
						}
					}
				}
				10 = {
					modifier = {
						factor = 0
						NOT = { trait = gluttonous }
					}
					set_character_flag = driving_out_gluttony
					character_event = { id = emf_heresy.2045 days = 300 random = 200 } # check for success
					random = {
						chance = 75
						character_event = { id = emf_heresy.2048 days = 150 random = 100 } # Gluttonous temptation
					}
				}
				10 = {
					modifier = {
						factor = 0
						NOT = { trait = greedy }
					}
					set_character_flag = driving_out_greed
					character_event = { id = emf_heresy.2045 days = 300 random = 200 } # check for success
					random = {
						chance = 75
						character_event = { id = emf_heresy.2049 days = 150 random = 100 } # Greed temptation
					}
				}
				10 = {
					modifier = {
						factor = 0
						NOT = { trait = slothful }
					}
					set_character_flag = driving_out_sloth
					character_event = { id = emf_heresy.2045 days = 300 random = 200 } # check for success
					random = {
						chance = 75
						character_event = { id = emf_heresy.2050 days = 150 random = 100 } # Slothful temptation
					}
				}
				10 = {
					modifier = {
						factor = 0
						NOT = { trait = wroth }
					}
					set_character_flag = driving_out_wrath
					character_event = { id = emf_heresy.2045 days = 300 random = 200 } # check for success
					random = {
						chance = 75
						character_event = { id = emf_heresy.2051 days = 150 random = 100 } # Wrathful temptation
					}
				}
				10 = {
					modifier = {
						factor = 0
						NOT = { trait = envious }
					}
					set_character_flag = driving_out_envy
					character_event = { id = emf_heresy.2045 days = 300 random = 200 } # check for success
					random = {
						chance = 75
						character_event = { id = emf_heresy.2052 days = 150 random = 100 } # Envious temptation
					}
				}
				10 = {
					modifier = {
						factor = 0
						NOT = { trait = proud }
					}
					set_character_flag = driving_out_pride
					character_event = { id = emf_heresy.2045 days = 300 random = 200 } # check for success
					random = {
						chance = 75
						character_event = { id = emf_heresy.2053 days = 150 random = 100 } # Pride temptation
					}
				}
				10 = {
					modifier = {
						factor = 0
						NOT = { trait = cruel }
					}
					set_character_flag = driving_out_cruelty
					character_event = { id = emf_heresy.2045 days = 300 random = 200 } # check for success
					random = {
						chance = 75
						character_event = { id = emf_heresy.2054 days = 150 random = 100 } # Cruelty temptation
					}
				}
				10 = {
					modifier = {
						factor = 0
						NOT = { trait = possessed }
					}
					set_character_flag = driving_out_possession
					character_event = { id = emf_heresy.2045 days = 300 random = 200 } # check for success
				}
				10 = {
					modifier = {
						factor = 0
						NOT = { trait = lunatic }
					}
					set_character_flag = driving_out_lunacy
					character_event = { id = emf_heresy.2045 days = 300 random = 200 } # check for success
				}
				10 = {
					modifier = {
						factor = 0
						OR = {
							trait = lustful
							trait = gluttonous
							trait = greedy
							trait = slothful
							trait = wroth
							trait = envious
							trait = proud
							trait = cruel
							trait = possessed
							trait = lunatic
						}
					}
					set_character_flag = becoming_messalian_master
					character_event = { id = emf_heresy.2045 days = 300 random = 200 } # check for success
				}
			}
		}
	}
}

# Failed to drive out the demons
character_event = {
	id = emf_heresy.2042
	picture = GFX_evt_messalian_sin
	border = GFX_event_normal_frame_religion
	
	desc = {
		text = EVTDESC_emf_heresy_2042
		trigger = {
			NOR = {
				has_character_flag = driving_out_lunacy
				has_character_flag = driving_out_possession
				has_character_flag = becoming_messalian_master
			}
		}
	}
	desc = {
		text = EVTDESC_emf_heresy_2042_lunacy
		trigger = { has_character_flag = driving_out_lunacy }
	}
	desc = {
		text = EVTDESC_emf_heresy_2042_possession
		trigger = { has_character_flag = driving_out_possession }
	}
	desc = {
		text = EVTDESC_emf_heresy_2042_master
		trigger = { has_character_flag = driving_out_possession }
	}

	is_triggered_only = yes
	
	trigger = { has_character_modifier = messalian_prayer }

	option = {
		name = EVTOPTA_emf_heresy_2042
		prestige = -50
		piety = -50
		clr_character_flag = messalian_praying
		remove_character_modifier = messalian_prayer
		if = {
			limit = { has_character_flag = driving_out_lust }
			add_trait = lustful
		}
		if = {
			limit = { has_character_flag = driving_out_gluttony }
			add_trait = gluttonous
		}
		if = {
			limit = { has_character_flag = driving_out_greed }
			add_trait = greedy
		}
		if = {
			limit = { has_character_flag = driving_out_sloth }
			add_trait = slothful
		}
		if = {
			limit = { has_character_flag = driving_out_wrath }
			add_trait = wroth
		}
		if = {
			limit = { has_character_flag = driving_out_envy }
			add_trait = envious
		}
		if = {
			limit = { has_character_flag = driving_out_pride }
			add_trait = proud
		}
		if = {
			limit = { has_character_flag = driving_out_cruelty }
			add_trait = cruel
		}
		if = {
			limit = { has_character_flag = driving_out_possession }
			add_trait = possessed
			add_character_modifier = {
				name = voice_of_satan
				duration = -1
			}
		}
		if = {
			limit = { has_character_flag = driving_out_lunacy }
			add_trait = lunatic
		}
		if = {
			limit = { has_character_flag = becoming_messalian_master }
			random = {
				chance = 25
				add_trait = stressed
			}
		}
		clr_character_flag = driving_out_lust
		clr_character_flag = driving_out_gluttony
		clr_character_flag = driving_out_greed
		clr_character_flag = driving_out_sloth
		clr_character_flag = driving_out_wrath
		clr_character_flag = driving_out_envy
		clr_character_flag = driving_out_pride
		clr_character_flag = driving_out_cruelty
		clr_character_flag = driving_out_possession
		clr_character_flag = driving_out_lunacy
		clr_character_flag = becoming_messalian_master
		clr_character_flag = messalian_temptation
		random = {
			chance = 25
			add_trait = depressed
		}
		add_character_modifier = {
			name = messalian_prayer_timer
			duration = 1095
			hidden = yes
		}
	}
}

# Succeeded in driving out a demon
character_event = {
	id = emf_heresy.2043
	picture = GFX_evt_messalian_sin
	border = GFX_event_normal_frame_religion
	
	desc = {
		text = EVTDESC_emf_heresy_2043_lust
		trigger = { has_character_flag = driving_out_lust }
	}
	desc = {
		text = EVTDESC_emf_heresy_2043_gluttony
		trigger = { has_character_flag = driving_out_gluttony }
	}
	desc = {
		text = EVTDESC_emf_heresy_2043_greed
		trigger = { has_character_flag = driving_out_greed }
	}
	desc = {
		text = EVTDESC_emf_heresy_2043_sloth
		trigger = { has_character_flag = driving_out_sloth }
	}
	desc = {
		text = EVTDESC_emf_heresy_2043_wrath
		trigger = { has_character_flag = driving_out_wrath }
	}
	desc = {
		text = EVTDESC_emf_heresy_2043_envy
		trigger = { has_character_flag = driving_out_envy }
	}
	desc = {
		text = EVTDESC_emf_heresy_2043_pride
		trigger = { has_character_flag = driving_out_pride }
	}
	desc = {
		text = EVTDESC_emf_heresy_2043_cruelty
		trigger = { has_character_flag = driving_out_cruelty }
	}
	desc = {
		text = EVTDESC_emf_heresy_2043_possession
		trigger = { has_character_flag = driving_out_possession }
	}
	desc = {
		text = EVTDESC_emf_heresy_2043_lunacy
		trigger = { has_character_flag = driving_out_lunacy }
	}
	desc = {
		text = EVTDESC_emf_heresy_2043_master
		trigger = { has_character_flag = becoming_messalian_master }
	}

	is_triggered_only = yes
	
	trigger = { has_character_modifier = messalian_prayer }

	option = {
		name = EVTOPTA_emf_heresy_2043
		if = {
			limit = { NOT = { has_character_flag = becoming_messalian_master } }
			prestige = 50
			piety = 50
		}
		if = {
			limit = { has_character_flag = driving_out_lust }
			remove_trait = lustful
			remove_trait = hedonist
			random = {
				chance = 20
				add_trait = chaste
			}
		}
		if = {
			limit = { has_character_flag = driving_out_gluttony }
			remove_trait = gluttonous
			random = {
				chance = 20
				add_trait = temperate
			}
		}
		if = {
			limit = { has_character_flag = driving_out_greed }
			remove_trait = greedy
			random = {
				chance = 20
				add_trait = charitable
			}
		}
		if = {
			limit = { has_character_flag = driving_out_sloth }
			remove_trait = slothful
			random = {
				chance = 20
				add_trait = diligent
			}
		}
		if = {
			limit = { has_character_flag = driving_out_wrath }
			remove_trait = wroth
			random = {
				chance = 20
				add_trait = patient
			}
		}
		if = {
			limit = { has_character_flag = driving_out_envy }
			remove_trait = envious
			random = {
				chance = 20
				add_trait = kind
			}
		}
		if = {
			limit = { has_character_flag = driving_out_pride }
			remove_trait = proud
			random = {
				chance = 20
				add_trait = humble
			}
		}
		if = {
			limit = { has_character_flag = driving_out_cruelty }
			remove_trait = cruel
			random = {
				chance = 20
				add_trait = kind
			}
		}
		if = {
			limit = { has_character_flag = driving_out_possession }
			remove_trait = possessed
			hidden_tooltip = {
				remove_character_modifier = voice_of_satan
				remove_character_modifier = voice_of_jesus
				remove_character_modifier = speaking_in_tounges
				remove_character_modifier = holy_comet
				remove_character_modifier = lycanthropy
				clr_character_flag = demon_child
				clr_character_flag = demon_child_fake
				clr_character_flag = child_exorcism
			}
		}
		if = {
			limit = { has_character_flag = driving_out_lunacy }
			remove_trait = lunatic
		}
		if = {
			limit = { has_character_flag = becoming_messalian_master }
			prestige = 250
			if = {
				limit = { NOT = { religion_authority = 0.75 } }
				religion_authority = {
					modifier = m_master
					years = 10
				}
			}
			add_trait = messalian_master
			random_list = {
				20 = {
					modifier = {
						factor = 0
						trait = hedonist
					}
					add_trait = hedonist
				}
				10 = {
					modifier = {
						factor = 0
						trait = cruel
					}
					add_trait = cruel
				}
				10 = {
					modifier = {
						factor = 0
						trait = drunkard
					}
					add_trait = drunkard
				}
				10 = {
					modifier = {
						factor = 0
						trait = lustful
					}
					add_trait = lustful
				}
				10 = {
					modifier = {
						factor = 0
						trait = gluttonous
					}
					add_trait = gluttonous
				}
				5 = {
					modifier = {
						factor = 0
						trait = lunatic
					}
					add_trait = lunatic
				}
			}
		}
		clr_character_flag = driving_out_lust
		clr_character_flag = driving_out_gluttony
		clr_character_flag = driving_out_greed
		clr_character_flag = driving_out_sloth
		clr_character_flag = driving_out_wrath
		clr_character_flag = driving_out_envy
		clr_character_flag = driving_out_pride
		clr_character_flag = driving_out_cruelty
		clr_character_flag = driving_out_possession
		clr_character_flag = driving_out_lunacy
		clr_character_flag = becoming_messalian_master
		clr_character_flag = messalian_temptation
		clr_character_flag = messalian_praying
		remove_character_modifier = messalian_prayer
	}
}

# Forced to abandon prayers
character_event = {
	id = emf_heresy.2044
	picture = GFX_evt_ritual_scroll
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_emf_heresy_2044_not_messalian
		trigger = { NOT = { religion = messalian } }
	}
	desc = {
		text = EVTDESC_emf_heresy_2044_prisoner
		trigger = { prisoner = yes }
	}
	desc = {
		text = EVTDESC_emf_heresy_2044_incapable
		trigger = { trait = incapable }
	}
	
	min_age = 16
	has_character_flag = messalian_praying
	
	trigger = {
		has_character_modifier = messalian_prayer
		OR = {
			NOT = { religion = messalian }
			prisoner = yes
			trait = incapable
		}
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	option = {
		name = OK
		remove_character_modifier = messalian_prayer
		clr_character_flag = driving_out_lust
		clr_character_flag = driving_out_gluttony
		clr_character_flag = driving_out_greed
		clr_character_flag = driving_out_sloth
		clr_character_flag = driving_out_wrath
		clr_character_flag = driving_out_envy
		clr_character_flag = driving_out_pride
		clr_character_flag = driving_out_cruelty
		clr_character_flag = driving_out_possession
		clr_character_flag = driving_out_lunacy
		clr_character_flag = becoming_messalian_master
		clr_character_flag = messalian_temptation
		clr_character_flag = messalian_praying
		add_character_modifier = {
			name = messalian_prayer_timer
			duration = 1095
			hidden = yes
		}
	}
}

# Bounce event to determine success
character_event = {
	id = emf_heresy.2045
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = { has_character_modifier = messalian_prayer }
	
	immediate = {
		random_list = {
			60 = {
				modifier = {
					factor = 1.2
					trait = diligent
				}
				modifier = {
					factor = 1.2
					trait = patient
				}
				modifier = {
					factor = 1.2
					trait = ambitious
				}
				modifier = {
					factor = 1.2
					has_character_flag = becoming_messalian_master
					trait = zealous
				}
				modifier = {
					factor = 1.2
					has_character_flag = becoming_messalian_master
					piety = 750
				}
				modifier = {
					factor = 1.2
					has_character_flag = becoming_messalian_master
					piety = 1000
				}
				modifier = {
					factor = 1.2
					has_character_flag = becoming_messalian_master
					piety = 1250
				}
				modifier = {
					factor = 1.2
					has_character_flag = becoming_messalian_master
					piety = 1500
				}
				modifier = {
					factor = 1.2
					has_character_flag = becoming_messalian_master
					piety = 1750
				}
				modifier = {
					factor = 1.2
					has_character_flag = becoming_messalian_master
					piety = 2000
				}
				modifier = {
					factor = 0.5
					has_character_flag = becoming_messalian_master
				}
				modifier = {
					factor = 0.25
					has_character_flag = messalian_temptation
				}
				modifier = {
					factor = 0.15
					OR = {
						has_character_flag = driving_out_possession
						has_character_flag = driving_out_lunacy
					}
				}
				character_event = { id = emf_heresy.2043 } #Success
			}
			40 = {
				modifier = {
					factor = 1.2
					trait = slothful
				}
				modifier = {
					factor = 1.2
					trait = content
				}
				modifier = {
					factor = 1.75
					has_character_flag = becoming_messalian_master
				}
				modifier = {
					factor = 2.125
					has_character_flag = messalian_temptation
				}
				modifier = {
					factor = 2.25
					OR = {
						has_character_flag = driving_out_possession
						has_character_flag = driving_out_lunacy
					}
				}
				character_event = { id = emf_heresy.2042 } #Failure
			}
		}
	}
}

# Praying character receives lustful temptation
character_event = {
	id = emf_heresy.2046
	desc = EVTDESC_emf_heresy_2046
	picture = GFX_evt_lovers
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2046 #I will surround myself only with those of my gender!
		any_lover = {
			tooltip = { remove_lover = ROOT }
			hidden_tooltip = { character_event = { id = WoL.1103 } }
		}
		hidden_tooltip = {
			character_event = { id = emf_heresy.2047 days = 10 random = 20 }
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2046 #I cannot resist the temptation
		set_character_flag = messalian_temptation
		piety = -25
	}
}

# Praying character receives homosexual temptation
character_event = {
	id = emf_heresy.2047
	picture = GFX_evt_lovers
	border = GFX_event_normal_frame_religion
	
	desc = {
		text = EVTDESC_emf_heresy_2047_male
		trigger = { is_female = no }
	}
	desc = {
		text = EVTDESC_emf_heresy_2047_female
		trigger = { is_female = yes }
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2047 #I must resist!
		trigger = { piety = 50 }
		any_lover = {
			tooltip = { remove_lover = ROOT }
			hidden_tooltip = { character_event = { id = WoL.1103 } }
		}
		piety = -50
	}
	option = {
		name = EVTOPTB_emf_heresy_2047 #I have no choice but to give in
		set_character_flag = messalian_temptation
		if = {
			limit = { NOT = { trait = homosexual } }
			add_trait = homosexual
		}
	}
}

# Praying character receives gluttonous temptation
character_event = {
	id = emf_heresy.2048
	desc = EVTDESC_emf_heresy_2048
	picture = GFX_evt_knight_kneeling
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2048 #I cannot surrender to the sins of the flesh!
		trigger = {
			piety = 50
		}
		piety = -50
		health = -1
	}
	option = {
		name = EVTOPTB_emf_heresy_2047 #I have no choice but to give in
		set_character_flag = messalian_temptation
	}
}

# Praying character receives greed temptation
character_event = {
	id = emf_heresy.2049
	desc = EVTDESC_emf_heresy_2049
	picture = GFX_evt_knight_kneeling
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2049 #No, gambling is sinful and greedy
		trigger = {
			piety = 50
		}
		piety = -50
	}
	option = {
		name = EVTOPTB_emf_heresy_2049 #Perhaps just a few games won't hurt...
		set_character_flag = messalian_temptation
		scaled_wealth = 0.1
	}
}

# Praying character receives slothful temptation
character_event = {
	id = emf_heresy.2050
	desc = EVTDESC_emf_heresy_2050
	picture = GFX_evt_knight_kneeling
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2050 #I will make a determined effort
		trigger = {
			NOT = { trait = content }
			OR = {
				piety = 50
				NOT = { trait = stressed }
			}
		}
		if = {
			limit = { trait = stressed }
			piety = -50
		}
		if = {
			limit = { NOT = { trait = stressed } }
			add_trait = stressed
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2050 #Prayers can wait until tomorrow
		set_character_flag = messalian_temptation
		if = {
			limit = { NOT = { trait = content } }
			random = {
				chance = 30
				add_trait = content
			}
		}
	}
}

# Praying character receives wrathful temptation
character_event = {
	id = emf_heresy.2051
	desc = EVTDESC_emf_heresy_2051
	picture = GFX_evt_knight_kneeling
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2051 #Slowly count to ten...
		trigger = {
			piety = 50
		}
		piety = -50
		prestige = -50
	}
	option = {
		name = EVTOPTB_emf_heresy_2051 #Have that hat nailed to his head
		set_character_flag = messalian_temptation
		prestige = 50
	}
}

# Praying character receives envious temptation
character_event = {
	id = emf_heresy.2052
	desc = EVTDESC_emf_heresy_2052
	picture = GFX_evt_knight_kneeling
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2052 #I can do without it
		trigger = {
			piety = 50
		}
		piety = -50
		if = {
			limit = { trait = ambitious }
			random = {
				chance = 50
				remove_trait = ambitious
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2052 #I will take it for myself
		set_character_flag = messalian_temptation
		prestige = 50
		if = {
			limit = { NOT = { trait = ambitious } }
			random = {
				chance = 50
				add_trait = ambitious
			}
		}
	}
}

# Praying character receives pride temptation
character_event = {
	id = emf_heresy.2053
	desc = EVTDESC_emf_heresy_2053
	picture = GFX_evt_knight_kneeling
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2053 #Humbly ask him for help
		trigger = {
			piety = 50
		}
		prestige = -50
		piety = -50
	}
	option = {
		name = EVTOPTB_emf_heresy_2053 #No, that's ridiculous! What could he do?
		set_character_flag = messalian_temptation
		prestige = 50
	}
}

# Praying character receives cruelty temptation
character_event = {
	id = emf_heresy.2054
	desc = EVTDESC_emf_heresy_2054
	picture = GFX_evt_knight_kneeling
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2054 #Let him go free
		trigger = {
			piety = 50
		}
		prestige = -50 
		piety = -50
		if = {
			limit = { NOT = { trait = arbitrary } }
			random = {
				chance = 30
				add_trait = arbitrary
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2054 #Hang him as he deserves!
		set_character_flag = messalian_temptation
		prestige = 50
	}
}

# Messalian chooses a patron saint
character_event = {
	id = emf_heresy.2055
	desc = EVTDESC_emf_heresy_2055
	picture = GFX_evt_knight_kneeling
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2055
		add_character_modifier = {
			name = patron_nestor
			duration = -1
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2055
		add_character_modifier = {
			name = patron_addai
			duration = -1
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_2055
		add_character_modifier = {
			name = patron_lucifer
			duration = -1
		}
	}
	option = {
		name = EVTOPTD_emf_heresy_2055
		add_character_modifier = {
			name = patron_adelphius 
			duration = -1
		}
	}
}

# Joining the Cult of Lucifer
character_event = { 
	id = emf_heresy.2056
	desc = EVTDESC_emf_heresy_2056
	picture = GFX_evt_cult_initiation
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2056
		add_trait = cult_of_lucifer
	}
}

# The Army of Lucifer founded
narrative_event = {
	id = emf_heresy.2057
	title = EVTNAME_emf_heresy_2057
	desc = EVTDESC_emf_heresy_2057
	picture = GFX_evt_crusaders
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	major = yes
	hide_from = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2057
		trigger = {
			religion = messalian
		}
	}
	option = {
		name = I_SEE
		trigger = {
			NOT = { religion = messalian }
		}
	}
}

# Ping event when donating money to the Army of Light
character_event = {
	id = emf_heresy.2058
	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		wealth = 300
		FROM = {
			letter_event = {
				id = emf_heresy.2059
			}
		}
		opinion = {
			who = FROM
			modifier = opinion_generous_donation
		}
	}
}

# Notification event when donating money to the Army of Light
letter_event = {
	id = emf_heresy.2059
	desc = EVTDESC_emf_heresy_2059
	border = GFX_event_letter_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
	}
}

# Ping event when expelling the Army of Light
character_event = {
	id = emf_heresy.2060
	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_demesne_title = {
			limit = { holy_order = yes }
			save_event_target_as = holy_order_name
		}
		any_title_under = {
			limit = {
				tier = BARON
				location = {
					owner = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
				}
			}
			usurp_title = FROM
		}
		if = {
			limit = { is_liege_or_above = FROM }
			set_defacto_liege = THIS
		}
		FROM = {
			letter_event = {
				id = emf_heresy.2061
			}
		}
		opinion = {
			who = FROM
			modifier = opinion_expelled_from_realm
		}
	}
}

# Notification event when expelling the Army of Light
letter_event = {
	id = emf_heresy.2061
	desc = EVTDESC_emf_heresy_2061
	border = GFX_event_letter_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		remove_character_modifier = donated_to_holy_order
	}
	
	option = {
		name = EVTOPTB_SOA_1061
	}
}

#######################################
# MONK/NUN EVENTS
#######################################

# Adult christian asks to become a monk/nun
letter_event = {
	id = emf_heresy.2062
	border = GFX_event_letter_frame_religion
	
	desc = {
		text = EVTDESC_emf_heresy_2062_male
		trigger = { FROM = { is_female = no } }
	}
	desc = {
		text = EVTDESC_emf_heresy_2062_female
		trigger = { FROM = { is_female = yes } }
	}
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SoA_5218
		FROM = {
			any_spouse = { remove_spouse = PREV }
			if = {
				limit = { is_female = no }
				change_learning = 1
				add_trait = monk
				hidden_tooltip = {
					set_character_flag = title_monk
					set_special_character_title = MONK_BROTHER
				}
			}
			if = {
				limit = { is_female = yes }
				change_learning = 1
				add_trait = nun
				hidden_tooltip = {
					set_character_flag = title_nun
					set_special_character_title = NUN_SISTER
				}
			}
			opinion = {
				modifier = opinion_grateful
				who = ROOT
				years = 100
			}
		}
	}
	option = {
		name = EVTOPTB_SoA_5218
		FROM = {
			random_list = {
				50 = { add_trait = stressed }
				50 = { add_trait = depressed }
				20 = { add_trait = cynical }
			}
			set_character_flag = monk_refused
			opinion = {
				modifier = opinion_angry
				who = ROOT
				years = 10
			}
		}
	}
}

#######################################
# MIAPHYSITE EVENTS
#######################################

# Birth of the Order of Saint Blaise
narrative_event = {
	id = emf_heresy.2063
	title = EVTNAME_emf_heresy_2063
	desc = EVTDESC_emf_heresy_2063
	picture = GFX_evt_knight_kneeling
	
	major = yes
	only_playable = yes
	religion_group = christian
	hide_from = yes
	
	trigger = {
		OR = {
			religion = apostolic
			religion = paulician
			religion = tondrakian
		}
		is_heretic = no
		
		NOT = { is_title_active = d_saint_blaise }
		has_global_flag = christian_crusades_unlocked
		
		OR = {
			year = 1191	# Historical
			k_jerusalem = {
				holder_scope = { religion_group = christian }
			}
		}
	}
	
	mean_time_to_happen = {
		months = 36
		modifier = {
			factor = 10
			k_jerusalem = {
				holder_scope = { religion_group = christian }
			}
		}
	}
	
	immediate = {
		activate_title = { title = d_saint_blaise status = yes }
		create_character = {
			random_traits = no
			dynasty = random
			religion = ROOT
			culture = armenian
			female = no
			age = 35
		}
		new_character = {
			wealth = 500
			d_saint_blaise = {
				grant_title = PREV
			}
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2063
		trigger = {
			religion_group = christian
		}
	}
	option = {
		name = EVTOPTB39100
		trigger = {
			NOT = { religion_group = christian }
		}
	}
}

# Birth of the Order of Saint Mark
narrative_event = {
	id = emf_heresy.2064
	title = EVTNAME_emf_heresy_2064
	desc = EVTDESC_emf_heresy_2064
	picture = GFX_evt_knight_kneeling
	
	major = yes
	hide_from = yes
	
	is_triggered_only = yes
	
	immediate = {
		create_random_soldier = {
			random_traits = yes
			dynasty = random
			religion = ROOT
			culture = ROOT
			female = no
			age = 35
		}
		new_character = {
			wealth = 500
			d_knights_saint_mark = {
				grant_title = PREV
			}
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2063
		trigger = {
			religion_group = ROOT
		}
	}
	option = {
		name = EVTOPTB39100
		trigger = {
			NOT = { religion_group = ROOT }
		}
	}
}

# Desert Mother/Father moves on after staying a while
character_event = {
	id = emf_heresy.2065
	
	hide_window = yes
	ai = yes
	capable_only = yes
	prisoner = no
	religion_group = christian
	has_character_flag = is_desert_mother_father
	
	trigger = {
		OR = {
			trait = desert_mother
			trait = desert_father
		}
		war = no
		is_ill = no
		NOR = {
			any_liege = { war = yes }
			trait = wounded
			trait = maimed
			trait = infirm
		}
	}
	
	mean_time_to_happen = {
		months = 72
		modifier = {
			factor = 1.5
			OR = {
				is_councillor = yes
				is_voter = yes
			}
		}
		modifier = {
			factor = 2
			is_ruler = yes
		}
		modifier = {
			factor = 1.5
			liege = { reverse_opinion = { who = ROOT value = 25 } }
		}
		modifier = {
			factor = 0.5
			NOT = { liege = { reverse_opinion = { who = ROOT value = 0 } } }
		}
		modifier = {
			factor = 0.5
			NOT = { liege = { opinion = { who = ROOT value = 0 } } }
		}
	}
	
	immediate = {
		liege = { save_event_target_as = current_liege }
		location = { save_event_target_as = current_location }
		
		# Abdicate from title if one is held
		if = {
			limit = { is_ruler = yes }
			current_heir = {
				ROOT = { transfer_scaled_wealth = { to = PREV value = all } }
			}
			abdicate = yes
		}
		
		# Move to another court (other Miaphysites first)
		random_playable_ruler = {
			limit = {
				NOT = { character = event_target:current_liege }
				religion = ROOT
				capital_scope = {
					NOT = { distance = { where = event_target:current_location value = 200 } }
				}
			}
			ROOT = { move_character = PREV }
			break = yes
		}
		random_playable_ruler = {
			limit = {
				NOT = { character = event_target:current_liege }
				religion = ROOT
				capital_scope = {
					NOT = { distance = { where = event_target:current_location value = 400 } }
				}
			}
			ROOT = { move_character = PREV }
			break = yes
		}
		random_playable_ruler = {
			limit = {
				NOT = { character = event_target:current_liege }
				OR = {
					is_heresy_of = ROOT
					is_parent_religion = ROOT
				}
				capital_scope = {
					NOT = { distance = { where = event_target:current_location value = 400 } }
				}
			}
			ROOT = { move_character = PREV }
			break = yes
		}
		random_playable_ruler = {
			limit = {
				NOT = { character = event_target:current_liege }
				religion_group = ROOT
				capital_scope = {
					NOT = { distance = { where = event_target:current_location value = 200 } }
				}
			}
			ROOT = { move_character = PREV }
			break = yes
		}
		random_playable_ruler = {
			limit = {
				NOT = { character = event_target:current_liege }
				religion = ROOT
			}
			ROOT = { move_character = PREV }
			break = yes
		}
		random_playable_ruler = {
			limit = {
				NOT = { character = event_target:current_liege }
				OR = {
					is_heresy_of = ROOT
					is_parent_religion = ROOT
				}
			}
			ROOT = { move_character = PREV }
			break = yes
		}
		random_playable_ruler = {
			limit = {
				NOT = { character = event_target:current_liege }
				religion_group = ROOT
				capital_scope = {
					NOT = { distance = { where = event_target:current_location value = 400 } }
				}
			}
			ROOT = { move_character = PREV }
			break = yes
		}
	}
}

#######################################
# RELIGIOUS EMANCIPATION EVENTS
#######################################

# Leader sponsors meeting between religion heads
character_event = {
	id = emf_heresy.2075
	title = EVTNAME_emf_heresy_2075
	desc = EVTDESC_emf_heresy_2075
	picture = GFX_evt_cathedral
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	major = yes
	
	major_trigger = {
		OR = {
			religion = event_target:heretic_relhead
			religion = event_target:parent_relhead
		}
	}
	
	immediate = {
		ROOT = {
			save_event_target_as = sponsor
		}
		religion_head = {
			save_event_target_as = heretic_relhead
		}
		random_playable_ruler = {
			limit = {
				controls_religion = yes
				is_parent_religion = ROOT
				war = no
			}
			save_event_target_as = parent_relhead
			character_event = { id = emf_heresy.2076 days = 7 }
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2075
		trigger = {
			religion = event_target:heretic_relhead
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2075
		trigger = {
			religion = event_target:parent_relhead
		}
	}
}

# Religion head chooses result
character_event = {
	id = emf_heresy.2076
	
	hide_window = yes
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2076 # Agree to peaceful seperation
		ai_chance = {
			factor = 30
		}
		FROM = {
			narrative_event = { id = emf_heresy.2077 }
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2076 # Refuse and call crusade
		ai_chance = {
			factor = 70
			modifier = {
				factor = 0
				OR = {
					has_called_crusade = yes
					can_call_crusade = no
					NOT = { religion_authority = 0.04 }
					NOT = { num_of_baron_titles = 1 }
				}
			}
			modifier = {
				factor = 0
				NOR = {
					any_independent_ruler = {
						religion = ROOT
						war = no
						NOT = { trait = excommunicated }
						NOT = { has_non_aggression_pact_with = event_target:sponsor }
						NOT = { is_allied_with = event_target:sponsor }
						relative_power = { who = event_target:sponsor power = 0.5 }
					}
					any_independent_ruler = {
						count = 2
						religion = ROOT
						war = no
						NOT = { trait = excommunicated }
						NOT = { has_non_aggression_pact_with = event_target:sponsor }
						NOT = { is_allied_with = event_target:sponsor }
						relative_power = { who = event_target:sponsor power = 0.25 }
					}
				}
			}
			modifier = {
				factor = 2.0
				trait = zealous
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 1.5
				trait = cruel
			}
			modifier = {
				factor = 1.25
				trait = proud
			}
			modifier = {
				factor = 1.25
				trait = arbitrary
			}
			modifier = {
				factor = 0.75
				trait = patient
			}
			modifier = {
				factor = 0.75
				trait = charitable
			}
			modifier = {
				factor = 0.75
				trait = humble
			}
			modifier = {
				factor = 0.75
				trait = just
			}
			modifier = {
				factor = 0.75
				trait = kind
			}
			modifier = {
				factor = 0.5
				trait = cynical
			}
		}
		set_character_flag = reclaim_heresy_crusade
		event_target:sponsor = {
			capital_scope = {
				kingdom = {
					ROOT = {
						war = {
							target = event_target:sponsor
							casus_belli = crusade
							thirdparty_title = PREV
							infamy = 0
						}
					}
				}
			}
		}
		FROM = {
			narrative_event = { id = emf_heresy.2078 }
		}
		any_independent_ruler = {
			limit = {
				religion = ROOT
				war = no
				NOT = { trait = excommunicated }
				NOT = { has_non_aggression_pact_with = event_target:sponsor }
				NOT = { is_allied_with = event_target:sponsor }
				any_realm_province = {
					any_neighbor_province = {
						owner = { same_realm = event_target:sponsor }
					}
				}
			}
			letter_event = { id = emf_heresy.2079 days = 5 }
		}
	}
}

# The heresy will peacefully separate
narrative_event = {
	id = emf_heresy.2077
	title = EVTNAME_emf_heresy_2075
	desc = EVTDESC_emf_heresy_2077
	picture = GFX_evt_heresy_defeated
	border = GFX_event_narrative_frame_religion
	
	is_triggered_only = yes
	major = yes
	
	immediate = {
		set_parent_religion = { religion = event_target:heretic_relhead parent = 0 }
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2077
		trigger = {
			religion = event_target:heretic_relhead
		}
		tooltip = {
			set_parent_religion = { religion = event_target:heretic_relhead parent = 0 }
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2077
		trigger = {
			religion = event_target:parent_relhead
		}
		tooltip = {
			set_parent_religion = { religion = event_target:heretic_relhead parent = 0 }
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_2077
		trigger = {
			religion_group = event_target:parent_relhead
			NOT = { religion = event_target:heretic_relhead }
			NOT = { religion = event_target:parent_relhead }
		}
		tooltip = {
			set_parent_religion = { religion = event_target:heretic_relhead parent = 0 }
		}
	}
	option = {
		name = EVTOPTD_emf_heresy_2077
		trigger = {
			NOT = { religion_group = event_target:parent_relhead }
		}
		tooltip = {
			set_parent_religion = { religion = event_target:heretic_relhead parent = 0 }
		}
	}
}

# The parent religion has called a crusade
narrative_event = {
	id = emf_heresy.2078
	title = EVTNAME_emf_heresy_2075
	desc = EVTDESC_emf_heresy_2078
	picture = GFX_evt_crusaders
	border = GFX_event_narrative_frame_religion
	
	is_triggered_only = yes
	major = yes
	
	major_trigger = {
		OR = {
			religion = event_target:heretic_relhead
			religion = event_target:parent_relhead
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2078
		trigger = {
			religion = event_target:heretic_relhead
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2078
		trigger = {
			religion = event_target:parent_relhead
		}
	}
}

# The parent religion head calls for others to join the crusade
letter_event = {
	id = emf_heresy.2079
	desc = EVTDESC_emf_heresy_2079
	border = GFX_event_letter_frame_religion
	
	is_triggered_only = yes
	
	trigger = {
		religion = FROM
		war = no
		NOT = { trait = excommunicated }
		NOT = { has_non_aggression_pact_with = event_target:sponsor }
		NOT = { is_allied_with = event_target:sponsor }
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2079 # Join the crusade
		ai_chance = {
			factor = 50
			modifier = {
				factor = 3
				trait = zealous
			}
			modifier = {
				factor = 1.5
				trait = diligent
			}
			modifier = {
				factor = 1.5
				trait = humble
			}
			modifier = {
				factor = 1.5
				trait = brave
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROM value = 20 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROM value = 40 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROM value = 60 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROM value = 80 }
			}
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = event_target:sponsor value = -20 } }
			}
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = event_target:sponsor value = -40 } }
			}
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = event_target:sponsor value = -60 } }
			}
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = event_target:sponsor value = -80 } }
			}
		}
		piety = 100
		join_attacker_wars = FROM
	}
	option = {
		name = EVTOPTB_emf_heresy_2079 # We'll think about it
		ai_chance = {
			factor = 50
			modifier = {
				factor = 3
				trait = cynical
			}
			modifier = {
				factor = 1.5
				trait = slothful
			}
			modifier = {
				factor = 1.5
				trait = proud
			}
			modifier = {
				factor = 1.5
				trait = craven
			}
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = FROM value = -20 } }
			}
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = FROM value = -40 } }
			}
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = FROM value = -60 } }
			}
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = FROM value = -80 } }
			}
			modifier = {
				factor = 1.25
				opinion = { who = event_target:sponsor value = 20 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = event_target:sponsor value = 40 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = event_target:sponsor value = 60 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = event_target:sponsor value = 80 }
			}
		}
	}
}

#######################################
# ICONOCLAST EVENTS
#######################################

# Iconoclast ruler has an Orthodox province with acheiropoieta
character_event = {
	id = emf_heresy.2100
	title = EVTNAME_emf_heresy_2100
	desc = EVTDESC_emf_heresy_2100
	picture = GFX_evt_icon
	
	only_playable = yes
	capable_only = yes
	prisoner = no
	min_age = 16
	religion = iconoclast
	
	trigger = {
		war = no
		controls_religion = no
		NOT = { rightful_religious_head = ROOT }
		d_iconoclast = { has_holder = yes }
		any_demesne_province = {
			religion = orthodox
			NOT = { has_province_flag = acheiropoieta_destroyed }
			NOT = { has_province_modifier = iconoclast_blowback }
		}
		OR = {
			NOT = { has_character_flag = acheiropoieta }
			had_character_flag = { flag = acheiropoieta days = 1825 }
		}
	}
	
	mean_time_to_happen = {
		years = 75
		modifier = {
			factor = 0.5
			trait = zealous
		}
		modifier = {
			factor = 2.0
			trait = cynical
		}
		modifier = {
			factor = 0.5
			trait = iconoclast_trait
		}
	}

	immediate = {
		set_character_flag = acheiropoieta
		random_demesne_province = {
			limit = {
				religion = orthodox
				NOT = { has_province_flag = acheiropoieta_destroyed }
				NOT = { has_province_modifier = iconoclast_blowback }
			}
			save_event_target_as = acheiropoieta_province
		}
		d_iconoclast = {
			holder_scope = {
				save_event_target_as = iconoclast_patriarch
			}
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2100 #Destroy it
		ai_chance = {
			factor = 75
			modifier = {
				factor = 2
				trait = zealous
			}
			modifier = {
				factor = 2
				trait = iconoclast_trait
			}
			modifier = {
				factor = 1.5
				trait = diligent
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
		}
		piety = 100
		if = {
			limit = { NOT = { trait = iconoclast_trait } }
			add_trait = iconoclast_trait
		}
		event_target:iconoclast_patriarch = {
			opinion = { who = ROOT modifier = opinion_pleased years = 5 }
		}
		event_target:acheiropoieta_province = {
			set_province_flag = acheiropoieta_destroyed
			add_province_modifier = {
				name = iconoclast_blowback
				duration = 3650
			}
			random_neighbor_province = {
				limit = {
					religion = orthodox
					NOT = { has_province_modifier = iconoclast_blowback }
				}
				add_province_modifier = {
					name = iconoclast_blowback
					duration = 1825
				}
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2100 #Leave it be
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0
				NOT = { piety = 0 }
				NOT = { trait = cynical }
			}
			modifier = {
				factor = 3
				trait = cynical
			}
			modifier = {
				factor = 2
				trait = charitable
			}
			modifier = {
				factor = 1.5
				trait = slothful
			}
			modifier = {
				factor = 1.5
				trait = patient
			}
		}
		piety = -50
		event_target:iconoclast_patriarch = {
			opinion = { who = ROOT modifier = opinion_disappointed multiplier = 2 years = 5 }
		}
		if = {
			limit = { trait = iconoclast_trait }
			remove_trait = iconoclast_trait
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_2100 #Keep it for myself
		trigger = { trait = greedy }
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.5
				intrigue = 10
			}
			modifier = {
				factor = 1.5
				trait = proud
			}
			modifier = {
				factor = 1.5
				trait = ambitious
			}
			modifier = {
				factor = 0.5
				trait = temperate
			}
			modifier = {
				factor = 0.5
				trait = humble
			}
			modifier = {
				factor = 0.5
				trait = content
			}
		}
		tooltip_info = greedy
		prestige = 25
		piety = 25
		hidden_tooltip = {
			event_target:acheiropoieta_province = { set_province_flag = acheiropoieta_destroyed }
			character_event = { id = emf_heresy.2101 days = 1825 random = 3650 } #Chance of going crazy
		}
	}
}

# Iconoclast ruler who kept the acheiropoieta may go crazy
character_event = {
	id = emf_heresy.2101
	desc = EVTDESC_emf_heresy_2101
	picture = GFX_evt_icon

	is_triggered_only = yes
	
	trigger = {
		religion = iconoclast
		is_ruler = yes
		prisoner = no
		NOR = {
			trait = lunatic
			trait = possessed
			trait = incapable
		}
	}

	option = {
		name = EVTOPTA_emf_heresy_2101
		random = {
			chance = 50
			add_trait = possessed
		}
		piety = -100
		if = {
			limit = { higher_tier_than = BARON }
			religion_authority = {
				modifier = ruler_converted_from
			}
		}
		abandon_heresy = yes
		set_character_flag = converted_religion
		if = {
			limit = { higher_tier_than = BARON }
			hidden_tooltip = {
				religion_authority = {
					modifier = ruler_converted_to
				}
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2101
		random_list = {
			50 = { add_trait = lunatic }
			25 = {
				modifier = {
					factor = 0
					trait = zealous
				}
				modifier = {
					factor = 2
					trait = cynical
				}
				add_trait = zealous
			}
			25 = {
				modifier = {
					factor = 0
					trait = paranoid
				}
				modifier = {
					factor = 2
					trait = trusting
				}
				add_trait = paranoid
			}
			50 = {}
		}
	}
}

# Constantine's Return
narrative_event = {
	id = emf_heresy.2102
	title = EVTNAME_emf_heresy_2102
	desc = EVTDESC_emf_heresy_2102
	picture = GFX_evt_icon
	border = GFX_event_narrative_frame_religion
	
	major = yes
	
	only_playable = yes
	min_age = 16
	capable_only = yes
	prisoner = no
	religion = orthodox

	trigger = {
		has_landed_title = e_byzantium
		any_war = {
			attacker = {
				any_demesne_title = { temporary = no }
			}
			OR = {
				using_cb = religious
				using_cb = crusade
				using_cb = invasion
				using_cb = tribal_invasion
				using_cb = manifest_destiny_invasion
			}
			OR = {
				attacker = {
					character = ROOT
					NOT = { war_score = -50 }
				}
				defender = {
					character = ROOT
					war_score = 50
				}
			}
		}
		NOR = {
			year = 1000
			has_global_flag = constantines_return
			has_character_flag = renounced_iconoclasm
			has_character_flag = converted_religion
		}
		had_global_flag = { flag = EMF days = 1825 }
	}
	
	major_trigger = {
		OR = {
			character = ROOT
			same_realm = ROOT
		}
	}
	
	mean_time_to_happen = {
		days = 3
	}

	immediate = {
		set_global_flag = constantines_return
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2102 #End the worship of icons
		trigger = { has_landed_title = e_byzantium }
		ai_chance = {
			factor = 30
			modifier = {
				factor = 0
				NOR = {
					trait = craven
					trait = cynical
					trait = lunatic
					trait = possessed
					is_dumb_trigger = yes
				}
			}
			modifier = {
				factor = 0
				OR = {
					trait = zealous
					trait = brave
				}
			}
			modifier = {
				factor = 2
				OR = {
					trait = lunatic
					trait = possessed
				}
			}
			modifier = {
				factor = 1.5
				trait = cynical
			}
			modifier = {
				factor = 0.75
				year = 950
			}
			modifier = {
				factor = 0.75
				year = 1000
			}
			modifier = {
				factor = 0.5
				year = 1100
			}
		}
		set_character_flag = renounced_iconoclasm
		set_character_flag = converted_religion
		if = {
			limit = { higher_tier_than = BARON }
			religion_authority = {
				modifier = ruler_converted_from
			}
		}
		religion = iconoclast
		if = {
			limit = { higher_tier_than = BARON }
			hidden_tooltip = {
				religion_authority = {
					modifier = ruler_converted_to
				}
			}
		}
		add_trait = zealous
		if = {
			limit = { NOT = { is_title_active = d_iconoclast } }
			activate_title = { title = d_iconoclast status = yes }
		}
		hidden_tooltip = {
			if = {
				limit = {
					any_vassal = { has_landed_title = k_orthodox }
				}
				k_orthodox = {
					holder_scope = {
						d_iconoclast = { grant_title = PREV }
						unsafe_destroy_landed_title = PREV
						unsafe_religion = iconoclast  # Use this effect with care
						set_defacto_liege = ROOT
						pf_liege_change_effect = yes
					}
				}
			}
			any_realm_province = {
				limit = { religion = iconoclast }
				add_province_modifier = {
					name = appeased_religious
					months = 60
				}
			}
			hidden_tooltip = {
				any_realm_character = {
					limit = {
						NOT = { character = ROOT }
						NOT = { has_landed_title = d_iconoclast }
					}
					character_event = { id = emf_heresy.2103 days = 1 }
				}
			}
		}
		capital_scope = {
			ROOT = {
				spawn_unit = {
					province = PREV
					home = PREV
					owner = THIS
					troops = {
						light_infantry = { 1426 1426 }
						heavy_infantry = { 275 275 }
						archers = { 425 425 }
					}
					attrition = 1.0
					maintenance_multiplier = 0
					cannot_inherit = yes
				}
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2102 #That is not why we are losing
		trigger = { has_landed_title = e_byzantium }
		ai_chance = {
			factor = 70
		}
		piety = -100
		prestige = -250
	}
	option = {
		name = EVTOPTC_emf_heresy_2102 #That does not bode well...
		trigger = {
			NOT = { has_landed_title = e_byzantium }
		}
	}
}

# Byzantine subjects respond to the emperor's embracing of iconoclasm heresy
character_event = {
	id = emf_heresy.2103
	desc = EVTDESC_emf_heresy_2103
	picture = GFX_evt_icon
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	trigger = { prisoner = no }
	
	option = {
		name = EVTOPTA_emf_heresy_2103 #Agree
		trigger = {
			religion_group = christian
			NOT = { religion = iconoclast }
			can_change_religion = yes
		}
		ai_chance = {
			factor = 3
			modifier = {
				factor = 2
				trait = cynical
			}
			modifier = {
				factor = 0.1
				NOT = { religion = orthodox }
			}
		}
		if = {
			limit = { higher_tier_than = BARON }
			religion_authority = {
				modifier = ruler_converted_from
			}
		}
		religion = iconoclast
		set_character_flag = converted_religion	
		if = {
			limit = { higher_tier_than = BARON }
			hidden_tooltip = {
				religion_authority = {
					modifier = ruler_converted_to
				}
			}
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2103 #Refuse
		trigger = {
			religion_group = christian
			NOT = { religion = iconoclast }
			can_change_religion = yes
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 10
				trait = zealous
			}
			modifier = {
				factor = 3
				OR = {
					is_priest = yes
					capital_holding = { holding_type = temple }
				}
			}
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_2103
		trigger = { religion = iconoclast }
	}
	option = {
		name = EVTOPTB_emf_heresy_2103
		trigger = {
			religion_group = christian
			NOT = { religion = iconoclast }
			can_change_religion = no
		}
	}
	option = {
		name = EVTOPTD_emf_heresy_2103
		trigger = { NOT = { religion_group = christian } }
	}
}

#######################################
# PAULICIAN EVENTS
#######################################

# Paulicians spread in the Byzantine Empire due to effective patriarch
narrative_event = {
	id = emf_heresy.2105
	title = EVTNAME_emf_heresy_2105
	desc = EVTDESC_emf_heresy_2105
	picture = GFX_evt_heretic
	border = GFX_event_narrative_frame_religion

	major = yes
	
	only_playable = yes
	min_age = 16
	capable_only = yes
	prisoner = no
	religion = paulician
	
	trigger = {
		has_landed_title = d_paulician
		war = no
		year = 800
		NOT = { has_global_flag = sergius_tychus }
		calc_true_if = {
			amount = 2
			diplomacy = 10
			diplomacy = 15
			trait = zealous
		}
		e_byzantium = {
			holder_scope = {
				religion = orthodox
				war = no
				NOT = { religion_authority = 0.8 }
				any_realm_province = {
					OR = {
						province_id = 706
						AND = {
							culture = armenian
							OR = {
								religion = orthodox
								religion = iconoclast
							}
						}
					}
				}
			}
		}
	}
	
	major_trigger = {
		OR = {
			has_landed_title = e_byzantium
			has_landed_title = d_paulician
			any_liege = { has_landed_title = e_byzantium }
			any_liege = { has_landed_title = d_paulician }
			religion = orthodox
			religion = iconoclast
			religion = paulician
		}
	}
	
	mean_time_to_happen = {
		months = 1
		modifier = {
			factor = 0.1
			diplomacy = 15
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2105
		trigger = { has_landed_title = e_byzantium }
		set_global_flag = sergius_tychus
		piety = -100
		any_realm_province = {
			limit = {
				OR = {
					province_id = 706
					AND = {
						culture = armenian
						OR = {
							religion = orthodox
							religion = iconoclast
						}
					}
				}
			}
			religion = paulician
		}
		hidden_tooltip = {
			random_realm_province = {
				limit = {
					OR = {
						culture = armenian
						province_id = 706
					}
					religion = paulician
				}
				add_province_modifier = {
					name = heretic_stronghold
					duration = 3650
				}
			}
		}
	}
	option = {
		name = I_SEE
		trigger = {
			NOT = { has_landed_title = e_byzantium }
			NOT = { has_landed_title = d_paulician }
		}
	}
	option = {
		name = OK
		trigger = { has_landed_title = d_paulician }
		piety = 500
		add_trait = zealous
		add_trait = ambitious
		change_diplomacy = 5
		religion_authority = {
			modifier = sergius_tychus
			years = 30
		}
	}
}

# Byzantine Emperor persecutes the Paulicians
character_event = {
	id = emf_heresy.2106
	desc = EVTDESC_emf_heresy_2106
	picture = GFX_evt_burning_house
	
	is_triggered_only = yes
	major = yes
	
	major_trigger = {
		OR = {
			has_landed_title = e_byzantium
			has_landed_title = d_paulician
			any_liege = { has_landed_title = e_byzantium }
			religion = orthodox
			religion = paulician
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2106 #Hopefully that will take care of it
		trigger = { has_landed_title = e_byzantium }
	}
	option = {
		name = EVTOPTB_emf_heresy_2106 #A rather extreme measure...
		trigger = {
			any_liege = { has_landed_title = e_byzantium }
			NOT = { religion = paulician }
		}
		any_courtier = {
			limit = {
				is_ruler = no
				is_adult = yes
				prisoner = no
				religion = paulician
			}
			banish = yes
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_2106 #This is an outrage!
		trigger = {
			any_liege = { has_landed_title = e_byzantium }
			religion = paulician
		}
		opinion = { who = ROOT modifier = opinion_outraged years = 20 }
		reverse_opinion = { who = ROOT modifier = mad_heretic years = 20 }
	}
	option = {
		name = EVTOPTC_emf_heresy_2106 #This is an outrage!
		trigger = { has_landed_title = d_paulician }
		opinion = { who = ROOT modifier = opinion_outraged years = 20 }
		reverse_opinion = { who = ROOT modifier = mad_heretic years = 20 }
		add_rival = ROOT
	}
	option = {
		name = I_SEE
		trigger = {
			NOR = {
				has_landed_title = e_byzantium
				has_landed_title = d_paulician
				any_liege = { has_landed_title = e_byzantium }
			}
		}
	}
}

# Paulician Patriarch appears
narrative_event = {
	id = emf_heresy.2107
	title = EVTNAME_emf_heresy_2107
	desc = EVTDESC_emf_heresy_2107
	picture = GFX_evt_heretic
	border = GFX_event_narrative_frame_religion

	major = yes
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2107
		trigger = { religion = paulician }
	}
	option = {
		name = EVTOPTB_emf_heresy_2107
		trigger = {
			religion_group = christian
			NOT = { religion = paulician }
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_2107
		trigger = {
			NOT = { religion_group = christian }
		}
	}
}

#######################################
# BOGOMILIST EVENTS
#######################################

# Bogomil appears in Tyrnovo
narrative_event = {
	id = emf_heresy.2110
	title = EVTNAME_emf_heresy_2110
	desc = EVTDESC_emf_heresy_2110
	picture = GFX_evt_heretic
	border = GFX_event_narrative_frame_religion
	
	only_independent = yes
	religion_group = christian
	major = yes
	
	trigger = {
		year = 950
		higher_real_tier_than = DUKE
		any_realm_province = {
			OR = {
				AND = {
					emf_swmh_trigger = yes
					province_id = 493
				}
				AND = {
					emf_swmh_trigger = no
					province_id = 499
				}
			}
			OR = {
				religion = paulician
				religion = orthodox
				religion = iconoclast
				religion = monothelite
			}
			NOR = {
				culture = greek
				has_province_modifier = heretic_stronghold
			}
		}
		NOR = {
			religion = bogomilist
			has_global_flag = bogomilist_activated
		}
	}
	
	major_trigger = {
		OR = {
			same_realm = ROOT
			religion = bogomilist
			religion = orthodox
			religion = iconoclast
			religion = monothelite
			religion = paulician
			capital_scope = {
				NOT = {
					distance = {
						where = event_target:bogomil_origin
						value = 600	# Same part of the world
					}
				}
			}
		}
	}
	
	mean_time_to_happen = {
		years = 10
	}
	
	immediate = {
		set_global_flag = bogomilist_activated
		ROOT = {
			religion_authority = { modifier = bogomilism_spreading }
			random_realm_province = {
				limit = {
					OR = {
						AND = {
							emf_swmh_trigger = yes
							province_id = 493
						}
						AND = {
							emf_swmh_trigger = no
							province_id = 499
						}
					}
					OR = {
						religion = paulician
						religion = orthodox
						religion = iconoclast
						religion = monothelite
					}
					NOR = {
						culture = greek
						has_province_modifier = heretic_stronghold
					}
				}
				save_event_target_as = bogomil_origin
				religion = bogomilist
				add_province_modifier = {
					name = heretic_stronghold
					duration = 3650
				}
				owner = {
					create_character = {
						name = "Bogomil"
						random_traits = yes
						dynasty = none
						religion = bogomilist
						culture = PREV
						female = no
						age = 40
						trait = mastermind_theologian
						trait = possessed
						trait = zealous
						trait = gregarious
						trait = heresiarch
						trait = scholar
						trait = perfecti
						attributes = {
							learning = 12
							diplomacy = 10
						}
					}
					new_character = {
						religion_authority = { modifier = bogomil_appears }
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2110 #Convert
		trigger = {
			character = ROOT
			controls_religion = no
			NOT = { rightful_religious_head = ROOT }
			mercenary = no
			holy_order = no
			prisoner = no
			is_adult = yes
			OR = {
				religion = orthodox
				religion = iconoclast
				religion = monothelite
			}
			NOR = {
				trait = zealous
				trait = incapable
				culture = greek
				has_character_flag = converted_religion
			}
		}
		capital_scope = {
			if = {
				limit = {
					NOT = { has_province_modifier = heretic_stronghold }
					any_neighbor_province = { religion = bogomilist }
					religion = ROOT
				}
			}
			religion = bogomilist
		}
		random_realm_province = {
			limit = {
				NOT = { has_province_modifier = heretic_stronghold }
				any_neighbor_province = { religion = bogomilist }
				religion = ROOT
			}
			religion = bogomilist
		}
		random_realm_province = {
			limit = {
				NOT = { has_province_modifier = heretic_stronghold }
				any_neighbor_province = { religion = bogomilist }
				religion = ROOT
			}
			religion = bogomilist
		}
		religion_authority = { modifier = ruler_converted_from }
		religion = bogomilist
		religion_authority = { modifier = ruler_converted_to }
		hidden_tooltip = {
			e_byzantium = {
				holder_scope = {
					if = {
						limit = {
							OR = {
								religion = orthodox
								religion = iconoclast
								religion = monothelite
							}
							NOR = {
								character = ROOT
								trait = cynical
								any_claim = {
									is_primary_holder_title = yes
									holder = ROOT
								}
							}
						}
						ROOT = {
							primary_title = {
								add_claim = PREVPREV
							}
						}
					}
				}
			}
			any_courtier = {
				limit = {
					is_adult = no
					is_ruler = no
					dynasty = ROOT
					NOT = { religion = bogomilist }
				}
				religion = ROOT
			}
			primary_title = { add_law = bogomilist_church_0 }
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2110 #Don't Convert
		trigger = {
			character = ROOT
		}
	}
	option = {
		name = EVTOPTC_emf_heresy_2110
		trigger = {
			NOT = { character = ROOT }
			religion = bogomilist
		}
	}
	option = {
		name = EVTOPTD_emf_heresy_2110
		trigger = {
			NOT = { character = ROOT }
			NOT = { religion = bogomilist }
			religion_group = christian
		}
	}
	option = {
		name = I_SEE
		trigger = {
			NOT = { character = ROOT }
			NOT = { religion_group = christian }
		}
	}
}

# Initialization event for Bogomilist laws
character_event = {
	id = emf_heresy.2111
	hide_window = yes
	
	religion = bogomilist
	only_playable = yes
	
	mean_time_to_happen = {
		days = 1
	}
	
	trigger = {
		higher_tier_than = BARON
		OR = {
			AND = {
				is_title_active = d_bogomilist
				primary_title = { NOT = { has_law = bogomilist_church_4 } }
			}
			AND = {
				d_bogomilist = { has_title_flag = bogomilist_formalized }
				primary_title = {
					NOR = { 
						has_law = bogomilist_church_3
						has_law = bogomilist_church_4
					}
				}
			}
			AND = {
				d_bogomilist = { has_title_flag = bogomilist_organized }
				primary_title = {
					NOR = {
						has_law = bogomilist_church_2
						has_law = bogomilist_church_3
						has_law = bogomilist_church_4
					}
				}
			}
			AND = {
				any_demesne_title = { has_law = bogomilist_church_1 }
				primary_title = { has_law = bogomilist_church_0 }
			}
			AND = {
				any_liege = { has_law = bogomilist_church_1 }
				primary_title = { has_law = bogomilist_church_0 }
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				is_title_active = d_bogomilist
				primary_title = { NOT = { has_law = bogomilist_church_4 } }
			}
			primary_title = { add_law = bogomilist_church_4 }
			break = yes
		}
		if = {
			limit = {
				d_bogomilist = { has_title_flag = bogomilist_formalized }
				primary_title = {
					NOR = { 
						has_law = bogomilist_church_3
						has_law = bogomilist_church_4
					}
				}
			}
			primary_title = { add_law = bogomilist_church_3 }
			break = yes
		}
		if = {
			limit = {
				d_bogomilist = { has_title_flag = bogomilist_organized }
				primary_title = {
					NOR = {
						has_law = bogomilist_church_2
						has_law = bogomilist_church_3
						has_law = bogomilist_church_4
					}
				}
			}
			primary_title = { add_law = bogomilist_church_2 }
			break = yes
		}
		if = {
			limit = {
				any_demesne_title = { has_law = bogomilist_church_1 }
				primary_title = { has_law = bogomilist_church_0 }
			}
			primary_title = { add_law = bogomilist_church_1 }
			break = yes
		}
		if = {
			limit = {
				any_liege = { has_law = bogomilist_church_1 }
				primary_title = { has_law = bogomilist_church_0 }
			}
			primary_title = { add_law = bogomilist_church_1 }
			break = yes
		}
	}
}

# Formalization of Bogomilism begins
character_event = {
	id = emf_heresy.2112
	desc = EVTDESC_emf_heresy_2112
	picture = GFX_evt_monastery_monks
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2112
		custom_tooltip = {
			text = BOGO_BEGIN_FORMALIZATION
			hidden_tooltip = {
				d_bogomilist = { change_variable = { which = "bogomil_formalization" value = 1 } }
			}
		}
	}
}

# Formalization of Bogomilism ends
character_event = {
	id = emf_heresy.2113
	picture = GFX_evt_monastery_monks
	border = GFX_event_normal_frame_religion
	
	desc = {
		text = EVTDESC_emf_heresy_2113_religion
		trigger = { NOT = { religion = bogomilist } }
	}
	desc = {
		text = EVTDESC_emf_heresy_2113_rule
		trigger = { religion = bogomilist }
	}
	
	trigger = {
		has_character_modifier = formalizing_bogomilist
		OR = {
			NOT = { religion = bogomilist }
			is_ruler = no
			lower_tier_than = KING
		}
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	option = {
		name = OK
		remove_character_modifier = formalizing_bogomilist
	}
}

# Formalization: Support Common Liturgy
character_event = {
	id = emf_heresy.2114
	desc = EVTDESC_emf_heresy_2114
	picture = GFX_evt_monastery_monks
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	religion = bogomilist
	major = yes
	
	trigger = {
		religion = bogomilist
		higher_tier_than = DUKE
		has_character_modifier = formalizing_bogomilist
		d_bogomilist = {
			NOT = { is_variable_equal = { which = "bogomil_formalization" value = 4 } }
			NOT = { has_title_flag = common_liturgy }
		}
	}
	
	major_trigger = {
		religion = bogomilist
	}
	
	option = {
		name = EXCELLENT
		trigger = { character = ROOT }
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 3 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION4 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 2 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION3 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 1 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION2 }
		}		
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 0 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION1 }
		}
		if = {
			limit = { d_bogomilist = { NOT = { check_variable = { which = "bogomil_formalization" value = -0.5 } } } }
			custom_tooltip = { text = BOGO_FORMALIZATION0 }
		}
		hidden_tooltip = {
			d_bogomilist = {
				change_variable = { which = "bogomil_formalization" value = 1 }
				set_title_flag = common_liturgy
			}
		}
		piety = 50
	}
	option = {
		name = I_SEE
		trigger = { NOT = { character = ROOT } }
	}
}

# Formalization: Canonicalize Bible
character_event = {
	id = emf_heresy.2115
	desc = EVTDESC_emf_heresy_2115
	picture = GFX_evt_book_carolingian_script
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	religion = bogomilist
	major = yes
	
	trigger = {
		religion = bogomilist
		higher_tier_than = DUKE
		has_character_modifier = formalizing_bogomilist
		d_bogomilist = {
			NOT = { is_variable_equal = { which = "bogomil_formalization" value = 4 } }
			NOT = { has_title_flag = bible_canon }
		}
	}
	
	major_trigger = {
		religion = bogomilist
	}
	
	option = {
		name = EXCELLENT
		trigger = { character = ROOT }
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 3 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION4 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 2 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION3 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 1 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION2 }
		}		
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 0 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION1 }
		}
		if = {
			limit = { d_bogomilist = { NOT = { check_variable = { which = "bogomil_formalization" value = -0.5 } } } }
			custom_tooltip = { text = BOGO_FORMALIZATION0 }
		}
		hidden_tooltip = {
			d_bogomilist = {
				change_variable = { which = "bogomil_formalization" value = 1 }
				set_title_flag = bible_canon
			}
		}
		piety = 100
		prestige = 100
		change_learning = 1
		set_dynasty_flag = bogomil_canon_bible
	}
	option = {
		name = I_SEE
		trigger = { NOT = { character = ROOT } }
	}
}

# Formalization: Church Councils
character_event = {
	id = emf_heresy.2116
	desc = EVTDESC_emf_heresy_2116
	picture = GFX_evt_monastery_monks
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	religion = bogomilist
	
	trigger = {
		religion = bogomilist
		higher_tier_than = DUKE
		has_character_modifier = formalizing_bogomilist
		scaled_wealth = 1.0
		d_bogomilist = {
			NOT = { is_variable_equal = { which = "bogomil_formalization" value = 4 } }
			NOT = { has_title_flag = church_councils }
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2116
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 3 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION4 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 2 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION3 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 1 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION2 }
		}		
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 0 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION1 }
		}
		if = {
			limit = { d_bogomilist = { NOT = { check_variable = { which = "bogomil_formalization" value = -0.5 } } } }
			custom_tooltip = { text = BOGO_FORMALIZATION0 }
		}
		hidden_tooltip = {
			d_bogomilist = {
				change_variable = { which = "bogomil_formalization" value = 1 }
				set_title_flag = church_councils
			}
		}
		scaled_wealth = -1.0
		piety = 100
		hidden_tooltip = {
			character_event = { id = emf_heresy.2117 }
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2116
		prestige = -50
	}
}

character_event = {
	id = emf_heresy.2117
	desc = EVTDESC_emf_heresy_2117
	picture = GFX_evt_monastery_monks
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	major = yes
	
	major_trigger = {
		religion = bogomilist
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2117
	}
}

# Formalization: Seminary Schools
character_event = {
	id = emf_heresy.2118
	desc = EVTDESC_emf_heresy_2118
	picture = GFX_evt_monastery_monks
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	religion = bogomilist
	
	trigger = {
		religion = bogomilist
		higher_tier_than = DUKE
		has_character_modifier = formalizing_bogomilist
		scaled_wealth = 0.5
		d_bogomilist = {
			NOT = { is_variable_equal = { which = "bogomil_formalization" value = 4 } }
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2118
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 3 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION4 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 2 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION3 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 1 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION2 }
		}		
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 0 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION1 }
		}
		if = {
			limit = { d_bogomilist = { NOT = { check_variable = { which = "bogomil_formalization" value = -0.5 } } } }
			custom_tooltip = { text = BOGO_FORMALIZATION0 }
		}
		hidden_tooltip = {
			d_bogomilist = {
				change_variable = { which = "bogomil_formalization" value = 1 }
			}
		}
		scaled_wealth = -0.5
		piety = 50
		hidden_tooltip = {
			character_event = { id = emf_heresy.2119 }
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2118
		piety = -50
	}
}

character_event = {
	id = emf_heresy.2119
	desc = EVTDESC_emf_heresy_2119
	picture = GFX_evt_monastery_monks
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	major = yes
	
	major_trigger = {
		religion = bogomilist
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2117
	}
}

# Formalization: Endorsed by Priest
character_event = {
	id = emf_heresy.2120
	desc = EVTDESC_emf_heresy_2120
	picture = GFX_evt_heretic
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	religion = bogomilist
	major = yes
	
	trigger = {
		religion = bogomilist
		higher_tier_than = DUKE
		has_character_modifier = formalizing_bogomilist
		piety = 100
		d_bogomilist = {
			NOT = { is_variable_equal = { which = "bogomil_formalization" value = 4 } }
		}
	}
	
	major_trigger = {
		religion = bogomilist
	}
	
	option = {
		name = EXCELLENT
		trigger = { character = ROOT }
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 3 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION4 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 2 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION3 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 1 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION2 }
		}		
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 0 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION1 }
		}
		if = {
			limit = { d_bogomilist = { NOT = { check_variable = { which = "bogomil_formalization" value = -0.5 } } } }
			custom_tooltip = { text = BOGO_FORMALIZATION0 }
		}
		hidden_tooltip = {
			d_bogomilist = {
				change_variable = { which = "bogomil_formalization" value = 1 }
			}
		}
		piety = 25
		prestige = 25
	}
	option = {
		name = I_SEE
		trigger = { NOT = { character = ROOT } }
	}
}

# Formalization: Public Speech
character_event = {
	id = emf_heresy.2121
	desc = EVTDESC_emf_heresy_2121
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	religion = bogomilist
	major = yes
	
	trigger = {
		religion = bogomilist
		higher_tier_than = DUKE
		has_character_modifier = formalizing_bogomilist
		diplomacy = 12
		has_regent = no
		d_bogomilist = {
			NOT = { is_variable_equal = { which = "bogomil_formalization" value = 4 } }
		}
	}
	
	major_trigger = {
		religion = bogomilist
	}
	
	option = {
		name = EXCELLENT
		trigger = { character = ROOT }
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 3 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION4 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 2 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION3 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 1 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION2 }
		}		
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 0 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION1 }
		}
		if = {
			limit = { d_bogomilist = { NOT = { check_variable = { which = "bogomil_formalization" value = -0.5 } } } }
			custom_tooltip = { text = BOGO_FORMALIZATION0 }
		}
		hidden_tooltip = {
			d_bogomilist = {
				change_variable = { which = "bogomil_formalization" value = 1 }
			}
		}
		piety = 25
		prestige = 25
	}
	option = {
		name = I_SEE
		trigger = { NOT = { character = ROOT } }
	}
}

# Formalization: Ruler Writes Text
character_event = {
	id = emf_heresy.2122
	desc = EVTDESC_emf_heresy_2122
	picture = GFX_evt_book_carolingian_script
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	religion = bogomilist
	major = yes
	
	trigger = {
		religion = bogomilist
		higher_tier_than = DUKE
		has_character_modifier = formalizing_bogomilist
		learning = 12
		NOT = { trait = blinded }
		has_regent = no
		d_bogomilist = {
			NOT = { is_variable_equal = { which = "bogomil_formalization" value = 4 } }
		}
	}
	
	major_trigger = {
		religion = bogomilist
	}
	
	option = {
		name = EXCELLENT
		trigger = { character = ROOT }
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 3 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION4 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 2 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION3 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 1 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION2 }
		}		
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 0 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION1 }
		}
		if = {
			limit = { d_bogomilist = { NOT = { check_variable = { which = "bogomil_formalization" value = -0.5 } } } }
			custom_tooltip = { text = BOGO_FORMALIZATION0 }
		}
		hidden_tooltip = {
			d_bogomilist = {
				change_variable = { which = "bogomil_formalization" value = 1 }
			}
		}
		piety = 25
		prestige = 25
	}
	option = {
		name = I_SEE
		trigger = { NOT = { character = ROOT } }
	}
}

# Formalization: Troublemaker Sect
character_event = {
	id = emf_heresy.2123
	desc = EVTDESC_emf_heresy_2123
	picture = GFX_evt_monastery_monks
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	religion = bogomilist
	
	trigger = {
		religion = bogomilist
		higher_tier_than = DUKE
		has_character_modifier = formalizing_bogomilist
		d_bogomilist = {
			NOT = { is_variable_equal = { which = "bogomil_formalization" value = 4 } }
			check_variable = { which = "bogomil_formalization" value = 0.5 }
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2123
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 3 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION2 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 2 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION1 }
		}
		if = {
			limit = { d_bogomilist = { NOT = { check_variable = { which = "bogomil_formalization" value = 1.5 } } } }
			custom_tooltip = { text = BOGO_FORMALIZATION0 }
		}
		hidden_tooltip = {
			d_bogomilist = {
				change_variable = { which = "bogomil_formalization" value = -1 }
			}
		}
		piety = 50
	}
	option = {
		name = EVTOPTB_emf_heresy_2123
		prestige = -100
		piety = -100
	}
}

# Formalization: Traditionalist Revival
character_event = {
	id = emf_heresy.2124
	desc = EVTDESC_emf_heresy_2124
	picture = GFX_evt_heretic
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	religion = bogomilist
	
	trigger = {
		religion = bogomilist
		higher_tier_than = DUKE
		has_character_modifier = formalizing_bogomilist
		d_bogomilist = {
			NOT = { is_variable_equal = { which = "bogomil_formalization" value = 4 } }
			check_variable = { which = "bogomil_formalization" value = 0.5 }
		}
	}
	
	option = {
		name = CURSES
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 3 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION2 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 2 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION1 }
		}
		if = {
			limit = { d_bogomilist = { NOT = { check_variable = { which = "bogomil_formalization" value = 1.5 } } } }
			custom_tooltip = { text = BOGO_FORMALIZATION0 }
		}
		hidden_tooltip = {
			d_bogomilist = {
				change_variable = { which = "bogomil_formalization" value = -1 }
			}
		}
		prestige = -50
	}
}

# Formalization: Demand For Reversal
character_event = {
	id = emf_heresy.2125
	desc = EVTDESC_emf_heresy_2125
	picture = GFX_evt_heretic
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	religion = bogomilist
	
	trigger = {
		religion = bogomilist
		higher_tier_than = DUKE
		has_character_modifier = formalizing_bogomilist
		any_realm_province = {
			religion = bogomilist
			NOT = { has_province_modifier = religious_unrest }
		}
		d_bogomilist = {
			NOT = { is_variable_equal = { which = "bogomil_formalization" value = 4 } }
			check_variable = { which = "bogomil_formalization" value = 1.5 }
		}
	}
	
	immediate = {
		random_realm_province = {
			limit = {
				religion = bogomilist
				NOT = { has_province_modifier = religious_unrest }
			}
			save_event_target_as = demand_province
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2125
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 3 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION2 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 2 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION1 }
		}
		if = {
			limit = { d_bogomilist = { NOT = { check_variable = { which = "bogomil_formalization" value = 1.5 } } } }
			custom_tooltip = { text = BOGO_FORMALIZATION0 }
		}
		hidden_tooltip = {
			d_bogomilist = {
				change_variable = { which = "bogomil_formalization" value = -1 }
			}
		}
		prestige = -100
	}
	option = {
		name = EVTOPTB_emf_heresy_2125
		event_target:demand_province = {
			add_province_modifier = {
				name = religious_unrest
				duration = 1095
			}
		}
	}
}

# Formalization: Blamed by Priest
character_event = {
	id = emf_heresy.2126
	desc = EVTDESC_emf_heresy_2126
	picture = GFX_evt_heretic
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	religion = bogomilist
	major = yes
	
	trigger = {
		religion = bogomilist
		higher_tier_than = DUKE
		has_character_modifier = formalizing_bogomilist
		NOT = { piety = 100 }
		d_bogomilist = {
			NOT = { is_variable_equal = { which = "bogomil_formalization" value = 4 } }
		}
	}
	
	major_trigger = {
		religion = bogomilist
	}
	
	option = {
		name = CURSES
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 3 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION2 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 2 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION1 }
		}
		if = {
			limit = { d_bogomilist = { NOT = { check_variable = { which = "bogomil_formalization" value = 1.5 } } } }
			custom_tooltip = { text = BOGO_FORMALIZATION0 }
		}
		hidden_tooltip = {
			d_bogomilist = {
				change_variable = { which = "bogomil_formalization" value = -1 }
			}
		}
		prestige = -50
	}
}

# Formalization: Learned Priest Objects
character_event = {
	id = emf_heresy.2127
	desc = EVTDESC_emf_heresy_2127
	picture = GFX_evt_heretic
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	religion = bogomilist
	major = yes
	
	trigger = {
		religion = bogomilist
		higher_tier_than = DUKE
		has_character_modifier = formalizing_bogomilist
		NOT = { learning = 12 }
		d_bogomilist = {
			NOT = { is_variable_equal = { which = "bogomil_formalization" value = 4 } }
		}
	}
	
	major_trigger = {
		religion = bogomilist
	}
	
	option = {
		name = CURSES
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 3 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION2 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 2 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION1 }
		}
		if = {
			limit = { d_bogomilist = { NOT = { check_variable = { which = "bogomil_formalization" value = 1.5 } } } }
			custom_tooltip = { text = BOGO_FORMALIZATION0 }
		}
		hidden_tooltip = {
			d_bogomilist = {
				change_variable = { which = "bogomil_formalization" value = -1 }
			}
		}
		prestige = -50
		piety = -25
	}
}

# Formalization: Major Battle Won
character_event = {
	id = emf_heresy.2128
	desc = EVTDESC_emf_heresy_2128
	picture = GFX_evt_battle
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	religion = bogomilist
	major = yes
	
	trigger = {
		OR = {
			AND = {
				religion = bogomilist
				higher_tier_than = DUKE
				has_character_modifier = formalizing_bogomilist
			}
			any_liege = {
				religion = bogomilist
				higher_tier_than = DUKE
				has_character_modifier = formalizing_bogomilist
			}
		}
		OR = {
			any_war = {
				OR = {
					using_cb = crusade
					using_cb = religious
					using_cb = religious_revolt
					using_cb = emf_religious_reconquest
				}
			}
			any_liege = {
				any_war = {
					OR = {
						using_cb = crusade
						using_cb = religious
						using_cb = religious_revolt
						using_cb = emf_religious_reconquest
					}
				}
			}
		}
		d_bogomilist = {
			NOT = { is_variable_equal = { which = "bogomil_formalization" value = 4 } }
		}
	}
	
	major_trigger = {
		religion = bogomilist
	}
	
	option = {
		name = EXCELLENT
		trigger = {
			OR = {
				character = ROOT
				same_realm = ROOT
			}
			has_character_modifier = formalizing_bogomilist
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 3 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION4 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 2 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION3 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 1 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION2 }
		}		
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 0 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION1 }
		}
		if = {
			limit = { d_bogomilist = { NOT = { check_variable = { which = "bogomil_formalization" value = -0.5 } } } }
			custom_tooltip = { text = BOGO_FORMALIZATION0 }
		}
		hidden_tooltip = {
			d_bogomilist = {
				change_variable = { which = "bogomil_formalization" value = 1 }
			}
		}
		piety = 50
	}
	option = {
		name = I_SEE
		trigger = {
			OR = {
				NOT = { has_character_modifier = formalizing_bogomilist }
				NOR = {
					character = ROOT
					same_realm = ROOT
				}
			}
		}
	}
}

# Formalization: Major Battle Lost
character_event = {
	id = emf_heresy.2129
	desc = EVTDESC_emf_heresy_2129
	picture = GFX_evt_battle
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	religion = bogomilist
	major = yes
	
	trigger = {
		OR = {
			AND = {
				religion = bogomilist
				higher_tier_than = DUKE
				has_character_modifier = formalizing_bogomilist
			}
			any_liege = {
				religion = bogomilist
				higher_tier_than = DUKE
				has_character_modifier = formalizing_bogomilist
			}
		}
		OR = {
			any_war = {
				OR = {
					using_cb = crusade
					using_cb = religious
					using_cb = religious_revolt
					using_cb = emf_religious_reconquest
				}
			}
			any_liege = {
				any_war = {
					OR = {
						using_cb = crusade
						using_cb = religious
						using_cb = religious_revolt
						using_cb = emf_religious_reconquest
					}
				}
			}
		}
		d_bogomilist = {
			NOT = { is_variable_equal = { which = "bogomil_formalization" value = 4 } }
		}
	}
	
	major_trigger = {
		religion = bogomilist
	}
	
	option = {
		name = CURSES
		trigger = {
			OR = {
				character = ROOT
				same_realm = ROOT
			}
			has_character_modifier = formalizing_bogomilist
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 3 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION2 }
		}
		if = {
			limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 2 } } }
			custom_tooltip = { text = BOGO_FORMALIZATION1 }
		}
		if = {
			limit = { d_bogomilist = { NOT = { check_variable = { which = "bogomil_formalization" value = 1.5 } } } }
			custom_tooltip = { text = BOGO_FORMALIZATION0 }
		}
		hidden_tooltip = {
			d_bogomilist = {
				change_variable = { which = "bogomil_formalization" value = -1 }
			}
		}
		piety = 50
	}
	option = {
		name = I_SEE
		trigger = {
			OR = {
				NOT = { has_character_modifier = formalizing_bogomilist }
				NOR = {
					character = ROOT
					same_realm = ROOT
				}
			}
		}
	}
}
		
# Bogomilist Faith Organized
narrative_event = {
	id = emf_heresy.2130
	title = EVTNAME_emf_heresy_2130
	desc = EVTDESC_emf_heresy_2130
	picture = GFX_evt_monastery_monks
	border = GFX_event_narrative_frame_religion
	
	is_triggered_only = yes
	major = yes
	
	major_trigger = {
		religion = bogomilist
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2130
		trigger = { character = ROOT }
	}
	option = {
		name = I_SEE
		trigger = { NOT = { character = ROOT } }
		tooltip = { religion_authority = { modifier = bogomilism_organized } }
		if = {
			limit = {
				primary_title = { NOT = { has_law = bogomilist_church_2 } }
			}
			primary_title = { add_law = bogomilist_church_2 }
		}
		if = {
			limit = { ai = yes }
			random_list = {
				25 = {
					modifier = {
						factor = 0
						ROOT = { is_heretic = yes }
					}
					modifier = {
						factor = 0
						OR = {
							trait = zealous
							trait = perfecti
							trait = incapable
							is_adult = no
							prisoner = yes
							can_change_religion = no
						}
					}
					emf_character_become_heretic_effect = yes
				}
				25 = {
					modifier = {
						factor = 0
						ROOT = { is_heretic = no }
					}
					modifier = {
						factor = 0
						OR = {
							trait = zealous
							trait = perfecti
							trait = incapable
							is_adult = no
							prisoner = yes
							can_change_religion = no
						}
					}
					abandon_heresy = yes
				}
				50 = {
					modifier = {
						factor = 0.5
						trait = cynical
					}
					modifier = {
						factor = 0.5
						trait = wroth
					}
					modifier = {
						factor = 2
						trait = patient
					}
					modifier = {
						factor = 2
						is_priest = yes
					}
				}
			}	
		}
		random_demesne_province = {
			limit = {
				religion = bogomilist
				NOT = { has_province_modifier = religious_unrest }
			}
			random_list = {
				50 = {
					add_province_modifier = {
						name = religious_unrest
						duration = 730
					}
				}
				25 = {
					modifier = {
						factor = 0
						ROOT = { is_heretic = yes }
					}
					emf_province_become_heretic_effect = yes
					add_province_modifier = {
						name = religious_unrest
						duration = 730
					}
				}
				25 = {
					modifier = {
						factor = 0
						ROOT = { is_heretic = no }
					}
					abandon_heresy = yes
					add_province_modifier = {
						name = religious_unrest
						duration = 730
					}
				}
				75 = {}
			}
		}
	}
}

# Bogomilist Faith Formalized by force
narrative_event = {
	id = emf_heresy.2131
	title = EVTNAME_emf_heresy_2131
	desc = EVTDESC_emf_heresy_2131
	picture = GFX_evt_monastery_monks
	border = GFX_event_narrative_frame_religion
	
	is_triggered_only = yes
	major = yes
	
	major_trigger = {
		religion = bogomilist
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2131
		trigger = { character = ROOT }
	}
	option = {
		name = EVTOPTB_emf_heresy_2131
		trigger = { NOT = { character = ROOT } }
		tooltip = { religion_authority = { modifier = bogomilism_formalized } }
		if = {
			limit = {
				primary_title = { NOT = { has_law = bogomilist_church_3 } }
			}
			primary_title = { add_law = bogomilist_church_3 }
		}
		if = {
			limit = { ai = yes }
			random_list = {
				50 = {
					modifier = {
						factor = 0
						ROOT = { is_heretic = yes }
					}
					modifier = {
						factor = 0
						OR = {
							trait = zealous
							trait = perfecti
							trait = incapable
							is_adult = no
							prisoner = yes
							can_change_religion = no
						}
					}
					emf_character_become_heretic_effect = yes
				}
				50 = {
					modifier = {
						factor = 0
						ROOT = { is_heretic = no }
					}
					modifier = {
						factor = 0
						OR = {
							trait = zealous
							trait = perfecti
							trait = incapable
							is_adult = no
							prisoner = yes
							can_change_religion = no
						}
					}
					abandon_heresy = yes
				}
				50 = {
					modifier = {
						factor = 0.5
						trait = cynical
					}
					modifier = {
						factor = 0.5
						trait = wroth
					}
					modifier = {
						factor = 2
						trait = patient
					}
					modifier = {
						factor = 2
						is_priest = yes
					}
					random = {
						chance = 20
						add_trait = cynical
					}
				}
			}	
		}
		random_demesne_province = {
			limit = {
				religion = bogomilist
				NOT = { has_province_modifier = religious_unrest }
			}
			random_list = {
				50 = {
					add_province_modifier = {
						name = religious_unrest
						duration = 730
					}
				}
				50 = {
					modifier = {
						factor = 0
						ROOT = { is_heretic = yes }
					}
					emf_province_become_heretic_effect = yes
					add_province_modifier = {
						name = religious_unrest
						duration = 730
					}
				}
				50 = {
					modifier = {
						factor = 0
						ROOT = { is_heretic = no }
					}
					abandon_heresy = yes
					add_province_modifier = {
						name = religious_unrest
						duration = 730
					}
				}
				50 = {}
			}
		}
	}
}

# Bogomilist Faith Formalized
narrative_event = {
	id = emf_heresy.2132
	title = EVTNAME_emf_heresy_2131
	desc = EVTDESC_emf_heresy_2132
	picture = GFX_evt_monastery_monks
	border = GFX_event_narrative_frame_religion
	
	is_triggered_only = yes
	major = yes
	
	major_trigger = {
		religion = bogomilist
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2130
		trigger = { character = ROOT }
	}
	option = {
		name = EVTOPTA_emf_heresy_2130
		trigger = { NOT = { character = ROOT } }
		tooltip = { religion_authority = { modifier = bogomilism_formalized } }
		if = {
			limit = {
				primary_title = { NOT = { has_law = bogomilist_church_3 } }
			}
			primary_title = { add_law = bogomilist_church_3 }
		}
	}
}

# A Bogomilist Patriarch is elected (fired from decision)
character_event = {
	id = emf_heresy.2133
	
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		random_realm_lord = {
			limit = {
				religion = bogomilist
				is_theocracy = yes
				prisoner = no
				trait = perfecti
				NOT = { trait = incapable }
			}
			d_bogomilist = { grant_title = PREV }
			ROOT = {
				random_realm_title = {
					limit = { is_holy_site = ROOT }
					gain_title = PREVPREV
				}
			}
			set_defacto_liege = ROOT
			emf_liege_change_effect = yes
			save_event_target_as = new_bogomilist_patriarch
			ROOT = { narrative_event = { id = emf_heresy.2134 } }
			break = yes
		}
		random_realm_character = {
			limit = {
				religion = bogomilist
				is_ruler = no
				prisoner = no
				trait = perfecti
				learning = 12
				NOT = { trait = incapable }
			}
			d_bogomilist = { grant_title = PREV }
			ROOT = {
				random_realm_title = {
					limit = { is_holy_site = ROOT }
					gain_title = PREVPREV
				}
			}
			set_defacto_liege = ROOT
			emf_liege_change_effect = yes
			save_event_target_as = new_bogomilist_patriarch
			ROOT = { narrative_event = { id = emf_heresy.2134 } }
			break = yes
		}
		create_random_priest = {
			random_traits = yes
			dynasty = random
			religion = bogomilist
			culture = ROOT
			age = 40
			health = 7
			trait = quick
			trait = zealous
			trait = perfecti
			trait = scholar
			trait = mastermind_theologian
			attributes = {
				learning = 5
				diplomacy = 5
				martial = 2
				stewardship = 5
				intrigue = 5
			}
		}
		new_character = {
			d_bogomilist = { grant_title = PREV }
			ROOT = {
				random_realm_title = {
					limit = { is_holy_site = ROOT }
					gain_title = PREVPREV
				}
			}
			set_defacto_liege = ROOT
			emf_liege_change_effect = yes
			save_event_target_as = new_bogomilist_patriarch
		}
		narrative_event = { id = emf_heresy.2134 }
	}
}

# The rest of the world is told about the new Bogomilist Patriarch
narrative_event = {
	id = emf_heresy.2134
	title = EVTTITLE_emf_heresy_2134
	desc = EVTDESC_emf_heresy_2134
	picture = GFX_evt_icon
	border = GFX_event_narrative_frame_religion
	sound = church_bells

	major = yes

	is_triggered_only = yes

	option = {
		name = EVTOPTA_emf_heresy_2134
		trigger = {
			NOT = { religion = bogomilist }
			religion_group = christian
		}
	}
	option = {
		name = EVTOPTB_emf_heresy_2134
		trigger = { NOT = { religion_group = christian } }
	}
	option = {
		name = EVTOPTA_emf_heresy_2130
		trigger = { religion = bogomilist }
		if = {
			limit = {
				primary_title = { NOT = { has_law = bogomilist_church_4 } }
			}
			primary_title = { add_law = bogomilist_church_4 }
		}
	}
}

# Church of St. Bogomil Construction Begun
province_event = {
	id = emf_heresy.2135
	desc = EVTDESC_emf_heresy_2135
	picture = GFX_evt_castle_construction
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_emf_heresy_2135
	}
}

province_event = {
	id = emf_heresy.2136
	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				OR = {
					owner = { war = yes }
					county = { is_occupied = yes }
				}
			}
			repeat_event = { id = emf_heresy.2136 days = 60 random = 120 }
			break = yes
		}
		if = {
			limit = {
				OR = {
					owner = { NOT = { religion = bogomilist } }
					owner = { top_liege = { NOT = { religion = bogomilist } } }
					NOT = { num_of_empty_holdings = 1 }
				}
			}
			remove_province_modifier = building_st_bogomil
			break = yes
		}
		
		# Building is successful
		set_province_flag = church_of_st_bogomil_built
		remove_province_modifier = building_st_bogomil
		owner = {
			top_liege = {
				narrative_event = { id = emf_heresy.2137 }
			}
		}
	}
}

# Church of St. Bogomil Built
narrative_event = {
	id = emf_heresy.2137
	title = EVTNAME_emf_heresy_2137
	desc = EVTDESC_emf_heresy_2137
	picture = GFX_evt_cathedral
	border = GFX_event_narrative_frame_religion
	major = yes
	
	is_triggered_only = yes
	
	hide_from = yes
	
	immediate = {
		if = {
			limit = { emf_swmh_trigger = yes }
			493 = {
				build_holding = {
				   title = b_st_bogomil
				   type = temple
				   holder = ROOT
				}
			}
		}
		if = {
			limit = { emf_swmh_trigger = no }
			499 = {
				build_holding = {
				   title = b_st_bogomil
				   type = temple
				   holder = ROOT
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_emf_heresy_2137
		trigger = { religion = bogomilist }
		if = {
			limit = { character = ROOT }
			prestige = 500
			piety = 500
			religion_authority = { modifier = church_st_bogomil_built }
		}
		if = {
			limit = {
				higher_tier_than = DUKE
				has_character_modifier = formalizing_bogomilist
				d_bogomilist = { NOT = { is_variable_equal = { which = "bogomil_formalization" value = 4 } } }
			}
			if = {
				limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 3 } } }
				custom_tooltip = { text = BOGO_FORMALIZATION4 }
			}
			if = {
				limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 2 } } }
				custom_tooltip = { text = BOGO_FORMALIZATION3 }
			}
			if = {
				limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 1 } } }
				custom_tooltip = { text = BOGO_FORMALIZATION2 }
			}		
			if = {
				limit = { d_bogomilist = { is_variable_equal = { which = "bogomil_formalization" value = 0 } } }
				custom_tooltip = { text = BOGO_FORMALIZATION1 }
			}
			if = {
				limit = { d_bogomilist = { NOT = { check_variable = { which = "bogomil_formalization" value = -0.5 } } } }
				custom_tooltip = { text = BOGO_FORMALIZATION0 }
			}
			hidden_tooltip = {
				d_bogomilist = {
					change_variable = { which = "bogomil_formalization" value = 1 }
				}
			}
		}
		if = {
			limit = { NOT = { character = ROOT } }
			tooltip = { religion_authority = { modifier = church_st_bogomil_built } }
		}
	}
	option = {
		name = OK
		trigger = { NOT = { religion = bogomilist } }
	}
}

# Bogomilist missionaries move into a neighboring realm
character_event = {
	id = emf_heresy.2138
	
	hide_window = yes
	is_triggered_only = yes
	religion = bogomilist
	only_independent = yes
	
	trigger = {
		religion = bogomilist
		independent = yes
		any_realm_province = {
			county = { is_occupied = no }
			religion = bogomilist
			any_neighbor_province = {
				county = { is_occupied = no }
				NOT = { religion = bogomilist }
				owner = {
					NOT = { war_with = ROOT }
					NOT = { reverse_has_truce = ROOT }
					NOT = { has_non_aggression_pact_with = ROOT }
					NOT = { same_realm = ROOT }
					NOT = { any_courtier = { has_character_flag = bogomilist_missionary } }
				}
			}
		}
		OR = {
			NOT = { has_character_flag = sent_bogomilist_missionary }
			had_character_flag = { flag = sent_bogomilist_missionary days = 3650 }
		}
	}
	
	weight_multiplier = {
		days = 1
		modifier = {
			factor = 0.75
			war = yes
		}
		modifier = {
			factor = 0.5
			has_law = bogomilist_church_0
		}
		modifier = {
			factor = 1.5
			has_law = bogomilist_church_2
		}
		modifier = {
			factor = 1.5
			has_law = bogomilist_church_3
		}
		modifier = {
			factor = 1.5
			has_law = bogomilist_church_4
		}
		modifier = {
			factor = 0.5
			lower_tier_than = DUKE
		}
		modifier = {
			factor = 1.5
			tier = EMPEROR
		}
	}
	
	immediate = {
		set_character_flag = sent_bogomilist_missionary
		random_realm_province = {
			limit = {
				religion = bogomilist
				county = { is_occupied = no }
				any_neighbor_province = {
					county = { is_occupied = no }
					NOT = { religion = bogomilist }
					owner = {
						NOT = { war_with = ROOT }
						NOT = { reverse_has_truce = ROOT }
						NOT = { has_non_aggression_pact_with = ROOT }
						NOT = { same_realm = ROOT }
						NOT = { any_courtier = { has_character_flag = bogomilist_missionary } }
					}
				}
			}
			random_neighbor_province = {
				limit = {
					county = { is_occupied = no }
					NOT = { religion = bogomilist }
					owner = {
						NOT = { war_with = ROOT }
						NOT = { reverse_has_truce = ROOT }
						NOT = { has_non_aggression_pact_with = ROOT }
						NOT = { same_realm = ROOT }
						NOT = { any_courtier = { has_character_flag = bogomilist_missionary } }
					}
				}
				owner = {
					create_random_diplomat = {
						random_traits = yes
						dynasty = none
						religion = ROOT
						culture = PREVPREV
						female = no
						age = 40
						trait = zealous
						trait = gregarious
						trait = perfecti
						attributes = {
							learning = 5
							diplomacy = 5
						}
					}
					new_character = {
						set_character_flag = bogomilist_missionary
					}
				}	
			}
		}
	}
}

